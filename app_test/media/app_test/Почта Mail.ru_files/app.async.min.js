!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define("dompurify",b):(a=a||self).DOMPurify=b()}(this,function(){"use strict";var a=Object.hasOwnProperty,b=Object.setPrototypeOf,c=Object.isFrozen,d=Object.freeze,e=Object.seal,f=Object.create,g="undefined"!=typeof Reflect&&Reflect,h=g.apply,i=g.construct;h||(h=function(a,b,c){return a.apply(b,c)}),d||(d=function(a){return a}),e||(e=function(a){return a}),i||(i=function(a,b){return new(Function.prototype.bind.apply(a,[null].concat(function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(b))))});var j,k=w(Array.prototype.forEach),l=w(Array.prototype.indexOf),m=w(Array.prototype.pop),n=w(Array.prototype.push),o=w(Array.prototype.slice),p=w(String.prototype.toLowerCase),q=w(String.prototype.match),r=w(String.prototype.replace),s=w(String.prototype.indexOf),t=w(String.prototype.trim),u=w(RegExp.prototype.test),v=(j=TypeError,function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return i(j,b)});function w(a){return function(b){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];return h(a,b,d)}}function x(a,d){b&&b(a,null);for(var e=d.length;e--;){var f=d[e];if("string"==typeof f){var g=p(f);g!==f&&(c(d)||(d[e]=g),f=g)}a[f]=!0}return a}function y(b){var c=f(null),d=void 0;for(d in b)h(a,b,[d])&&(c[d]=b[d]);return c}var z=d(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),A=d(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","audio","canvas","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","video","view","vkern"]),B=d(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),C=d(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),D=d(["#text"]),E=d(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns"]),F=d(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),G=d(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),H=d(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),I=e(/\{\{[\s\S]*|[\s\S]*\}\}/gm),J=e(/<%[\s\S]*|[\s\S]*%>/gm),K=e(/^data-[\-\w.\u00B7-\uFFFF]/),L=e(/^aria-[\-\w]+$/),M=e(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),N=e(/^(?:\w+script|data):/i),O=e(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function Q(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}var R=function(){return"undefined"==typeof window?null:window},S=function(a,b){if("object"!==(void 0===a?"undefined":P(a))||"function"!=typeof a.createPolicy)return null;var c=null;b.currentScript&&b.currentScript.hasAttribute("data-tt-policy-suffix")&&(c=b.currentScript.getAttribute("data-tt-policy-suffix"));var d="dompurify"+(c?"#"+c:"");try{return a.createPolicy(d,{createHTML:function(a){return a}})}catch(a){return console.warn("TrustedTypes policy "+d+" could not be created."),null}};return function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R(),c=function(b){return a(b)};if(c.version="2.1.0",c.removed=[],!b||!b.document||9!==b.document.nodeType)return c.isSupported=!1,c;var e=b.document,f=!1,g=b.document,h=b.DocumentFragment,i=b.HTMLTemplateElement,j=b.Node,w=b.NodeFilter,T=b.NamedNodeMap,U=void 0===T?b.NamedNodeMap||b.MozNamedAttrMap:T,V=b.Text,W=b.Comment,X=b.DOMParser,$=b.trustedTypes;if("function"==typeof i){var Y=g.createElement("template");Y.content&&Y.content.ownerDocument&&(g=Y.content.ownerDocument)}var Z=S($,e),_=Z&&Fa?Z.createHTML(""):"",aa=g,ba=aa.implementation,ca=aa.createNodeIterator,da=aa.getElementsByTagName,ea=aa.createDocumentFragment,fa=e.importNode,ga={};try{ga=y(g).documentMode?g.documentMode:{}}catch(a){}var ha={};c.isSupported=ba&&void 0!==ba.createHTMLDocument&&9!==ga;var ia=I,ja=J,ka=K,la=L,ma=N,na=O,oa=M,pa=null,qa=x({},[].concat(Q(z),Q(A),Q(B),Q(C),Q(D))),ra=null,sa=x({},[].concat(Q(E),Q(F),Q(G),Q(H))),ta=null,ua=null,va=!0,wa=!0,xa=!1,ya=!1,za=!1,Aa=!1,Ba=!1,Ca=!1,Da=!1,Ea=!1,Fa=!1,Ga=!0,Ha=!0,Ia=!1,Ja={},Ka=x({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","plaintext","script","style","svg","template","thead","title","video","xmp"]),La=null,Ma=x({},["audio","video","img","source","image","track"]),Na=null,Oa=x({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]),Pa=null,Qa=g.createElement("form"),Ra=function(a){Pa&&Pa===a||(a&&"object"===(void 0===a?"undefined":P(a))||(a={}),a=y(a),pa="ALLOWED_TAGS"in a?x({},a.ALLOWED_TAGS):qa,ra="ALLOWED_ATTR"in a?x({},a.ALLOWED_ATTR):sa,Na="ADD_URI_SAFE_ATTR"in a?x(y(Oa),a.ADD_URI_SAFE_ATTR):Oa,La="ADD_DATA_URI_TAGS"in a?x(y(Ma),a.ADD_DATA_URI_TAGS):Ma,ta="FORBID_TAGS"in a?x({},a.FORBID_TAGS):{},ua="FORBID_ATTR"in a?x({},a.FORBID_ATTR):{},Ja="USE_PROFILES"in a&&a.USE_PROFILES,va=!1!==a.ALLOW_ARIA_ATTR,wa=!1!==a.ALLOW_DATA_ATTR,xa=a.ALLOW_UNKNOWN_PROTOCOLS||!1,ya=a.SAFE_FOR_TEMPLATES||!1,za=a.WHOLE_DOCUMENT||!1,Ca=a.RETURN_DOM||!1,Da=a.RETURN_DOM_FRAGMENT||!1,Ea=a.RETURN_DOM_IMPORT||!1,Fa=a.RETURN_TRUSTED_TYPE||!1,Ba=a.FORCE_BODY||!1,Ga=!1!==a.SANITIZE_DOM,Ha=!1!==a.KEEP_CONTENT,Ia=a.IN_PLACE||!1,oa=a.ALLOWED_URI_REGEXP||oa,ya&&(wa=!1),Da&&(Ca=!0),Ja&&(pa=x({},[].concat(Q(D))),ra=[],!0===Ja.html&&(x(pa,z),x(ra,E)),!0===Ja.svg&&(x(pa,A),x(ra,F),x(ra,H)),!0===Ja.svgFilters&&(x(pa,B),x(ra,F),x(ra,H)),!0===Ja.mathMl&&(x(pa,C),x(ra,G),x(ra,H))),a.ADD_TAGS&&(pa===qa&&(pa=y(pa)),x(pa,a.ADD_TAGS)),a.ADD_ATTR&&(ra===sa&&(ra=y(ra)),x(ra,a.ADD_ATTR)),a.ADD_URI_SAFE_ATTR&&x(Na,a.ADD_URI_SAFE_ATTR),Ha&&(pa["#text"]=!0),za&&x(pa,["html","head","body"]),pa.table&&(x(pa,["tbody"]),delete ta.tbody),d&&d(a),Pa=a)},Sa=function(a){n(c.removed,{element:a});try{a.parentNode.removeChild(a)}catch(b){a.outerHTML=_}},Ta=function(a,b){try{n(c.removed,{attribute:b.getAttributeNode(a),from:b})}catch(a){n(c.removed,{attribute:null,from:b})}b.removeAttribute(a)},Ua=function(a){var b=void 0,c=void 0;if(Ba)a="<remove></remove>"+a;else{var d=q(a,/^[\r\n\t ]+/);c=d&&d[0]}var e=Z?Z.createHTML(a):a;try{b=(new X).parseFromString(e,"text/html")}catch(a){}if(f&&x(ta,["title"]),!b||!b.documentElement){var h=(b=ba.createHTMLDocument("")).body;h.parentNode.removeChild(h.parentNode.firstElementChild),h.outerHTML=e}return a&&c&&b.body.insertBefore(g.createTextNode(c),b.body.childNodes[0]||null),da.call(b,za?"html":"body")[0]};c.isSupported&&function(){try{var a=Ua("<x/><title>&lt;/title&gt;&lt;img&gt;");u(/<\/title/,a.querySelector("title").innerHTML)&&(f=!0)}catch(a){}}();var Va=function(a){return ca.call(a.ownerDocument||a,a,w.SHOW_ELEMENT|w.SHOW_COMMENT|w.SHOW_TEXT,function(){return w.FILTER_ACCEPT},!1)},Wa=function(a){return!(a instanceof V||a instanceof W)&&!("string"==typeof a.nodeName&&"string"==typeof a.textContent&&"function"==typeof a.removeChild&&a.attributes instanceof U&&"function"==typeof a.removeAttribute&&"function"==typeof a.setAttribute&&"string"==typeof a.namespaceURI)},Xa=function(a){return"object"===(void 0===j?"undefined":P(j))?a instanceof j:a&&"object"===(void 0===a?"undefined":P(a))&&"number"==typeof a.nodeType&&"string"==typeof a.nodeName},Ya=function(a,b,d){ha[a]&&k(ha[a],function(a){a.call(c,b,d,Pa)})},Za=function(a){var b=void 0;if(Ya("beforeSanitizeElements",a,null),Wa(a))return Sa(a),!0;if(q(a.nodeName,/[\u0080-\uFFFF]/))return Sa(a),!0;var d=p(a.nodeName);if(Ya("uponSanitizeElement",a,{tagName:d,allowedTags:pa}),!Xa(a.firstElementChild)&&(!Xa(a.content)||!Xa(a.content.firstElementChild))&&u(/<[!/\w]/g,a.innerHTML)&&u(/<[!/\w]/g,a.textContent))return Sa(a),!0;if(!pa[d]||ta[d]){if(Ha&&!Ka[d]&&"function"==typeof a.insertAdjacentHTML)try{var e=a.innerHTML;a.insertAdjacentHTML("AfterEnd",Z?Z.createHTML(e):e)}catch(a){}return Sa(a),!0}return"noscript"!==d&&"noembed"!==d||!u(/<\/no(script|embed)/i,a.innerHTML)?(ya&&3===a.nodeType&&(b=a.textContent,b=r(b,ia," "),b=r(b,ja," "),a.textContent!==b&&(n(c.removed,{element:a.cloneNode()}),a.textContent=b)),Ya("afterSanitizeElements",a,null),!1):(Sa(a),!0)},$a=function(a,b,c){if(Ga&&("id"===b||"name"===b)&&(c in g||c in Qa))return!1;if(wa&&u(ka,b));else if(va&&u(la,b));else{if(!ra[b]||ua[b])return!1;if(Na[b]);else if(u(oa,r(c,na,"")));else if("src"!==b&&"xlink:href"!==b&&"href"!==b||"script"===a||0!==s(c,"data:")||!La[a]){if(xa&&!u(ma,r(c,na,"")));else if(c)return!1}else;}return!0},_a=function(a){var b=void 0,d=void 0,e=void 0,f=void 0,g=void 0;Ya("beforeSanitizeAttributes",a,null);var h=a.attributes;if(h){var i={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ra};for(g=h.length;g--;){var j=b=h[g],k=j.name,n=j.namespaceURI;if(d=t(b.value),e=p(k),i.attrName=e,i.attrValue=d,i.keepAttr=!0,i.forceKeepAttr=void 0,Ya("uponSanitizeAttribute",a,i),d=i.attrValue,!i.forceKeepAttr){if("name"===e&&"IMG"===a.nodeName&&h.id)f=h.id,h=o(h,[]),Ta("id",a),Ta(k,a),l(h,f)>g&&a.setAttribute("id",f.value);else{if("INPUT"===a.nodeName&&"type"===e&&"file"===d&&i.keepAttr&&(ra[e]||!ua[e]))continue;"id"===k&&a.setAttribute(k,""),Ta(k,a)}if(i.keepAttr)if(u(/\/>/i,d))Ta(k,a);else{ya&&(d=r(d,ia," "),d=r(d,ja," "));var q=a.nodeName.toLowerCase();if($a(q,e,d))try{n?a.setAttributeNS(n,k,d):a.setAttribute(k,d),m(c.removed)}catch(a){}}}}Ya("afterSanitizeAttributes",a,null)}},ab=function a(b){var c=void 0,d=Va(b);for(Ya("beforeSanitizeShadowDOM",b,null);c=d.nextNode();)Ya("uponSanitizeShadowNode",c,null),Za(c)||(c.content instanceof h&&a(c.content),_a(c));Ya("afterSanitizeShadowDOM",b,null)};return c.sanitize=function(a,d){var f=void 0,g=void 0,i=void 0,k=void 0,l=void 0;if(a||(a="\x3c!--\x3e"),"string"!=typeof a&&!Xa(a)){if("function"!=typeof a.toString)throw v("toString is not a function");if("string"!=typeof(a=a.toString()))throw v("dirty is not a string, aborting")}if(!c.isSupported){if("object"===P(b.toStaticHTML)||"function"==typeof b.toStaticHTML){if("string"==typeof a)return b.toStaticHTML(a);if(Xa(a))return b.toStaticHTML(a.outerHTML)}return a}if(Aa||Ra(d),c.removed=[],"string"==typeof a&&(Ia=!1),Ia);else if(a instanceof j)1===(g=(f=Ua("\x3c!--\x3e")).ownerDocument.importNode(a,!0)).nodeType&&"BODY"===g.nodeName||"HTML"===g.nodeName?f=g:f.appendChild(g);else{if(!Ca&&!ya&&!za&&-1===a.indexOf("<"))return Z&&Fa?Z.createHTML(a):a;if(!(f=Ua(a)))return Ca?null:_}f&&Ba&&Sa(f.firstChild);for(var m=Va(Ia?a:f);i=m.nextNode();)3===i.nodeType&&i===k||Za(i)||(i.content instanceof h&&ab(i.content),_a(i),k=i);if(k=null,Ia)return a;if(Ca){if(Da)for(l=ea.call(f.ownerDocument);f.firstChild;)l.appendChild(f.firstChild);else l=f;return Ea&&(l=fa.call(e,l,!0)),l}var n=za?f.outerHTML:f.innerHTML;return ya&&(n=r(n,ia," "),n=r(n,ja," ")),Z&&Fa?Z.createHTML(n):n},c.setConfig=function(a){Ra(a),Aa=!0},c.clearConfig=function(){Pa=null,Aa=!1},c.isValidAttribute=function(a,b,c){Pa||Ra({});var d=p(a),e=p(b);return $a(d,e,c)},c.addHook=function(a,b){"function"==typeof b&&(ha[a]=ha[a]||[],n(ha[a],b))},c.removeHook=function(a){ha[a]&&m(ha[a])},c.removeHooks=function(a){ha[a]&&(ha[a]=[])},c.removeAllHooks=function(){ha={}},c}()});define("clipboard/dist/clipboard",["module","exports"],function(a,exports){"use strict";var b=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};(function c(d,e){if((typeof exports==="undefined"?"undefined":b(exports))==="object"&&(typeof a==="undefined"?"undefined":b(a))==="object")a.exports=e();else if(typeof define==="function"&&define.amd)define([],e);else if((typeof exports==="undefined"?"undefined":b(exports))==="object")exports["ClipboardJS"]=e();else d["ClipboardJS"]=e()})(undefined,function(){return function(){var a={134:function a(c,d,e){"use strict";e.d(d,{default:function a(){return E}});var f=e(279);var g=e.n(f);var h=e(370);var i=e.n(h);var j=e(817);var k=e.n(j);function l(a){"@babel/helpers - typeof";if(typeof Symbol==="function"&&b(Symbol.iterator)==="symbol"){l=function a(c){return typeof c==="undefined"?"undefined":b(c)}}else{l=function a(c){return c&&typeof Symbol==="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c==="undefined"?"undefined":b(c)}}return l(a)}function m(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function n(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}function o(a,b,c){if(b)n(a.prototype,b);if(c)n(a,c);return a}var p=function(){function a(b){m(this,a);this.resolveOptions(b);this.initSelection()}o(a,[{key:"resolveOptions",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.action=b.action;this.container=b.container;this.emitter=b.emitter;this.target=b.target;this.text=b.text;this.trigger=b.trigger;this.selectedText=""}},{key:"initSelection",value:function a(){if(this.text){this.selectFake()}else if(this.target){this.selectTarget()}}},{key:"createFakeElement",value:function a(){var b=document.documentElement.getAttribute("dir")==="rtl";this.fakeElem=document.createElement("textarea");this.fakeElem.style.fontSize="12pt";this.fakeElem.style.border="0";this.fakeElem.style.padding="0";this.fakeElem.style.margin="0";this.fakeElem.style.position="absolute";this.fakeElem.style[b?"right":"left"]="-9999px";var c=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top="".concat(c,"px");this.fakeElem.setAttribute("readonly","");this.fakeElem.value=this.text;return this.fakeElem}},{key:"selectFake",value:function a(){var b=this;var c=this.createFakeElement();this.fakeHandlerCallback=function(){return b.removeFake()};this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||true;this.container.appendChild(c);this.selectedText=k()(c);this.copyText();this.removeFake()}},{key:"removeFake",value:function a(){if(this.fakeHandler){this.container.removeEventListener("click",this.fakeHandlerCallback);this.fakeHandler=null;this.fakeHandlerCallback=null}if(this.fakeElem){this.container.removeChild(this.fakeElem);this.fakeElem=null}}},{key:"selectTarget",value:function a(){this.selectedText=k()(this.target);this.copyText()}},{key:"copyText",value:function a(){var b;try{b=document.execCommand(this.action)}catch(a){b=false}this.handleResult(b)}},{key:"handleResult",value:function a(b){this.emitter.emit(b?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function a(){if(this.trigger){this.trigger.focus()}document.activeElement.blur();window.getSelection().removeAllRanges()}},{key:"destroy",value:function a(){this.removeFake()}},{key:"action",set:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"copy";this._action=b;if(this._action!=="copy"&&this._action!=="cut"){throw new Error('Invalid "action" value, use either "copy" or "cut"')}},get:function a(){return this._action}},{key:"target",set:function a(b){if(b!==undefined){if(b&&l(b)==="object"&&b.nodeType===1){if(this.action==="copy"&&b.hasAttribute("disabled")){throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute')}if(this.action==="cut"&&(b.hasAttribute("readonly")||b.hasAttribute("disabled"))){throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes')}this._target=b}else{throw new Error('Invalid "target" value, use a valid Element')}}},get:function a(){return this._target}}]);return a}();var q=p;function r(a){"@babel/helpers - typeof";if(typeof Symbol==="function"&&b(Symbol.iterator)==="symbol"){r=function a(c){return typeof c==="undefined"?"undefined":b(c)}}else{r=function a(c){return c&&typeof Symbol==="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c==="undefined"?"undefined":b(c)}}return r(a)}function s(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function t(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}function u(a,b,c){if(b)t(a.prototype,b);if(c)t(a,c);return a}function v(a,b){if(typeof b!=="function"&&b!==null){throw new TypeError("Super expression must either be null or a function")}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:true,configurable:true}});if(b)w(a,b)}function w(a,b){w=Object.setPrototypeOf||function a(b,c){b.__proto__=c;return b};return w(a,b)}function x(a){var b=A();return function c(){var d=B(a),e;if(b){var f=B(this).constructor;e=Reflect.construct(d,arguments,f)}else{e=d.apply(this,arguments)}return y(this,e)}}function y(a,b){if(b&&(r(b)==="object"||typeof b==="function")){return b}return z(a)}function z(a){if(a===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return a}function A(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(a){return false}}function B(a){B=Object.setPrototypeOf?Object.getPrototypeOf:function a(b){return b.__proto__||Object.getPrototypeOf(b)};return B(a)}function C(a,b){var c="data-clipboard-".concat(a);if(!b.hasAttribute(c)){return}return b.getAttribute(c)}var D=function(a){v(c,a);var b=x(c);function c(a,d){var e;s(this,c);e=b.call(this);e.resolveOptions(d);e.listenClick(a);return e}u(c,[{key:"resolveOptions",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.action=typeof b.action==="function"?b.action:this.defaultAction;this.target=typeof b.target==="function"?b.target:this.defaultTarget;this.text=typeof b.text==="function"?b.text:this.defaultText;this.container=r(b.container)==="object"?b.container:document.body}},{key:"listenClick",value:function a(b){var c=this;this.listener=i()(b,"click",function(a){return c.onClick(a)})}},{key:"onClick",value:function a(b){var c=b.delegateTarget||b.currentTarget;if(this.clipboardAction){this.clipboardAction=null}this.clipboardAction=new q({action:this.action(c),target:this.target(c),text:this.text(c),container:this.container,trigger:c,emitter:this})}},{key:"defaultAction",value:function a(b){return C("action",b)}},{key:"defaultTarget",value:function a(b){var c=C("target",b);if(c){return document.querySelector(c)}}},{key:"defaultText",value:function a(b){return C("text",b)}},{key:"destroy",value:function a(){this.listener.destroy();if(this.clipboardAction){this.clipboardAction.destroy();this.clipboardAction=null}}}],[{key:"isSupported",value:function a(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:["copy","cut"];var c=typeof b==="string"?[b]:b;var d=!!document.queryCommandSupported;c.forEach(function(a){d=d&&!!document.queryCommandSupported(a)});return d}}]);return c}(g());var E=D},828:function a(b){var c=9;if(typeof Element!=="undefined"&&!Element.prototype.matches){var d=Element.prototype;d.matches=d.matchesSelector||d.mozMatchesSelector||d.msMatchesSelector||d.oMatchesSelector||d.webkitMatchesSelector}function e(a,b){while(a&&a.nodeType!==c){if(typeof a.matches==="function"&&a.matches(b)){return a}a=a.parentNode}}b.exports=e},438:function a(b,c,d){var e=d(828);function f(a,b,c,d,e){var f=h.apply(this,arguments);a.addEventListener(c,f,e);return{destroy:function b(){a.removeEventListener(c,f,e)}}}function g(a,b,c,d,e){if(typeof a.addEventListener==="function"){return f.apply(null,arguments)}if(typeof c==="function"){return f.bind(null,document).apply(null,arguments)}if(typeof a==="string"){a=document.querySelectorAll(a)}return Array.prototype.map.call(a,function(a){return f(a,b,c,d,e)})}function h(a,b,c,d){return function(c){c.delegateTarget=e(c.target,b);if(c.delegateTarget){d.call(a,c)}}}b.exports=g},879:function a(b,exports){exports.node=function(a){return a!==undefined&&a instanceof HTMLElement&&a.nodeType===1};exports.nodeList=function(a){var b=Object.prototype.toString.call(a);return a!==undefined&&(b==="[object NodeList]"||b==="[object HTMLCollection]")&&"length"in a&&(a.length===0||exports.node(a[0]))};exports.string=function(a){return typeof a==="string"||a instanceof String};exports.fn=function(a){var b=Object.prototype.toString.call(a);return b==="[object Function]"}},370:function a(b,c,d){var e=d(879);var f=d(438);function g(a,b,c){if(!a&&!b&&!c){throw new Error("Missing required arguments")}if(!e.string(b)){throw new TypeError("Second argument must be a String")}if(!e.fn(c)){throw new TypeError("Third argument must be a Function")}if(e.node(a)){return h(a,b,c)}else if(e.nodeList(a)){return i(a,b,c)}else if(e.string(a)){return j(a,b,c)}else{throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}}function h(a,b,c){a.addEventListener(b,c);return{destroy:function d(){a.removeEventListener(b,c)}}}function i(a,b,c){Array.prototype.forEach.call(a,function(a){a.addEventListener(b,c)});return{destroy:function d(){Array.prototype.forEach.call(a,function(a){a.removeEventListener(b,c)})}}}function j(a,b,c){return f(document.body,a,b,c)}b.exports=g},817:function a(b){function c(a){var b;if(a.nodeName==="SELECT"){a.focus();b=a.value}else if(a.nodeName==="INPUT"||a.nodeName==="TEXTAREA"){var c=a.hasAttribute("readonly");if(!c){a.setAttribute("readonly","")}a.select();a.setSelectionRange(0,a.value.length);if(!c){a.removeAttribute("readonly")}b=a.value}else{if(a.hasAttribute("contenteditable")){a.focus()}var d=window.getSelection();var e=document.createRange();e.selectNodeContents(a);d.removeAllRanges();d.addRange(e);b=d.toString()}return b}b.exports=c},279:function a(b){function c(){}c.prototype={on:function a(b,c,d){var e=this.e||(this.e={});(e[b]||(e[b]=[])).push({fn:c,ctx:d});return this},once:function a(b,c,d){var e=this;function f(){e.off(b,f);c.apply(d,arguments)}f._=c;return this.on(b,f,d)},emit:function a(b){var c=[].slice.call(arguments,1);var d=((this.e||(this.e={}))[b]||[]).slice();var e=0;var f=d.length;for(e;e<f;e++){d[e].fn.apply(d[e].ctx,c)}return this},off:function a(b,c){var d=this.e||(this.e={});var e=d[b];var f=[];if(e&&c){for(var g=0,h=e.length;g<h;g++){if(e[g].fn!==c&&e[g].fn._!==c)f.push(e[g])}}f.length?d[b]=f:delete d[b];return this}};b.exports=c;b.exports.TinyEmitter=c}};var c={};function d(b){if(c[b]){return c[b].exports}var e=c[b]={exports:{}};a[b](e,e.exports,d);return e.exports}(function(){d.n=function(a){var b=a&&a.__esModule?function(){return a["default"]}:function(){return a};d.d(b,{a:b});return b}})();(function(){d.d=function(exports,a){for(var b in a){if(d.o(a,b)&&!d.o(exports,b)){Object.defineProperty(exports,b,{enumerable:true,get:a[b]})}}}})();(function(){d.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)}})();return d(134)}().default})});define("clipboard",["clipboard/dist/clipboard"],function(a){return a});!function(a,b){if("object"==typeof exports&&"object"==typeof module)module.exports=b();else if("function"==typeof define&&define.amd)define("@mail/text-analyzer/dist/main",[],b);else{var c=b();for(var d in c)("object"==typeof exports?exports:a)[d]=c[d]}}(window,function(){return function(a){var b={};function c(d){if(b[d])return b[d].exports;var e=b[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,c),e.l=!0,e.exports}return c.m=a,c.c=b,c.d=function(a,b,d){c.o(a,b)||Object.defineProperty(a,b,{enumerable:!0,get:d})},c.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},c.t=function(a,b){if(1&b&&(a=c(a)),8&b)return a;if(4&b&&"object"==typeof a&&a&&a.__esModule)return a;var d=Object.create(null);if(c.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:a}),2&b&&"string"!=typeof a)for(var e in a)c.d(d,e,function(b){return a[b]}.bind(null,e));return d},c.n=function(a){var b=a&&a.__esModule?function(){return a.default}:function(){return a};return c.d(b,"a",b),b},c.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},c.p="",c(c.s=0)}([function(a,b,c){var d;void 0===(d=function(a){var b=c(1),d=/(?:(?:[^\/\.\?\%\=;\!&-_A-z]|^)(?:attachments?|attach(?:[^a-z]|$)|attached)|аттач|в прицепе?|в скрепк(?:е|у)|во? вложени(?:и|е)|(?:см(?:отри|\.|) ?|проверь )(?:вложен|приложен|прикреплен|скрепк|файл(?:|ы|ики?)[^А-я])|во вложенн?..|вложенн?.. файл(?:|ы|ики?)[^А-я]|(?:высылаю|лови|направляю|кидаю|скидываю|бросаю|сбрасываю) файл(?:|ы|ики?)[^А-я]|(?:вкладываю|прикладываю|прикрепляю|прилагаю)[^А-я]|(?:прикрепила?|приложила?)(?:[^А-я]|$)|в приложении|в приложенн?[оы].)/gi;function e(a){var c=(a=a.toLowerCase()).match(d);if(null===c)return!1;var e=(c=c[0]).match(/[A-zА-я\. ]+/gi);return null!==e&&(c=e[0].trim(),c=b.clearText(c),!b.isLink(a,c)&&(!b.isQuestion(a,c)&&(!a.match(new RegExp("^[^'\"«»]*['\"«][^'\"«»]*"+c+"(?:[^\"'«»]*\n){0,}[^'\"«»]*['\"»][^'\"«»]*$","ig"))&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе?|в скрепк[еу]|во? вложени[ие]|во вложенн..|вложенн.. файлы?|в приложении|в приложенн?[оы].|при(?:лож|креп)ила?|(см(?:отри|\.|) ?|проверь )(?:вложен|приложен|прикреплен|скрепк|файл(?:|ы|ики?)[^А-я]))/gi,/(?:[^А-я]|^)(?:забыл.?|прошл.{2,3}|вчера.{0,}|предыдущ.{2,3}|ранее|в первом|первого|бы(?:л.?|ть)|нету?|отсутству[ею]т|пуст.{0,2}|только|ничего|будет)(?:[^А-я]|$)/gi)&&(!b.isNegRegexNear(a,/(?:attachments?|attach(?:ed)?)/gi,/(?:[^A-z]|^)(?:previou?s|last|recent|first letter|already|below)(?:[^A-z]|$)/gi)&&(!b.isNegRegexNear(a,/(?:аттач|во? вложени[ие]|во вложенн..|в приложении|в приложенн?[оы].|(?:при(?:(?:лага|крепля)ю|(?:лож|креп)ила?)|(?:в|при)кладываю)|прилага[ею]тся|(?:высылаю|лови|направляю|кидаю|скидываю|бросаю|сбрасываю) файл(?:ы|ики?)?[^А-я])/gi,/(?:(?:[^А-я]|^)ссылк.|https?:)/gi,75,100,1,1)&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе?|в скрепк[еу]|во? вложени[ие]|во вложенн..|вложенн.. файлы?|в приложении|в приложенн?[оы].|при(?:лож|креп)ила?|прилагаю|прикладываю|прикрепляю)/gi,/(?:[^А-я]|^)(?:он[аи]?|[твм]ы|мне|меня|теб[ея]|е[йеё]|не[йм]|е(?:му|го)|ва[мшс]|и[хм]|[вн]ашим|на[шмс]|мной|тобой|(?:в|н)ами|ними?|тво[йяиеё]|у?же|там|сначала|затем|опять|есть)(?:[^А-я]|$)/gi,25,25)&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе?|в скрепк[еу]|во? вложени[ие]|во вложенн..|вложенн.. файлы?|в приложении|в приложенн?[оы].|при(?:лож|креп)ила?)/gi,/(?:[^А-я]|^)(?:она?|[тв]ы|тво[йя]|теб[ея]|ва[мшс]|у?же)(?:[^А-я]|$)/gi,15,15)&&(!b.isNegRegexNear(a,/(?:во? вложени[ие]|в приложении|(?:при(?:(?:лага|крепля)ю|(?:лож|креп)ила?)|прикладываю))/gi,/(?:[^А-я]|^)(?:ответ.?|письм[оа]|переписк.|ниже|бы)(?:[^А-я]|$)/gi,35,35)&&(!b.isNegRegexNear(a,new RegExp(c,"ig"),/(?:[^А-я]|^)не(?:[^А-я]|$)/gi,35,35)&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе?|в скрепке|во? вложени[ие]|во вложенн..|вложенн.. файлы?|в приложении|в приложенн?[оы].)/gi,/(?:[^А-я]|^)[А-я]{1,7}[аеиуйь](?:ть|вь|те)(?:[^А-я]|$)/gi)&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе?|в скрепк[еу]|во? вложени[ие]|во вложенн..|вложенн.. файлы?|в приложении|в приложенн?[оы].|при(?:лож|креп)ила?|(?:в|при)кладываю|прикрепляю|прилага(?:е|ю)тся|(?:высылаю|лови|направляю|кидаю|скидываю|бросаю|сбрасываю) файл(?:|ы|ики?)[^А-я])/gi,/(?:[^А-я]|^)(?:как..|так..|(?:не)?котор..|чем|как|так|если|(?:все|ино|ко|то)гда|где|что(?:б|бы)?|почему|зачем|вместо|вообще|наконец)(?:[^А-я]|-|$)/gi,35,35)&&(!b.isNegRegexNear(a,/(?:аттач|в прицепе|в скрепке|во? вложении|во вложенн..|в приложении|в приложенн?[оы].)/gi,/(?:[^А-я]|^)не (?:вижу|найду|нахожу)(?:[^А-я]|$)/gi)&&(!b.isNegRegexNear(a,/(?:приложила?|прилагаю|прикладываю)/gi,/(?:[^А-я]|^)(?:сил[ыу]|усили[яей]|труд.{0,2})(?:[^А-я]|$)/gi)&&(!b.isNegRegexNear(a,/в приложении/gi,/(?:[^А-я]|^)(?:android|appstore|iphone|ios|google play|аппстор|авториз|андро[ий]д.*|айфон.*|верси|обнов(?:лен)?и|приложени[ея]|мобильн.{2,3}|разработ[чк]|smartphone|смартфон|регистраци.|(?:за)регистрир.*|пользовател[а-я]{1,2})/gi,1e4,1e4,1,1)&&(!b.isNegRegexNear(a,/в приложении/gi,/(?:[^А-я]|^)(?:(?:в|за)ход|вой[дт]и|групп.|веб|нельзя)/gi)&&(!b.isNegRegexNear(a,/(?:в приложении|(?:см(?:отри|\.|) ?|проверь )(?:вложен|приложен))/gi,/(?:номер|№|\d|[A-z]+)/gi,0,6)&&(null===a.match(new RegExp("в приложении [\"'].{1,30}[\"']","ig"))&&(!b.isNegRegexNear(a,/в приложении/gi,/(?:[^А-я]|^)[кмг]б|(?:кило|мега|гига)байт(?:[^А-я]|$)/gi,30,30)&&(!b.isNegRegexNear(a,/в приложении/gi,/(?:[^А-я]|^)(?:п\\.?|пункт)(?:[^А-я]|$)/gi,20,20)&&(!b.isNegRegexNear(a,/в приложении/gi,/ [а-зa-z](?:[^А-яA-z]|$)/gi,0,3)&&(!b.isNegRegexNear(a,/вкладываю/gi,/(?:[^А-я]|^)(?:смысл|деньги|инвестици|средства)/gi,30,30)&&(!b.isNegRegexNear(a,/(?:прилага(?:е|ю)тся|прилагаю|приложила?|прикрепила?|прикрепляю|прикладываю)/gi,/(?:[^А-я]|^)(?:информаци(?:я|ю)|инфо|контакты|номер)(?:[^А-я]|$)/gi)&&(!b.isNegRegexNear(a,/(?:прилага(?:е|ю)тся|во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi,/[\'\"«][^\'\"«»]{100,}[\'\"»]/gi,0,1e4,0,1)&&(!b.isNegRegexNear(a,/attach(?:ed)?/gi,/to (?:you|her|him|me)/gi,0,10)&&(!b.isNegRegexNear(a,/attached/gi,/(?:am|was|were|had|did)/gi,10,0)&&(!b.isNegRegexNear(a,/attach(?:ed)?/gi,/(?:[^A-z]|^)(?:we|your?|s?he|they|his|her|him)(?:[^A-z]|$)/gi,17,0)&&(!b.isNegRegexNear(a,/(?:attachments?|attach[^me]|attached)/gi,/(?:[^A-z]|^)(?:don'?t|not?|any|link|with ?out|forg(?:e|o)t)(?:[^A-z]|$)/gi,30,30)&&(!b.isNegRegexNear(a,/(?:attachments?|attach[^me]|attached)/gi,/(?:[^A-z]|^)(?:these|this|that|those)(?:[^A-z]|$)/gi,15,0)&&((!b.isNegRegexNear(a,/в приложении/gi,/(?:[^А-я]|^)к /gi,0,20)||null!==a.match(/в приложении к [а-я]{0,10} ?письму/gi))&&((!b.isNegRegexNear(a,/(?:прилагаю|прилага[ею]тся|приложила?|прикрепила?|прикладываю)/gi,/(?:[^А-я]|^)к /gi)||null!==a.match(/(?:прилагаю|прилага[ею]тся|приложил(?:а|[^А-я]|$)|прикрепил(?:а|[^А-я]|$)|прикладываю)[а-я ]{0,}к [а-я]{0,10} ?письму/gi)||null!==a.match(/(?:[^А-я]|^)к [а-я]{0,10} ?письму (?:прилагаю|прилага[ею]тся|приложил(?:а|[^А-я]|$)|прикрепил(?:а|[^А-я]|$)|прикладываю)/gi))&&((!b.isNegRegexNear(a,/вкладываю/gi,/(?:[^А-я]|^)в /gi)||null!==a.match(/вкладываю [а-я ]{0,} ?в [а-я]{0,10} ?письмо/gi)||null!==a.match(/в [а-я]{0,10} ?письмо вкладываю[^т]/gi))&&((!a.match(/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю) [а-я ]{0,30} ?реквизиты/gi)&&!a.match(/реквизиты [а-я ]{0,30} ?(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi)||!b.isNegRegexNear(a,/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi,/(?:[^A-z]|^)(?:бик|инн|номер|получател.|сч[её]т|кпп|о[ао]о|зао|огрн|окпо|ип|рнн|иин|иик)(?:[^A-z]|$)/gi,0,1e4,0,1))&&((!a.match(/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю) [а-я ]{0,25} ?(?:список|данные)/gi)&&!a.match(/(?:список|данные) [а-я ]{0,25} ?(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi)||!b.isNegRegexNear(a,/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi,/(?:.{0,3}(?:\d|-).*\n){2,}/gi,0,1e4,0,1))&&(!a.match(/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю) .{0,15} ?чек/gi)&&!a.match(/чек .{0,15} ?(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi)||!b.isNegRegexNear(a,/(?:во? вложени[ие]|в приложении|при(?:лож|креп)ила?|прикладываю|прикрепляю|прилагаю)/gi,/(?:[^A-z]|^)(?:сумма|номер заказа|платеж.?|получател.|ип|дата|время)(?:[^A-z]|$)/gi,0,1e4,0,1))))))))))))))))))))))))))))))))))))}var f="natural",g="noreply",h=/^(?:(?:(?:do)?[._-]?no?t?[._-]?(?:reply|answer))|(?:bez|net)[._-]?ot[vw]eta)$/i,i=/не (?:(?:нужно|следует) отвечать|отвеча)|отвечать на него не (?:нужно|следует)|не требует ответа/i,j=/do(?:n'| no)t (?:reply|respond|answer)/i,k=/e-mail|письмо|сообщение|уведомление/i,l=/автоматическ/i,m=/e-mail|message|letter/i,n=/automat|system|generated?/i;return{TYPE_NATURAL:f,TYPE_NOREPLY:g,haveAttach:e,hasAttachment:e,getType:function(a,b){return b&&!h.test(b.split("@")[0])||!(i.test(a)||j.test(a)||k.test(a)&&l.test(a)||m.test(a)&&n.test(a))?f:g}}}.call(b,c,b,a))||(a.exports=d)},function(a,b,c){var d;void 0===(d=function(a,b){b.isNegRegexNear=function(a,b,c,d,e,f,g){var h,i,j,k,l,m;if(void 0===f&&(f=0),void 0===g&&(g=0),k=(a=a.toLowerCase()).match(b),h=null!==a.match(b),null===k)return!1;j=k[0];var n=a.indexOf(j),o=n+j.length;j=this.clearText(j),m=null===(k=a.match(new RegExp("(?:[.?!\n]|^)[^.?!\n]*"+j,"ig")))?0:a.indexOf(k[0]);var p=a.substr(o,a.length);return l=null===(k=p.match(/[\.\!\?\n].*/gi))?p.length:p.indexOf(k[0]),d||0===d?((d=n-d)<m&&0===f&&(d=m),d<0&&(d=0)):d=m,e=(e||0===e)&&(e>l&&1===g||e<l)?o+e:o+l,i=null!==a.substr(d,e-d).match(c),h&&i},b.clearText=function(a){return a.replace(/[\/\(\)\[\]\&]/g,"").replace(/\\/,"\\\\")},b.isQuestion=function(a,b){var c=a.toLowerCase().match(new RegExp(b,"ig"));if(null===c)return!1;b=c[0];var d,e=a.indexOf(b),f=a.substr(e,a.length),g=f.match(/[\.\!\?)\n].*/i);return d=g&&g.length>0?f.indexOf(g[0]):f.length,null!==(f=a.substr(e,d+1)).match(/\?$/)},b.isLink=function(a,b){return null!==a.match(new RegExp("<a.*>[^<>]*"+b+"[^<>]*</a>","ig"))||null!==a.match(new RegExp("<[^<>]*"+b+"[^<>]*>","ig"))}}.call(b,c,b,a))||(a.exports=d)}])});define("@mail/text-analyzer",["@mail/text-analyzer/dist/main"],function(a){return a});(function(a,b){typeof exports==="object"&&typeof module!=="undefined"?b(exports):typeof define==="function"&&define.amd?define("@iframe/amp-viewer/amp-viewer",["exports"],b):(a=typeof globalThis!=="undefined"?globalThis:a||self,b(a["@iframe/amp-viewer"]={}))})(this,function(exports){"use strict";var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};function b(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}var c=function(){c=Object.assign||function a(b){for(var c,d=1,e=arguments.length;d<e;d++){c=arguments[d];for(var f in c)if(Object.prototype.hasOwnProperty.call(c,f))b[f]=c[f]}return b};return c.apply(this,arguments)};function d(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}function e(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a["default"]:a}function f(a,b){return b={exports:{}},a(b,b.exports),b.exports}var g=f(function(a,exports){Object.defineProperty(exports,"__esModule",{value:true});var b="initial";function c(a,b,c){if(typeof b==="function"){return new d(a,void 0,b)}return new d(a,b,c)}var d=function(){function a(a,b,c){this.state=a;this.signal=b;this.implementation=c}a.prototype.onConditionsMet=function(a){};a.prototype.onConditionsUnmet=function(a){};return a}();var e=function(){function a(a){this.transitions=a;this.currentState=b;this.possibleTransitions=[]}Object.defineProperty(a.prototype,"state",{get:function(){return this.currentState},enumerable:true,configurable:true});a.prototype.transition=function(a){var b=[];for(var c=1;c<arguments.length;c++){b[c-1]=arguments[c]}var d=this.findTransitions(a);var e=this.state;for(var f=0,g=d;f<g.length;f++){var h=g[f];this.doTransition.apply(this,[h.implementation].concat(b));if(e!==this.state){return}}};a.prototype.reset=function(){this.doTransition(b)};a.prototype.doTransition=function(a){var b=this;var c=[];for(var d=1;d<arguments.length;d++){c[d-1]=arguments[d]}this.possibleTransitions.forEach(function(a){return a.onConditionsUnmet(b)});if(typeof a==="function"){this.currentState=a.apply(void 0,[this].concat(c))}else{this.currentState=a}this.possibleTransitions=this.getPossibleTransitions();this.possibleTransitions.forEach(function(a){return a.onConditionsMet(b)})};a.prototype.getPossibleTransitions=function(){var a=this;return this.transitions.filter(function(b){return b.state===a.state})};a.prototype.findTransitions=function(a){return this.getPossibleTransitions().filter(function(b){return b.signal===a||b.signal===void 0})};return a}();function f(a){return new e(a)}var g=function(a,b){g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(b.hasOwnProperty(c))a[c]=b[c]};return g(a,b)};function h(a,b){g(a,b);function c(){this.constructor=a}a.prototype=b===null?Object.create(b):(c.prototype=b.prototype,new c)}var i=function(a){h(b,a);function b(c,d,e){var f=a.call(this,c,b.signal(e),d)||this;f.ms=e;return f}b.signal=function(a){return"_$timer"+a};b.prototype.onConditionsMet=function(b){a.prototype.onConditionsMet.call(this,b);this.timer=setTimeout(this.handleTimer.bind(this,b),this.ms)};b.prototype.onConditionsUnmet=function(b){a.prototype.onConditionsUnmet.call(this,b);clearTimeout(this.timer)};b.prototype.handleTimer=function(a){a.transition(b.signal(this.ms))};return b}(d);function j(a,b,c){return new i(a,c,b)}var k=function(a){h(b,a);function b(b,c,d){return a.call(this,b,c,function(){var a=[];for(var c=0;c<arguments.length;c++){a[c]=arguments[c]}d.apply(void 0,a);return b})||this}return b}(d);function l(a,b,c){if(typeof b==="function"){c=b;b=void 0}return new k(a,b,c)}function m(a){var b=function(c){if(typeof c==="function"){return b({})(c)}return function(b){var d=function(b){h(d,b);function d(){var d=[];for(var e=0;e<arguments.length;e++){d[e]=arguments[e]}var f=b.apply(this,d)||this;a.onConstruct(f,c);return f}return d}(b);a.onPatch(d,c);return d}};return b}function n(a,b,c){var d=a.prototype[b];var e=typeof d==="function";a.prototype[b]=function a(){c.apply(this,arguments);if(e){return d.apply(this,arguments)}}}var o="create";var p="mount";var q="update";var r="unmount";var s="catch";var t=function(a){h(b,a);function b(b){var c=a.call(this,b.transitions||[])||this;c.component=b;c.handlers={};return c}b.prototype.signal=function(a){var b=this;var c=String(a);if(!this.handlers[c]){this.handlers[c]=function(c){b.transition(a,c)}}return this.handlers[c]};b.prototype.transition=function(b){var c=[];for(var d=1;d<arguments.length;d++){c[d-1]=arguments[d]}var e;a.prototype.transition.apply(this,[b].concat(c));if(typeof this.mapToState!=="string"){return}if(this.component.state[this.mapToState]!==this.state){this.component.setState((e={},e[this.mapToState]=this.state,e))}};b.prototype.doTransition=function(b){var c=this;var d=[];for(var e=1;e<arguments.length;e++){d[e-1]=arguments[e]}if(typeof b!=="function"){return a.prototype.doTransition.call(this,b)}a.prototype.doTransition.call(this,function(){return b.apply(void 0,[c.component].concat(d))},d)};return b}(e);var u={onPatch:function(a,b){var c=b.catching;n(a,"componentDidMount",function(){this.automaton.transition(p)});n(a,"componentDidUpdate",function(a,b){this.automaton.transition(q,a,b)});n(a,"componentWillUnmount",function(){this.automaton.transition(r);this.automaton.reset()});c&&n(a,"componentDidCatch",function(a,b){this.automaton.transition(s,a,b)})},onConstruct:function(a,b){a.automaton=new t(a);a.automaton.transition(o,a);if(typeof b.mapToState==="string"){if(!a.state){a.state={}}a.state[b.mapToState]=a.automaton.state;a.automaton.mapToState=b.mapToState}}};var v=m(u);function w(a){return a.automaton}function x(a,b){return w(a).signal(b)}exports.INITIAL=b;exports.transition=c;exports.automaton=f;exports.Automaton=e;exports.Transition=d;exports.timer=j;exports.sideEffect=l;exports.CATCH=s;exports.CREATE=o;exports.MOUNT=p;exports.UNMOUNT=r;exports.UPDATE=q;exports.withAutomaton=v;exports.automatonOf=w;exports.asSignal=x});e(g);var h=g.INITIAL;var i=g.transition;var j=g.automaton;var k=g.Automaton;var l=g.Transition;var m=g.timer;var n=g.sideEffect;var o=g.CATCH;var p=g.CREATE;var q=g.MOUNT;var r=g.UNMOUNT;var s=g.UPDATE;var t=g.withAutomaton;var u=g.automatonOf;var v=g.asSignal;var w=function(){function a(){this.handlers={}}a.prototype.on=function(a,b){this.handlers[a]||(this.handlers[a]=[]);this.handlers[a].push(b)};a.prototype.off=function(a,b){if(!this.handlers[a]){return}this.handlers[a]=this.handlers[a].filter(function(a){return b!==a})};a.prototype.emit=function(a,b){(this.handlers[a]||[]).forEach(function(a){return a(b)})};return a}();var x="ready";var y="content";var z="resize";var A="theme";var B="css_selector_theme";var C="configure";var D="configured";var E="error";var F="navigate";var G="radar";var H="#?__mrg_frame_id=";var I="timeout";var J="@@mail-amp-postMessage$";var K=function(a){b(d,a);function d(b){var e=a.call(this)||this;e.id=d.lastId++;e.options=c({},b);e.id=b.id||e.id;e.handleMessage=e.handleMessage.bind(e);return e}d.prototype.setup=function(){this.options.selfWindow.addEventListener("message",this.handleMessage)};d.prototype.teardown=function(){this.options.selfWindow.removeEventListener("message",this.handleMessage)};d.prototype.sendMessage=function(a){var b=a.type;if(this.options.debug){console.warn("[SEND]",b,a)}var c=this.id+J;this.options.targetWindow.postMessage(c+JSON.stringify(a),this.options.targetOrigin||"*")};d.prototype.setDebug=function(a){this.options.debug=a};d.prototype.setTargetWindow=function(a){this.options.targetWindow=a};d.prototype.setTargetOrigin=function(a){this.options.targetOrigin=a};d.prototype.setId=function(a){this.id=a};d.prototype.getId=function(){return this.id};d.prototype.handleMessage=function(a){var b=this.options.originRegexp;if(b&&!b.test(a.origin)){if(this.options.debug){console.error("[RECEIVE] Received message from prohibited origin:",a.origin)}return}var c;try{var d=String(a.data);var e=""+this.id+J;if(d.startsWith(e)){c=JSON.parse(a.data.slice(e.length))}else{return}}catch(a){console.error(a);return}if(this.options.debug){console.warn("[RECEIVE]",c.type,c)}this.emit(c.type,c)};d.lastId=0;return d}(w);function L(a){return Object.keys(a).map(function(b){return encodeURIComponent(b)+"="+encodeURIComponent(a[b])}).join("&")}var M=/^(https?:\/\/)?(.*\.)?(imgs|dev|mini-)?mail\.ru$/;var N=/^(https?:\/\/)?localhost:?/;var O=N.test(location.href)?undefined:M;var P="initial";var Q="creation";var R="loading";var S="error";var T="configuring";var U="ready";var V="event-error";var W="ready";var X="error";var Y="warning";var Z="resize";var _="navigate";var aa="radar";var ba=function(a){b(e,a);function e(b){var d=a.call(this)||this;d.theme=null;d.options=c({},b);d.transport=new K(c({selfWindow:window,originRegexp:O,debug:b.debug},b.transport));return d}e.prototype.setup=function(){var a=this;this.initializeController();this.transport.setup();[x,D,z,B,F,G,E].forEach(function(b){return a.transport.on(b,a.asSignal(b))});this.automaton.transition(undefined)};e.prototype.teardown=function(){this.automaton.reset();this.transport.teardown()};e.prototype.loadLetter=function(a){this.letter=a;if(this.automaton.state===U){this.transport.sendMessage({type:y,data:this.letter})}};e.prototype.setTheme=function(a){this.theme=a;if(this.automaton.state===U){this.transport.sendMessage({type:A,data:this.theme})}};e.prototype.onChangeCssSelectorTheme=function(a){this.transport.on(B,function(b){var c=b.data;return a(c)})};e.prototype.errorReporter=function(a,b){var c=this;return function(){var d={data:{type:a,error:b}};c.emit(X,d.data);return S}};e.prototype.asSignal=function(a){var b=this;return function(c){b.automaton.transition(a,c)}};e.prototype.initializeController=function(){var a=this;this.automaton=j(d([i(P,"create",Q),i(Q,function(){var b=a.options.iframeSrc;a.iframe=a.options.iframe||document.createElement("iframe");var c=["xhrInterceptor","viewerRenderTemplate"];a.iframe.setAttribute("scrolling","no");a.iframe.setAttribute("allowfullscreen","false");a.iframe.setAttribute("sandbox","allow-scripts allow-forms allow-same-origin");a.iframe.setAttribute("allow","accelerometer 'none';autoplay 'none';"+"camera 'none';document-domain 'none';encrypted-media 'none';fullscreen 'none';"+"geolocation 'none';gyroscope 'none';magnetometer 'none';microphone 'none';midi 'none';"+"payment 'none';picture-in-picture 'none';sync-xhr 'none';usb 'none';xr-spatial-tracking 'none';");a.iframe.src=b+H+a.transport.getId()+"&"+L({origin:window.location.origin,prerenderSize:0,visibilityState:"visible",viewportType:a.options.mobileSafari?"natural":"natural-ios-embed",paddingTop:0,history:1,p2r:0,storage:0,development:0,log:1,cap:c.join(","),csi:0});if(/^https?:\/\//.test(b)){var d=b.split("/");var e=d[0]+"//"+d[2];a.transport.setTargetOrigin(e)}a.iframe.onerror=a.asSignal(V);return R}),m(R,this.options.timeout,this.errorReporter(I,"Iframe loading timed out")),i(R,x,function(){a.transport.setTargetWindow(a.iframe.contentWindow);a.transport.sendMessage({type:C,data:a.options});return T}),m(T,this.options.timeout,this.errorReporter(I,"Iframe configuring timed out")),i(T,D,function(){if(a.letter){a.transport.sendMessage({type:y,data:a.letter})}if(a.theme!==null){a.transport.sendMessage({type:A,data:a.theme})}a.emit(W,undefined);return U}),n(U,z,function(b,c){a.iframe.style.height=c.data.height+"px";a.emit(Z,c.data)}),n(U,F,function(b,c){a.emit(_,c.data)})],[P,R,T,U,S].map(function(b){return n(b,G,function(b,c){a.emit(aa,c.data)})}),[P,R,T,U].map(function(b){return i(b,E,function(c,d){if(d.data.type==="timeout"||d.data.type==="validation"||d.data.type==="lib_untrusted"){a.emit(X,d.data);return S}a.emit(Y,d.data);return b})})));this.automaton.transition("create")};return e}(w);function ca(a){return new ba(a)}exports.createAmpViewer=ca;Object.defineProperty(exports,"__esModule",{value:true})});define("@iframe/amp-viewer",["@iframe/amp-viewer/amp-viewer"],function(a){return a});(function(){"use strict";var a=Function("return this")();var b,c={},d={16:false,18:false,17:false,91:false},e="all",f={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},g={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},h=function(a){return g[a]||a.toUpperCase().charCodeAt(0)},i=[];for(b=1;b<20;b++)g["f"+b]=111+b;function j(a,b){var c=a.length;while(c--)if(a[c]===b)return c;return-1}function k(a,b){if(a.length!=b.length)return false;for(var c=0;c<a.length;c++){if(a[c]!==b[c])return false}return true}var l={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function m(a){for(b in d)d[b]=a[l[b]]}function n(a){o(a);var b,e,g,h,k,l;b=a.keyCode;if(j(i,b)==-1){i.push(b)}if(b==93||b==224)b=91;if(b in d){d[b]=true;for(g in f)if(f[g]==b)s[g]=true;return}m(a);if(!s.filter.call(this,a))return;if(!(b in c))return;l=z();h=c[b].length;while(h--){e=c[b][h];if(e.scope==l||e.scope=="all"||p(e.scope)){k=e.mods.length>0;for(g in d)if(!d[g]&&j(e.mods,+g)>-1||d[g]&&j(e.mods,+g)==-1)k=false;if(e.mods.length==0&&!d[16]&&!d[18]&&!d[17]&&!d[91]||k){if(e.method(a,e)===false){a.preventDefault();a.stopPropagation()}if(a.isImmediatePropagationStopped()){return true}}}}}function o(a){var b=false,c=false,d=a.stopImmediatePropagation;!a.target&&(a.target=a.srcElement);!a.isDefaultPrevented&&(a.isDefaultPrevented=function(){return b});!a.isImmediatePropagationStopped&&(a.isImmediatePropagationStopped=function(){return c});!a.preventDefault&&(a.preventDefault=function(){b=true;a.returnValue=false});!a.stopPropagation&&(a.stopPropagation=function(){a.cancelBubble=false});a.stopImmediatePropagation=function(){c=true;a.stopPropagation();d&&d.call(a)}}function p(a){if(a&&a.nodeType===1){do{if(a===document.body){return true}}while(a=a.parentNode)}return false}function q(a){var b=a.keyCode,c,e=j(i,b);if(e>=0){i.splice(e,1)}if(b==93||b==224)b=91;if(b in d){d[b]=false;for(c in f)if(f[c]==b)s[c]=false}}function r(){for(b in d)d[b]=false;for(b in f)s[b]=false}function s(a,b,d){var e,f,g;e=B(a);if(d===undefined){d=b;b="all"}for(var i=0;i<e.length;i++){f=[];a=e[i].split("+");if(a.length>1){f=C(a);a=[a[a.length-1]]}a=a[0];a=h(a);if(!(a in c))c[a]=[];g=u(a,b,d,f);if(g>-1){c[a].push(c[a].splice(g,1)[0])}else{c[a].push({shortcut:e[i],scope:b,method:d,key:e[i],mods:f})}}}function t(a,b,d){var e,f,g=[],i,j;e=B(a);if(!b||typeof b==="function"){d=b;b="all"}for(i=0;i<e.length;i++){f=e[i].split("+");if(f.length>1){g=C(f)}a=f[f.length-1];a=h(a);if(b===undefined){b=z()}do{j=u(a,b,d,g);if(j>-1){c[a].splice(j,1)}}while(j!=-1)}}function u(a,b,d,e){var f,g,h=c[a];if(h){for(f=0;f<h.length;f++){g=h[f];if(g.scope===b&&(d===undefined||g.method===d)&&k(g.mods,e)){return f}}}return-1}function v(a){if(typeof a=="string"){a=h(a)}return j(i,a)!=-1}function w(){return i.slice(0)}function x(a){var b=a.target.tagName;return!(b=="INPUT"||b=="SELECT"||b=="TEXTAREA")}for(b in f)s[b]=false;function y(a){e=a||"all"}function z(){return e||"all"}function A(a){var b,d,e;for(b in c){d=c[b];for(e=0;e<d.length;){if(d[e].scope===a)d.splice(e,1);else e++}}}function B(a){var b;a=a.replace(/\s/g,"");b=a.split(",");if(b[b.length-1]==""){b[b.length-2]+=","}return b}function C(a){var b=a.slice(0,a.length-1);for(var c=0;c<b.length;c++)b[c]=f[b[c]];return b}function D(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else if(a.attachEvent)a.attachEvent("on"+b,function(){c(window.event)})}D(document,"keydown",function(a){if(n(a)!==true){var b=key.listeners,c=0,d=b.length;for(;c<d;c++){b[c](a);if(a.isImmediatePropagationStopped()){return true}}}});D(document,"keyup",q);D(window,"focus",r);var E=a.key;function F(){var b=a.key;a.key=E;return b}a.key=s;a.key.setScope=y;a.key.getScope=z;a.key.deleteScope=A;a.key.filter=x;a.key.isPressed=v;a.key.getPressedKeyCodes=w;a.key.noConflict=F;a.key.unbind=t;a.key.on=s;a.key.off=t;a.key.listeners=[];if(typeof module!=="undefined")module.exports=s;define("@mail/keymaster",[],function(){return s})})(this);(function(a,b){typeof exports==="object"&&typeof module!=="undefined"?b(exports):typeof define==="function"&&define.amd?define("@mail/release-detect",["exports"],b):(a=typeof globalThis!=="undefined"?globalThis:a||self,b(a["@mail/release-detect"]={}))})(this,function(exports){"use strict";var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(b.hasOwnProperty(c))a[c]=b[c]};return a(b,c)};function b(b,c){a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}var c=function(){c=Object.assign||function a(b){for(var c,d=1,e=arguments.length;d<e;d++){c=arguments[d];for(var f in c)if(Object.prototype.hasOwnProperty.call(c,f))b[f]=c[f]}return b};return c.apply(this,arguments)};var d=function(a){b(c,a);function c(b){var c=a.call(this,"Assertion error: "+b)||this;c.name="AssertionError";return c}return c}(Error);function e(a,b){if(a&&typeof a=="object"){return}throw new d(b+" is not an object")}function f(a,b){if(typeof a!=="string"){throw new d(b+" is not a string")}}function g(a,b){if(!(a instanceof Date)||isNaN(+a)){throw new d(b+" is not a valid Date")}}function h(a,b){e(a,b);f(a["name"],b+".name");f(a["branch"],b+".branch");g(a["date"],b+".date");f(a["dateStr"],b+".dateStr")}function i(a,b){if(a){var c=a.split("."),e=c[0],f=c[1];if(e&&f){var g=new Date(f.replace(/_/g,":"));var i={name:a,branch:e,date:g,dateStr:f};h(i,b);return i}}throw new d(b+" is not a valid build string")}function j(a,b){e(a,b);if(a["build"]!==undefined){f(a["build"],b+".build")}}function k(a,b){j(a,b);return a}function l(a){return!!a&&typeof a==="object"&&typeof a["status"]==="number"}function m(a){return!!a.body&&typeof a.body==="object"&&a.status>=200&&a.status<300}var n=function(a){b(c,a);function c(b,c){var d=a.call(this,"XHRError on url "+c+": status "+b)||this;d.name="XHRError";d.status=b;d.url=c;return d}return c}(Error);function o(a,b){return new Promise(function(c,d){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState===4){if(e.status>=200&&e.status<300){c(e.responseText)}else{d(new n(e.status,a))}}};e.open("GET",a,true);e.timeout=b;e.send()})}var p=function(){function a(a,b){var d=this;if(b===void 0){b=3e4}this._data={};this._initialData={};this.shadowReloadPage=function(a,b){var e;d._initialData=c(c({},d._initialData),d._data);b("deploy_shadow",{i:(e={},e[d.config.name]=1,e)})};this.config=a;this.timeout=b;if(a.initialData){this._data=a.initialData;this._initialData=a.initialData}}Object.defineProperty(a.prototype,"data",{get:function(){return this._data},enumerable:false,configurable:true});a.prototype.update=function(){var a=this;var b=this._initialData;var c=typeof this.config.endpoint==="function"?this.config.endpoint():this.config.endpoint;return o(c,this.timeout).then(function(d){var e,f;var g=JSON.parse(d);var h={};if(l(g)){if(!m(g)){throw new n(g.status,c)}h=g.body}else{h=k(g,a.config.name)}var i=a.config.comparator(b,h);a._data=h;(f=(e=a.config).ondata)===null||f===void 0?void 0:f.call(e,h,a.config);if(a.config.shadow&&i.changed){i.reloadPage=a.shadowReloadPage}return i})};return a}();var q=["code","errno","syscall"];function r(a){if(!a||typeof a!=="object"){return a}if(typeof a.toJSON==="function"){return a.toJSON()}var b=c(c({},a),{name:a.name,message:a.message,stack:a.stack});for(var d=0,e=q;d<e.length;d++){var f=e[d];b[f]=a[f]}return b}function s(a){return Number.isNaN(a[0])||Number.isNaN(a[1])}function t(a,b){return b[0]<a[0]}function u(a,b){return b[1]<a[1]}function v(a){var b=a[0],c=a[1];return Math.floor(Math.random()*(c-b))+b}var w=function(){function a(a){var b=this;this._onError=function(a){var c;var d=false;if(a&&typeof a==="object"){if(a.name==="AssertionError"){b._radar(["deploy_fail","upd"])}if(a.name==="XHRError"){b._radar(["deploy_fail","xhr"],{i:(c={},c["status_"+a.status]=1,c)});d=true}}b._radar("deploy_fetch-error",!d?{rlog:"deploy_fetch-error",rlog_message:a instanceof Error?r(a):{error:"unknown"}}:undefined)};this._reload=function(a){location.href=a};this._config=c({},a);this._models=this._config.sources.map(function(b){return new p(b,a.xhrTimeout)});this._config.router.on("route-end",function(){b._fetchAndProcessConfig()});this._data=this._currentData()}a.prototype._currentData=function(){var a={};for(var b=0,c=this._models;b<c.length;b++){var d=c[b];var e=d.data;var f=Object.keys(e);for(var g=0,h=f;g<h.length;g++){var i=h[g];a[i]=e[i]}}return a};a.prototype._updateAll=function(){var a=this;return Promise.all(this._models.map(function(b){return b.update().catch(a._onError)})).then(function(a){var b={changed:false,reloadTimeRange:[NaN,NaN]};for(var c=0,d=a;c<d.length;c++){var e=d[c];if(!e||!e.changed){continue}b.changed=true;b.reloadPage=e.reloadPage;if(e.reason!==undefined){b.reason=e.reason}var f=s(b.reloadTimeRange);var g=t(b.reloadTimeRange,e.reloadTimeRange);var h=u(b.reloadTimeRange,e.reloadTimeRange);if(f||g&&h){b.reloadTimeRange=e.reloadTimeRange}}return b})};a.prototype._fetchAndProcessConfig=function(){var a=this;this._updateAll().then(function(b){var c;if(!b.changed){return}var d=a._currentData();var e=i((c=d.build)!==null&&c!==void 0?c:"","next");a._scheduleReload(e,b);a._radar("deploy_upd")}).catch(this._onError)};a.prototype._scheduleReload=function(a,b){var c=this;var d=v(b.reloadTimeRange);var e=d*1e3*60;if(this._reloadTid){return}this._reloadTid=setTimeout(function(){c._reloadTid=undefined;c._config.router.one("before-route",function(a){var d,e;if(a.target.activeRequest){var f=(d=b.reloadPage)!==null&&d!==void 0?d:c._reload;var g=a.target.activeRequest.href;if(c._config.location){g=c._config.location(g)}f(g,(e=c._config.xraySend)!==null&&e!==void 0?e:function(){return undefined})}});c._radar("deploy_switch");c._radar(["deploy_"+a.branch,a.dateStr]);if(b.reason!==undefined){c._radar("deploy_"+b.reason)}},e);this._radar("deploy_switch_reload_timeout",{v:d})};a.prototype._radar=function(a,b){if(this._config.xraySend){this._config.xraySend(a,b)}};return a}();var x=function(a,b){var c=Object.keys(a);var d=Object.keys(b);var e=c.length===d.length&&c.every(function(c){if(a[c]===""||b[c]===""){return true}return a[c]===b[c]});return{changed:!e,reason:e?undefined:this.name,reloadTimeRange:this.reloadTimeRange}};var y=function(a,b){if(!a.build&&!b.build){return{changed:false,reloadTimeRange:this.reloadTimeRange}}if(!a.build||!b.build){return{changed:true,reason:"upd_empty",reloadTimeRange:this.reloadTimeRange}}var c=i(a.build,"current");var d=i(b.build,"next");var e=c.name===d.name;return{changed:!e,reason:e?undefined:"upd_"+(d.date>c.date?"up":"down"),reloadTimeRange:this.reloadTimeRange}};function z(a,b){return function(c){var d=encodeURIComponent(a)+"="+encodeURIComponent(b);var e=c.indexOf("?")>=0;return""+c+(e?"&":"?")+d}}function A(){var a=[];for(var b=0;b<arguments.length;b++){a[b]=arguments[b]}return function(b){for(var c=0,d=a;c<d.length;c++){var e=d[c];b=e(b)}return b}}function B(a){return new w(a)}exports.appendQuery=z;exports.buildComparator=y;exports.combine=A;exports.createReleaseDetectClient=B;exports.hashComparator=x;Object.defineProperty(exports,"__esModule",{value:true})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("temporary/fix-signature",["require","exports","@mail/features","@mail/flags","@mail/xray","cfgUser","service/auth"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fixSignature=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);var f=/[\x00-\x1F\x22\x3C\x3E\x3A\xAD]/g;function g(a){return a&&typeof a==="object"}function h(a){if(typeof a==="string"){var b=a.replace(f,"");if(b.length){return b}}return""}function i(a){return{body:a.body,status:a.status,requestID:a.requestID,uuid:a.uuid}}function j(a){if(!g(a)){try{return{notAnObject:JSON.stringify(a)}}catch(a){return{notAnObject:"JSON.stringify error"}}}if(a.status===406){if(g(a.data)){delete a.data.token}return __assign(__assign({},i(a)),{data:a.data})}if(typeof a.status==="number"){return i(a)}return{name:a.name,message:a.message,stack:a.stack}}function k(){var a=d.default.get("initialUser.signs");if(!Array.isArray(a)){c.default.send("sign-fix_emptysigns");return Promise.resolve({hasBroken:false})}if(a.length===0){c.default.send("sign-fix_zerosigns");return Promise.resolve({hasBroken:false})}var b=false;var f=a.map(function(a){if(!g(a)){c.default.send("sign-fix_emptysign");return{}}a.name=h(a.name);var d=a.sign,e=a.sign_html;if(d&&!e){c.default.send("sign-fix_nohtml");return a}var f=d;try{var i=document.createElement("div");i.style.cssText="position: fixed; top: -9999px; left: -9999px;";i.setAttribute("contenteditable","true");document.body.appendChild(i);i.innerHTML=e;f=i.innerText;document.body.removeChild(i)}catch(a){b=true;c.default.send("sign-fix_reparserr",{rlog:"octavius-sign-fix-err",rlog_message:{metric:"sign-fix_parseerr",error:a}})}return __assign(__assign({},a),{sign:f})});if(f.some(function(a){var b=a.name;return!b})){c.default.send("sign-fix_noname");return Promise.resolve({hasBroken:true})}return e.default.login().then(function(a){return a.save({signs:f}).catch(function(a){c.default.send("sign-fix_save_err",{rlog:"octavius-sign-fix-err",rlog_message:{metric:"sign-fix_save_err",e:j(a)}});return{hasBroken:true}}).then(function(){return{hasBroken:b}})},function(a){c.default.send("sign-fix_userget_err",{rlog:"octavius-sign-fix-err",rlog_message:{metric:"sign-fix_userget_err",e:a}});return{hasBroken:false}})}function l(){var d=b.default.get("user-signature-fix");var e=a.default.has("user-signature-fixer-enabled");var f=d.state;if(!e||f){return}k().then(function(a){var b=a.hasBroken;d.save({state:true,time:true,hit:b}).then(function(){c.default.send("sign-fix_success")},function(a){c.default.send("sign-fix_helpersave_err",{rlog:"octavius-sign-fix-err",rlog_message:{metric:"sign-fix_helpersave_err",e:a}})})})}exports.fixSignature=l});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/page-title",["require","exports","cfg","default-values","Emitter","feast","helpers/browser","pilotjs","service/calls","service/mailbox/on-status/unread-messages-notifications"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getNextBlinkingTitle=void 0;a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importStar(g);h=__importDefault(h);var i=document.title||i18n("Почта Mail.ru");var j=function(){function a(a,b){this._switched=false;var c=document.querySelector(a);var d=c&&c.getAttribute("href");this._el=c;this._href=d;this._defaultHref=d;this._switchedHref=b;this._switched=false}a.prototype._createIconElement=function(a){var b=this._el;if(!b){return}var c=document.createElement("LINK");for(var d=0,e=b.attributes;d<e.length;d++){var f=e[d];if(f.name==="href"){c.setAttribute("href",a)}else{c.setAttribute(f.name,f.value)}}return c};a.prototype.switch=function(a){if(!b.DYNAMIC_FAVICON){return}if(this._switched===a){return}this._switched=a;this._href=this._switched?this._switchedHref:this._defaultHref;this._el.parentNode&&this._el.parentNode.removeChild(this._el);this._el=this._createIconElement(this._href);if(this._el){document.head.appendChild(this._el)}};return a}();var k=function(b){__extends(c,b);function c(){var c=b.call(this)||this;c._blinkingInterval=null;c._timeoutId=null;c._blinkingInProcess=false;c._titles={original:"",custom:""};c._iconSwitchers=[new j('link[rel="icon"][sizes="16x16"]',"".concat(a.default.get("faviconURL"),"/16-fav_mail_unread.png")),new j('link[rel="icon"][sizes="24x24"]',"".concat(a.default.get("faviconURL"),"/24-fav_mail_unread.png")),new j('link[rel="icon"][sizes="32x32"]',"".concat(a.default.get("faviconURL"),"/32-fav_mail_unread.png")),new j('link[rel="icon"][sizes="48x48"]',"".concat(a.default.get("faviconURL"),"/48-fav_mail_unread.png"))];return c}c.prototype.start=function(a){this._titles.original=a.originalTitle;this._titles.custom=a.customTitle;this._blinkingInterval=a.timeout;this._blinkingInProcess=true;if(a.enableIconSwitch){this._iconSwitchers.forEach(function(a){return a.switch(true)})}this._blinkingStep()};Object.defineProperty(c.prototype,"blinkingInProcess",{get:function(){return this._blinkingInProcess},enumerable:false,configurable:true});c.prototype.update=function(a){this._titles.original=a.originalTitle;this._titles.custom=a.customTitle;this._blinkingInterval=a.timeout;this._iconSwitchers.forEach(function(b){return b.switch(!!a.enableIconSwitch)})};c.prototype.stop=function(){this._blinkingInProcess=false;this._iconSwitchers.forEach(function(a){return a.switch(false)});this.emit("update",{title:this._titles.original});clearTimeout(this._timeoutId)};c.prototype._getTitleToShow=function(){return document.title===this._titles.original?this._titles.custom:this._titles.original};c.prototype._blinkingStep=function(){this.emit("update",{title:this._getTitleToShow()});this._timeoutId=window.setTimeout(this._blinkingStep.bind(this),this._blinkingInterval)};return c}(c.default);var l={calls:null,message:null,folder:null};var m=function(a){var b=[a.calls,a.message];return b.find(function(a){return a!==null})||null};exports.getNextBlinkingTitle=m;exports.default=d.default.Mediator.create("page-title",{defaults:function(){this.register(this.blinker=new k);this.register(g.default);this.updateFolderTitle=this.updateFolderTitle.bind(this)},components:{router:{class:f.default,events:["route"],handleEvent:"handleRoute"},"unread-notifier":{class:h.default,events:["update"],handleEvent:"handleNotifier"},blinker:{class:k,events:["update"],handleEvent:"setTitle"},callsService:{class:g.CallsService,events:["update"],handleEvent:"handleCall"}},updateFolderTitle:function(a){if(!a||!a.target){return}var b=a.target;var c=b.get("messages_unread")?i18n("({unreadCount}) {folderName} - {defaultTitle}",{unreadCount:b.get("messages_unread"),folderName:b.get("name"),defaultTitle:i}):i18n("{folderName} - {defaultTitle}",{folderName:b.get("name"),defaultTitle:i});l.folder={title:c};this.setNextTitle()},handleRoute:function(a){if(a===void 0){a=null}if(a){l.folder={title:this.getTitleFromEvent(a)};this.setNextTitle()}},handleNotifier:function(a){if(a){var b=a.timeout,c=a.count;var d=this.getTitleByUnreadMessages(c);l.message={title:d,timeout:b}}else{l.message=null}this.setNextTitle()},handleCall:function(a){var c=a.action,d=a.text;if(!b.CALL_TITLE_BLINK_INTERVAL){return}if(c==="start"){var e=d+i18n(" - {defaultTitle}",{defaultTitle:i});l.calls={title:e,timeout:b.CALL_TITLE_BLINK_INTERVAL}}else if(c==="end"){l.calls=null}this.setNextTitle()},setNextTitle:function(){var a=(0,exports.getNextBlinkingTitle)(l);if(e.default.isSafari&&a&&a===l.calls){this.blinker.stop();this.setTitle({title:a.title});return}if(a){var b={timeout:a.timeout,customTitle:a.title,enableIconSwitch:a===l.message,originalTitle:l.folder.title||i};this.blinker.blinkingInProcess?this.blinker.update(b):this.blinker.start(b);return}if(this.blinker.blinkingInProcess){this.blinker.stop()}if(l.folder){this.setTitle({title:l.folder.title});return}this.setTitle({title:i})},setTitle:function(a){var b=a.title;document.title=b},getTitleFromEvent:function(a){if(this.folder){this.folder.off("change",this.updateFolderTitle);this.folder=null}if(!a.target||!a.target.model){return i}var b=a.target.model;var c;switch(b.route.id){case"#letters":if(b.folder){c=b.folder.get("messages_unread")?i18n("({unreadCount}) {folderName}",{unreadCount:b.folder.get("messages_unread"),folderName:b.folder.get("name")}):b.folder.get("name");b.folder.on("change",this.updateFolderTitle);this.folder=b.folder}break;case"#search":c=i18n("Поиск");break;case"#attachment":c=b.attachment&&b.attachment.get("name");break}return c?i18n("{title} - {defaultTitle}",{"unsafe-title":c,defaultTitle:i}):i},getTitleByUnreadMessages:function(a){return i18n.plural(a,[i18n("{count} новых писем",{count:a}),i18n("{count} новое письмо",{count:a}),i18n("{count} новых письма",{count:a})])}})});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/calendar-manager",["require","exports","@mail/xray","cfg","default-values","feast","feast-mod/correspondents","helpers/opener","mail/Message","mail/Thread","pilotjs","service/fishing","ui-block/calendar-button/calendar-button","ui-block/compose-dropdown/compose-dropdown","ui-block/contextmenu-message/contextmenu-message","ui-block/dropdown-actions/dropdown-actions","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CalendarManager=void 0;a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);var p=1500;var q=100;var r=255;var s=4096;var t=["calendar:create","calendar:createnew"];var u=function(d){__extends(u,d);function u(){return d!==null&&d.apply(this,arguments)||this}u.prototype.getComponentsSpec=function(){return{router:{class:i.default},letter:{lazy:o.lazyUILetter,events:t},"calendar-button":{class:k.default,events:t},"contextmenu-message":{class:m.default,events:t},"dropdown-actions":{class:n.default,events:t},"compose-dropdown":{class:l.default,events:t}}};u.prototype.handleEvent=function(a){var b=a.type;var c=a.details,d=c.model,e=c.createContent;var f={type:b};var h=f.type.split(":").pop();if(h==="createnew"){return this.doAction(h,g.default.getSafe(),e)}var i=this.get("router.model.letter");return this.doAction(h,d||i,e)};u.prototype.doAction=function(a,d,e){if(!d){return}if(d instanceof h.default&&d.get("messages.length")){d=d.getExpandMessage()}if(c.USE_X_CALENDAR){this.createEventInXCalendar(a,d,e);return}if(a==="create"){var g=this.constructForm(d);document.body.appendChild(g);j.default.go(g);document.body.removeChild(g)}else if(a==="createnew"){var i=b.default.get("urls.calendarUrl")||"//calendar.mail.ru";(0,f.default)(i+"?action=eventCreate")}return false};u.prototype.createEventInXCalendar=function(a,c,d){var e=b.default.get("urls.xCalendarUrl")||"//x.calendar.mail.ru";var g=this.getCategory(c);var h=a==="create"?{action:"createEvent",title:this.getSummary(c,r),emails:!g?this.getAttendees(c,q):null,description:this.getDescription(c,1e3),createContent:d}:{action:"createEvent",createContent:d};(0,f.default)("".concat(e,"?").concat(this.getCalendarCreateQueryParamsString(e,h)))};u.prototype.getCalendarCreateQueryParamsString=function(b,c){var d=s-"".concat(b,"?").length;return Object.entries(c).filter(function(a){var b=a[1];return b}).reduce(function(b,c){var e;var f=c[0],g=c[1];var h="".concat(b,"&").concat(i.default.queryString.stringify((e={},e[f]=g,e)));if(h.length>d){a.default.send("clnd_create_".concat(f,"_limit"));return b}return h},"")};u.prototype.constructForm=function(a){var c=document.createElement("form");c.setAttribute("method","post");c.setAttribute("target","_blank");c.setAttribute("action",b.default.get("urls.calendarUrl")||"//calendar.mail.ru");c.setAttribute("style","position: absolute;left: -1000px;top: -1000px;width: 0px;height: 0px;");var d=this.constructFormData(a);Object.keys(d).forEach(function(a){var b=document.createElement("input");b.setAttribute("type","hidden");b.setAttribute("name",a);b.setAttribute("value",d[a]);c.appendChild(b)});return c};u.prototype.constructFormData=function(a){return{description:this.getDescription(a),summary:this.getSummary(a),attendees:this.getAttendees(a),category:this.getCategory(a),dtfrom:this.getPriorityDate(a)}};u.prototype.getSummary=function(a,b){var c=(a.get("subject")||i18n("<Без темы>")).replace(/(((Fwd|Re)[?[\d]*]?:[\s]*)+)/i,"").trim();if(c.length>b){return c.slice(0,b-3)+"..."}return c};u.prototype.getDescription=function(a,b){if(b===void 0){b=p}var c=(a.get("body.text")||a.get("snippet")||"").trim();if(c.length>b){c=c.slice(0,b-3)+"..."}return c};u.prototype.getAttendees=function(a,b){return(0,e.getAllCorrespondentsEmailsFromMessage)(a).slice(0,b).join(",")};u.prototype.getCategory=function(a){var b=a.get("transaction_category");var c=a.getFolder();var d=c.isMetathread()&&c.get("type");return b||d||""};u.prototype.getPriorityDate=function(a){return a.get("dates_metadata.priority_date.timestamp",void 0)};return u}(d.default.Mediator);exports.CalendarManager=u;exports.default=d.default.Mediator.createFromClass("calendar-manager",u)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/calls-manager",["require","exports","feast","mail/Message","mail/Thread","pilotjs","service/calls","service/compose","service/notify","ui-block/compose-dropdown/compose-dropdown","ui-block/contextmenu-message/contextmenu-message","ui-block/dropdown-actions/dropdown-actions","../lazy.modules"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CallsManager=void 0;a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);var l=["calls:invite","calls:invitenew"];var m=function(a){__extends(m,a);function m(){return a!==null&&a.apply(this,arguments)||this}m.prototype.getComponentsSpec=function(){return{router:{class:d.default},letter:{lazy:k.lazyUILetter,events:l},"contextmenu-message":{class:i.default,events:l},"dropdown-actions":{class:j.default,events:l},"compose-dropdown":{class:h.default,events:l}}};m.prototype.handleEvent=function(a){var c=a.type;var d=a.details.model;var e=this.get("router.model.letter");var f={type:c};var g=f.type.split(":").pop();if(g==="invitenew"){return this.doAction(g,b.default.getSafe())}return this.doAction(g,d||e)};m.prototype.doAction=function(a,b){if(!b){return false}if(b instanceof c.default&&b.get("messages.length")){b=b.getExpandMessage()}var d=a==="invitenew"?{mode:"new",subject:e.default.getSubject()}:{mode:"replyall",model:b};f.default.open(d);e.default.createRoom().then(function(a){var b=e.default.getTemplate(a);if(f.default.isComposeActive()){f.default.insertHtml(b)}else{f.default.open(__assign(__assign({},d),{body:b,additionalOptions:{prefilledBody:true}}))}}).catch(function(a){if(a==="ratelimit"){g.default.error({text:i18n("Достигнут лимит создания звонков. Попробуйте позже.")},"compose-notify")}else{g.default.error({text:i18n("Не удалось создать ссылку на звонок")},"compose-notify")}});return false};return m}(a.default.Mediator);exports.CallsManager=m;exports.default=a.default.Mediator.createFromClass("calls-manager",m)});var __extends=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c))a[c]=b[c]};return a(b,c)};return function(b,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");a(b,c);function d(){this.constructor=b}b.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d)}}();var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("mediator/welcome-block-manager",["require","exports","@mail/flags","default-values","feast","helpers/getCurrentTimestamp","helpers/opener","helpers/rb","mail/Folder","models/welcome-block-letter/welcome-block-letter","pilotjs","service/radars/index","ui-block/dataset/dataset","ui-block/dataset-letters/dataset-letters","ui-block/list-letter-welcome/list-letter-welcome","ui-block/list-letter-welcome-dropdown-actions/list-letter-welcome-dropdown-actions","ui-block/list-letter-welcome-suggestions/list-letter-welcome-suggestions"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.WelcomeBlockManager=void 0;a=__importDefault(a);c=__importDefault(c);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importStar(l);m=__importStar(m);n=__importStar(n);o=__importStar(o);var p="welcome-block";function q(a){return a.details&&a.details.hasOwnProperty("skill")}var r=function(c){__extends(r,c);function r(){var a=c!==null&&c.apply(this,arguments)||this;a.pollingWeatherPid=null;a.canShowChecked=false;return a}r.prototype.getComponentsSpec=function(){return{router:{class:i.default,events:["routeend"],handleEvent:"handleRouteEvent"},"dataset-letters":{class:l.default,events:[l.DatasetLettersEvents.NewRange]},dataset:{class:k.default},"list-letter-welcome":{class:m.default,events:[m.Events.MOUNT,m.Events.HIDE]},"list-letter-welcome-suggestions":{class:o.default,events:[o.Events.SuggestionClick],handleEvent:"handleMarusiaEvent"},"list-letter-welcome-dropdown-actions":{class:n.default,events:[n.Events.PIN,n.Events.SELECT_GEO,n.Events.SNOOZE]}}};r.prototype.handleMarusiaEvent=function(a){if(!q(a)){return false}switch(a.details.skill){case"music":{break}}return false};r.prototype.handleRouteEvent=function(){var a=this.get("router");if(!a||!this.isVisible()){return}var b=a.route.is("#letters")||a.model.uiLayout.type==="3pane"&&a.model.uiLayout.support3pane&&a.route.is("#read-letter");if(!b||a.route.params.folder!==g.default.INBOX){this.hide();(0,j.default)(["ll-wlcm","hide-on","route"])}};r.prototype.handleEvent=function(a){var c,d,f,h;var i=this.get("router");switch(a.type){case l.DatasetLettersEvents.NewRange:var k=a.details.start;if(this.isVisible()&&((c=i===null||i===void 0?void 0:i.route)===null||c===void 0?void 0:c.params.folder)===g.default.INBOX&&k>b.WELCOME_BLOCK_SCROLL_HIDE_THRESHOLD){this.hide();(0,j.default)(["ll-wlcm","hide-on","scroll"])}break;case m.Events.MOUNT:if(!this.canShowChecked){this.canShowChecked=true;if(this.canShow()){this.show();(0,j.default)(["ll-wlcm","can-show"])}else{(0,j.default)(["ll-wlcm","cannot-show"])}}if((d=this.getModel())===null||d===void 0?void 0:d.is("visible")){this.startPollingWeather()}if((f=this.getModel())===null||f===void 0?void 0:f.is("withGreeting")){this.delayedHideGreeting()}break;case m.Events.SHOW:if((h=this.getModel())===null||h===void 0?void 0:h.is("visible")){this.startPollingWeather()}break;case m.Events.HIDE:this.stopPollingWeather();break;case n.Events.PIN:break;case n.Events.SELECT_GEO:(0,e.default)(b.SELECT_GEO_URL+"?from=mailwelcome");break;case n.Events.SNOOZE:this.hide(true);(0,j.default)(["ll-wlcm","hide-on","snooze"]);break}return false};r.prototype.startPollingWeather=function(){var a=this;if(!this.pollingWeatherPid){this.fetchWeather();this.pollingWeatherPid=window.setInterval(function(){a.fetchWeather()},b.WELCOME_BLOCK_UPDATE_WEATHER_INTERVAL*1e3)}};r.prototype.stopPollingWeather=function(){window.clearInterval(this.pollingWeatherPid);this.pollingWeatherPid=null};r.prototype.delayedHideGreeting=function(){var a=this;window.setTimeout(function(){var b;(b=a.getModel())===null||b===void 0?void 0:b.set("withGreeting",false)},b.WELCOME_BLOCK_HIDE_GREETING_TIMEOUT*1e3)};r.prototype.fetchWeather=function(){var a=this;f.default.getSlot("t1189").then(function(b){var c=a.getModel();c===null||c===void 0?void 0:c.set("weatherData",b)})};r.prototype.getFlag=function(){return a.default.get(p)};r.prototype.isSnoozed=function(){return this.getFlag().getCount("show")%2===1};r.prototype.getModel=function(){return h.default.all[0]};r.prototype.updateDataset=function(){var a=this;setTimeout(function(){var b;(b=a.get("dataset"))===null||b===void 0?void 0:b.updateItems()})};r.prototype.canShow=function(){var a=this.getFlag();var c=a.getTime();var e=this.isSnoozed()?b.WELCOME_BLOCK_SNOOZE_INTERVAL:b.WELCOME_BLOCK_SHOW_INTERVAL;var f=(0,d.getCurrentTimestamp)();return f>c+e};r.prototype.isVisible=function(){var a;return(a=this.getModel())===null||a===void 0?void 0:a.is("visible")};r.prototype.show=function(){var a;var b=this.isVisible();(a=this.getModel())===null||a===void 0?void 0:a.set("visible",true);this.updateDataset();if(!b){var c=this.getFlag();var d=this.isSnoozed();c.save({time:true,hit:d})}};r.prototype.hide=function(a){var b;if(a===void 0){a=false}if(this.isVisible()){(b=this.getModel())===null||b===void 0?void 0:b.set("visible",false);this.updateDataset();var c=this.getFlag();var d=a&&!this.isSnoozed();c.save({time:true,hit:d})}};return r}(c.default.Mediator);exports.WelcomeBlockManager=r;exports.default=c.default.Mediator.createFromClass("welcome-block-manager",r)});define("helpers/logger",["exports","@mail/features","helpers/parse","logger","mail/Attachment","service/notify","service/radars/index","./create-message-form-data"],function(exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sendLogs=y;var h=m(a);var i=m(c);var j=m(d);var k=m(e);var l=m(f);function m(a){return a&&a.__esModule?a:{default:a}}var n=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c){if(Object.prototype.hasOwnProperty.call(c,d)){a[d]=c[d]}}}return a};var o=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function p(a,b){var c=new Blob([a],{type:"text/plain"});c.name=b;return c}var q=h.default.getAsJSON("logger-config",{});var r={Body:true,Subject:true,body:true,"body.html":true,subject:true,name:true,signature:true,translate_query:true,token:true};if(q.ignoreKeys){Object.assign(r,q.ignoreKeys)}var s={"/api/v1/utils/translate":{query:true}};if(q.ignoreUrlKeys){Object.assign(s,q.ignoreUrlKeys)}var t={insert_success:{result:true},success:{jqXHR:true,direct:true,target:true}};var u=parseInt(q.maxDepth,10)||10;var v=function a(b){if(b&&(typeof b==="undefined"?"undefined":o(b))==="object"){return b.length}return void 0};var w=function a(b,c){var d=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var e=arguments.length>3&&arguments[3]!==undefined?arguments[3]:r;if(!b){return b}if((typeof b==="undefined"?"undefined":o(b))!=="object"){return b}if(b.toLogJSON){b=b.toLogJSON()}if(c&&t[c]){e=n({},e,t[c])}return Object.keys(b).reduce(function(c,f){var g=b[f];if(f==="url"&&s[g]){e=n({},e,s[g])}if((typeof g==="undefined"?"undefined":o(g))==="object"){if(e[f]){c[f]=v(g);return c}if(d<=u&&!(g&&g.nodeType)){c[f]=a(g,null,d+1,e);return c}}else{c[f]=e[f]?v(g):g}return c},{})};i.default.filterArguments=w;function x(){var a={in_code:window.__trackJS.__errors,external:window.__trackJS.__externalErrors};var c={errors:a,loadLog:window.loadlogSteps};try{var d=f.radarService.loadPerformanceLog();if(Array.isArray(d)){d.slice().sort(function(a,b){if(a.startTime&&b.startTime&&a.startTime!==b.startTime){return a.startTime-b.startTime}return a.endTime-b.endTime})}else{(0,l.default)("invalid_notarr_perflog")}if((0,b.parseStringToBoolean)(q.inlinePerfLog)){i.default.add(JSON.stringify(d))}else{c.perfLog=d}}catch(a){i.default.add(a);console.error(a)}c.logs=(0,b.parseStringToBoolean)(q.usePrint)?i.default.print(true):i.default.entries;var e=void 0;try{e=JSON.stringify(c)}catch(a){i.default.add(a);console.error(a)}var m=h.default.get("email_logs_to");if(m&&m.data){m=m.data.split(",")}else{m=["aleksandr.tsvetkov@corp.mail.ru"]}var n=m[0];var o=m.slice(1,m.length);var r=(0,g.createMessageFormData)({subject:"[octavius client logs]",priority:1,body:{text:"",html:""},correspondents:{to:[{email:n}],cc:o.map(function(a){return{email:a}})}});var s=void 0;try{s=j.default.from(p(e,"logs.json"))}catch(a){r.set("body.html",e);console.error(a);(0,l.default)("log_file_create_fail")}var t=s?r.addAttachment(s):Promise.resolve();t.then(function(){return r.send()}).then(function(){if(k.default.isReady()){k.default.add({qa:"sent-logs",text:i18n("Логи отправлены")})}}).catch(function(a){console.error(a);(0,l.default)("logs_send_fail");k.default.add({type:k.default.types.error,text:i18n("Логи не отправлены")})})}function y(){require(["default-values"],function(a){if(a.ENABLE_LOGGING){x()}})}});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/visibility-watcher",["require","exports","@mail/xray","data-source/index","default-values","service/adv/config","service/smokescreen"],function(require,exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.VisibilityAlertWatcher=void 0;a=__importDefault(a);b=__importDefault(b);e=__importDefault(e);var f=c.VISIBILITY_WATCHER_CONFIG.errThreshold,g=c.VISIBILITY_WATCHER_CONFIG.checkTimeout,h=c.VISIBILITY_WATCHER_CONFIG.disabled;var i={left:function(a,b){return b-a},right:function(a,b){return a-b},top:function(a,b){return b-a},bottom:function(a,b){return a-b}};var j={left:function(){return 0},top:function(){return 0},right:function(){var b=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--vkui--octavius_size_layout_width_min--regular"));if(isNaN(b)){a.default.send("visibility_check_width_nan");return window.innerWidth}return Math.max(window.innerWidth,b)},bottom:function(){return window.innerHeight}};var k=Object.keys(i);function l(){var a;var c=b.default.getData();return{adv:{hasBlocker:(0,d.hasBlocker)(),hasAdBlock:(0,d.hasAdBlock)(),smokescreenEnabled:e.default.isEnabled()},layout:c.uiLayout,route:{href:(a=c.request)===null||a===void 0?void 0:a.href}}}var m=function(){function b(b){var c=b.name,d=b.timeout,e=d===void 0?g:d,f=b.once,h=f===void 0?true:f;var i=this;this.alertIfNotVisible=function(){i.didCheck=true;var b=i.getElementDocumentOverflow();if(b.some(function(a){return a.hasWindowOverflow||a.hasDocumentOverflow})){a.default.send("visibility_check_".concat(i.name),{rlog:"octavius_vis-check_".concat(i.name),rlog_message:{directionsChecks:b,meta:l()}})}};this.name=c;this.timeout=e;this.once=h}b.prototype.schedule=function(a){if(h||this.once&&this.didCheck){return}this.getEl=a;this.timeoutID=window.setTimeout(this.alertIfNotVisible,this.timeout)};b.prototype.unschedule=function(){window.clearTimeout(this.timeoutID)};b.prototype.getElementDocumentOverflow=function(){var a=this.getEl().getBoundingClientRect();var b=document.documentElement.getBoundingClientRect();return k.map(function(c){var d=b[c];var e=a[c];var g=j[c]();var h=i[c](e,d);var k=i[c](e,g);var l=h>f;var m=k>f;return{direction:c,hasWindowOverflow:m,hasDocumentOverflow:l,documentOverflow:h,windowOverflow:k,elementSide:e,documentSide:d,windowSide:g}})};return b}();exports.VisibilityAlertWatcher=m});define("feast-tpl!app/feast-tpl!ui-block/drag-and-drop/drag-and-drop.html",["feast"],function(a){return a.smartParse("<div></div>\n","app/feast-tpl!ui-block/drag-and-drop/drag-and-drop.html")});define("feast-tpl!ui-block/drag-and-drop/drag-and-drop.html",["feast-tpl!app/feast-tpl!ui-block/drag-and-drop/drag-and-drop.html"],function(a){return a});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/create-message-with-attach",["require","exports","service/auth","service/compose","service/layer","service/radars/index","trackJS","./check-files-from-event","./create-message-form-data","./signature"],function(require,exports,a,b,c,d,e,f,g,h){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importStar(f);var i="<div><br/></div>";function j(){var b=(0,g.createMessageFormData)();b.set("features.subject_from_attachments",true);var c=(0,h.getHTMLSignature)(a.default.user);b.set("body.html",i+i+c);return{formData:b}}function k(a,c){var d=c.slice(0,a.MAX_ATTACHMENTS_COUNT);b.default.add(a,{isDragAndDrop:true,dragAndDropItem:{files:d}})}function l(a){return __awaiter(this,void 0,void 0,function(){var g,h,i,l,m,n;return __generator(this,function(o){switch(o.label){case 0:g=c.default.getInstance();if(g){g.onHide()}o.label=1;case 1:o.trys.push([1,3,,4]);h=j().formData;return[4,(0,f.default)({event:a,limit:h.MAX_ATTACHMENTS_COUNT})];case 2:i=o.sent(),l=i.files,m=i.error;if(m){if(m===f.CheckFilesError.MAX_FILES){c.default.open("max-attach-count",{onAttachClick:function(){return k(h,l)}},{})}return[2]}k(h,l);(0,d.default)("dnd_create_msg_success");return[3,4];case 3:n=o.sent();b.default.onFailSent({},n);if(n&&n.get){(0,d.default)("dnd_create_msg_err",n.status)}else{e.default.addErrorFromApp(n,"dnd-create-msg")}return[3,4];case 4:return[2]}})})}exports.default=l});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("helpers/save-file-to-yourself",["require","exports","default-values","service/auth","service/compose","service/layer","service/radars/index","trackJS","./check-files-from-event","./check-oversize-files","./create-message-form-data","./signature"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importStar(g);var k="<div><br/></div>";function l(){var a=(0,i.createMessageFormData)();var c=b.default.user.attributes.name,d=c.first,e=c.last;var f=(0,j.getHTMLSignature)(b.default.user);a.set("body.html",k+k+f);var g=b.default.user.getEmail();var h=d||"";if(e){h="".concat(h," ").concat(e)}a.set("correspondents.to",[{email:g,name:h||g}]);a.set("features.subject_from_attachments",true);return{formData:a}}function m(b,d){var e=d.slice(0,b.MAX_ATTACHMENTS_COUNT);return(0,h.checkOversizeFiles)(e).then(function(d){var f=!(a.OVERSIZE_CLOUD_ATTACHES&&d);c.default.add(b,{autosend:f,isDragAndDrop:true,dragAndDropItem:{files:e}})})}function n(a){return __awaiter(this,void 0,void 0,function(){var b,h,i,j,k,n;return __generator(this,function(o){switch(o.label){case 0:b=d.default.getInstance();if(b){b.onHide()}o.label=1;case 1:o.trys.push([1,3,,4]);h=l().formData;return[4,(0,g.default)({event:a,limit:h.MAX_ATTACHMENTS_COUNT})];case 2:i=o.sent(),j=i.files,k=i.error;if(k){if(k===g.CheckFilesError.MAX_FILES){d.default.open("max-attach-count",{onAttachClick:function(){return m(h,j)}},{})}return[2]}m(h,j);(0,e.default)("dnd_to_yourself_success");return[3,4];case 3:n=o.sent();c.default.onFailSent({},n);if(n&&n.get){(0,e.default)("dnd_send_self_msg_err",n.status)}else{f.default.addErrorFromApp(n,"dnd-to-yourself")}return[3,4];case 4:return[2]}})})}exports.default=n});var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/drag-and-drop/drag-and-drop",["require","exports","@mail/features","cfg","default-values","feast","feast-tpl!./drag-and-drop.html","helpers/create-message-with-attach","helpers/load-file-to-cloud","helpers/save-file-to-yourself","service/compose","service/layer","service/radars/index","service/smokescreen"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);exports.default=d.default.Block.extend({name:"drag-and-drop",template:e.default,_getContainer:function(){return document.querySelector("#drag-and-drop")},attrChanged:{"dark-mode":function(a){if(this.ui){this.ui.$set({darkMode:a})}}},didMount:function(){var a=this;require(["mediator/themes-manager"],function(b){var c=b.default;c.registerInstanceByName("drag-and-drop",a)});this.renderUI()},didUnmount:function(){this.unrenderUI()},renderUI:function(){var a=this;this.unrenderUI();new Promise(function(a,b){require(["cross.project.dnd"],a,b)}).then(__importStar).then(function(b){var c=b.default;a.ui=c(a.getParams())})},unrenderUI:function(){var a;(a=this.ui)===null||a===void 0?void 0:a.$destroy();this.ui=null},getParams:function(){var a={"unsafe-markOpen":"<mark>","unsafe-markClose":"</mark>","unsafe-br":"<br>"};var d=i18n("Перетащите файлы в эту область,{br}чтобы {markOpen}написать письмо{markClose}",a);var e=i18n("Отправить {markOpen}письмо себе{markClose}",a);var i=i18n("Загрузить {markOpen}в Облако{markClose}",a);var j=this.is("dark-mode");var l=!!b.default.qa;return{target:this._getContainer(),darkMode:j,isQA:l,zones:[{size:1.5,zones:[{size:1,text:d,radarFunction:function(){return(0,k.default)("dnd_drop_create_letter")},iconSize:"large",iconName:"mail",dropFunction:f.default,testId:"drop-zone-mail"}]},{size:1,zones:__spreadArray([{size:1,text:e,radarFunction:function(){return(0,k.default)("dnd_drop_to_yourself")},iconSize:"small",iconName:"self-mail",dropFunction:h.default,testId:"drop-zone-self-mail"}],c.DND_CLOUD_ENABLED?[{size:1,text:i,radarFunction:function(){return(0,k.default)("dnd_drop_to_cloud")},iconSize:"small",iconName:"cloud",dropFunction:g.default,testId:"drop-zone-cloud"}]:[],true)}],showRule:this._getShowRule(),onShow:this.showRadar,imgsBaseUrl:b.default.urls.packagesUrl,imgsPath:c.DND_IMAGES_PATH}},showRadar:function(){(0,k.default)("dnd_show")},_getShowRule:function(){var b=this;var c=a.default.has("drag-and-drop");if(!c){return function(){return false}}return function(){var a;var c=j.default.getInstance();var d=document.querySelectorAll((0,l.selector)('[data-test-id="popup-wrapper"]')).length!==0;var e=b.get("router").model.route&&b.get("router").model.route.is("#attachment #attachment-temporary #attachment-editor");var f=(a=window===null||window===void 0?void 0:window.__PH)===null||a===void 0?void 0:a.authForm.isVisible();return!i.default.isComposeActive()&&!c&&!d&&!e&&!f}}})});var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(a){return a instanceof c?a:new c(function(b){b(a)})}return new(c||(c=Promise))(function(c,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?c(a.value):e(a.value).then(g,h)}i((d=d.apply(a,b||[])).next())})};var __generator=this&&this.__generator||function(a,b){var c={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},d,e,f,g;return g={next:h(0),throw:h(1),return:h(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function h(a){return function(b){return i([a,b])}}function i(g){if(d)throw new TypeError("Generator is already executing.");while(c)try{if(d=1,e&&(f=g[0]&2?e["return"]:g[0]?e["throw"]||((f=e["return"])&&f.call(e),0):e.next)&&!(f=f.call(e,g[1])).done)return f;if(e=0,f)g=[g[0]&2,f.value];switch(g[0]){case 0:case 1:f=g;break;case 4:c.label++;return{value:g[1],done:false};case 5:c.label++;e=g[1];g=[0];continue;case 7:g=c.ops.pop();c.trys.pop();continue;default:if(!(f=c.trys,f=f.length>0&&f[f.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!f||g[1]>f[0]&&g[1]<f[3])){c.label=g[1];break}if(g[0]===6&&c.label<f[1]){c.label=f[1];f=g;break}if(f&&c.label<f[2]){c.label=f[2];c.ops.push(g);break}if(f[2])c.ops.pop();c.trys.pop();continue}g=b.call(a,c)}catch(a){g=[6,a];e=0}finally{d=f=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:true}}};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("actions/autoreply",["require","exports","@mail/jssdk/next/action/global","RPC"],function(require,exports,a,b){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.fetchAutoreply=exports.url=void 0;b=__importDefault(b);exports.url="filters/autoreply";function c(a){var c=a.emails,d=a.only_enabled,e=d===void 0?true:d;if(!c){return Promise.reject({emails:"required"})}if(!Array.isArray(c)){return Promise.reject({emails:"invalid"})}return b.default.call(exports.url,{emails:c,only_enabled:e})}exports.fetchAutoreply=(0,a.createGlobalAction)(exports.url,function(a){return __awaiter(void 0,void 0,Promise,function(){var b;return __generator(this,function(d){switch(d.label){case 0:return[4,c(a)];case 1:b=d.sent();return[2,b.body]}})})})});define("feast-tpl!app/feast-tpl!ui-block/compose-app/compose-app.html",["feast"],function(a){return a.smartParse('<div qa:id="{(attrs[\'window-mode\'] === \'collapsed\') ? \'\' : \'compose-app\'}"\n\t qa:state="extended:{attrs[\'support-extend\'] && attrs.extended}"\n\t message-uid="{attrs.form.uid}">\n\t<bem:mod name="fix"/>\n\t<bem:mod name="fullscreen" test="attrs.fullscreen"/>\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\t<bem:mod name="mobile-xxs" test="attrs[\'mobile-xxs\']"/>\n\t<bem:mod name="popup" test="!attrs.fullscreen"/>\n\t<bem:mod name="popup-extended" test="attrs[\'support-extend\'] && attrs.extended"/>\n\t<bem:mod name="window" test="attrs[\'window-mode\'] === \'window\'"/>\n\t<bem:mod name="collapsed" test="attrs[\'window-mode\'] === \'collapsed\' || attrs.hidden"/>\n\t<bem:mod name="adaptive" test="attrs.adaptive && !attrs.fullscreen"/>\n\t<bem:mod name="fixed" test="!attrs.adaptive && !attrs.fullscreen"/>\n\n\t<b:focus-zone\n\t\t\tfluid\n\t\t\tenabled="{attrs[\'window-mode\'] !== \'collapsed\' && !attrs[\'focusoff\'] && !attrs[\'hidden\']}"\n\t\t\tbem:block="compose-app"\n\t\t\tremit:first="focus-zone:first"\n\t\t\tremit:last="focus-zone:last">\n\t\t<fn:match name="content">\n\t\t\t\x3c!--<div bem:elem="wrapper" ref="wrapper">--\x3e\n\t\t\t\t<div\n\t\t\t\t\t\tbem:elem="compose"\n\t\t\t\t\t\tref="compose"\n\t\t\t\t>\n\t\t\t\t\t\x3c!-- COMPOSE.MAIL.RU --\x3e\n\t\t\t\t</div>\n\t\t</fn:match>\n\t</b:focus-zone>\n</div>\n',"app/feast-tpl!ui-block/compose-app/compose-app.html")});define("feast-tpl!ui-block/compose-app/compose-app.html",["feast-tpl!app/feast-tpl!ui-block/compose-app/compose-app.html"],function(a){return a});define("helpers/char-to-key",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=a;function a(a){return String.fromCharCode(a).toLowerCase()}});define("helpers/scrollbar-width",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=function a(){var b=document.createElement("div");b.style.overflowY="scroll";b.style.msOverflowStyle="scrollbar";b.style.width="50px";b.style.height="50px";b.style.visibility="hidden";document.body.appendChild(b);var c=b.offsetWidth-b.clientWidth;document.body.removeChild(b);return c}();exports.default=a});define("helpers/translation",["exports","default-values"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isCyrillic=b;function b(b){var c=b.length;var d=0;var e=0;for(var f=0;f<c;){var g=b.charCodeAt(f++);if(g>1040&&g<1103){d++;e++;continue}if(g>0&&g<64){continue}if((g&63488)==55296&&f<c){var h=b.charCodeAt(f++);if((h&64512)==56320){continue}}e++}return d*100/e>a.LETTER_CYRILLIC_PERCENT}});define("mail/actions/Schedule",function(require){"use strict";var a=require("Action"),b=require("RPC");var c=a.extend({operation:function(a){switch(a.method){case c.UPDATE:return this._update(a.data);case c.REMOVE:return this._remove(a.data);default:throw new Error("Действие не найдено",a.method)}},_update:function(a){return b.post("messages/schedule/update",a)},_remove:function(a){return b.post("messages/schedule/remove",a)}});c.UPDATE="UPDATE";c.REMOVE="REMOVE";a.register("mail.Schedule",c);c.version="0.2.0";return c});define("tab-indexes",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=exports.compose={LABEL_TO:-1,LABEL_CC:-1,LABEL_BCC:-1,INPUT_ATTACH_FILE:-1,INPUT_TO:100,INPUT_CC:200,INPUT_BCC:300,INPUT_SUBJECT:400,BUTTON_ATTACH_FILE:500,EDITOR:505,EDITOR_ADDLINK_HREF:510,EDITOR_ADDLINK_TEXT:515,EDITOR_ADDLINK_SAVE:520,EDITOR_ADDLINK_CANCEL:525,EDITOR_ADDLINK_DELETE:530,BUTTON_SEND:570,BUTTON_SAVE:580,BUTTON_CANCEL:590,BUTTON_COLLAPSE:600,BUTTON_EXTEND:650,BUTTON_CLOSE:700,HEAD_CONTROL_FROM:710,HEAD_CONTROL_CC:720,HEAD_CONTROL_BCC:730,BUTTON_CLOSE_CC:900,BUTTON_CLOSE_BCC:1100,BUTTON_MONEY_SEND:1300,BUTTON_ATTACH_CLOUD:1400,BUTTON_ATTACH_MAIL:1500,DROPDOWN_TEMPLATES:1600}});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/compose-app/compose-app",["require","exports","@mail/contact-validation","@mail/features","@mail/flags","actions/autoreply","actions/checkContactsPossessing","actions/lastSeen","cfg","cloud/Entry","default-values","Emitter","feast","feast-mod/file-count","feast-mod/file-size","feast-mod/letter-date","feast-tpl!./compose-app.html","helpers/browser","helpers/char-to-key","helpers/on-oversize-attach-add","helpers/opener","helpers/scrollbar-width","helpers/signature","helpers/translation","lazy.modules","logger","mail/actions/ContactSuggests","mail/actions/Schedule","mail/Alias","mail/Attachment","mail/Collector","mail/Folder","mail/Message","mail/MessageFormData","mrg-xray","RPC","service/addressbook/addressbook","service/auth","service/calls","service/cloud","service/compose","service/emoji","service/fishing","service/lastseenStrings","service/layer","service/mailbox/loader","service/notify","service/radars/decorator","service/radars/index","service/smokescreen","service/storage","service/viewer","tab-indexes","trackJS","ui-block/button-link/button-link","ui-block/button2/button2","ui-block/focus-zone/focus-zone","ui-block/react-async/react-async"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,aa,ba,ca){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importStar(a);b=__importDefault(b);c=__importDefault(c);g=__importDefault(g);h=__importDefault(h);j=__importDefault(j);k=__importDefault(k);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);C=__importDefault(C);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);I=__importDefault(I);J=__importDefault(J);K=__importDefault(K);L=__importDefault(L);M=__importDefault(M);N=__importDefault(N);O=__importDefault(O);P=__importDefault(P);Q=__importDefault(Q);R=__importDefault(R);S=__importDefault(S);T=__importDefault(T);U=__importStar(U);W=__importDefault(W);X=__importDefault(X);Z=__importDefault(Z);_=__importDefault(_);aa=__importDefault(aa);ba=__importDefault(ba);ca=__importDefault(ca);exports.default=k.default.Block.extend((0,T.default)({events:[{name:"send",rename:function(a){return a.is("schedule")?"send_scheduled":"send"},data:function(a){return a.get("form")}},{name:"collapse"},{name:"mount",data:function(a){return a.get("form")}},{name:"close",data:function(a){return a.get("form")}}],explicit:true})({name:"compose-app",template:o.default,isolateEvents:false,performanceTrace:true,mods:{letterHours:n.letterHours},blocks:{button2:aa.default,"button-link":_.default,"focus-zone":ba.default,"react-async":ca.default},notVisualAttributes:{closing:true},defaults:{focusoff:false,form:null,"send-delay":0,"has-changes":false,"draft-on-close-enabled":true,"draft-timeout":i.AUTOSAVE_DRAFT_TIMEOUT_SECONDS,"template-enabled":false,saving:false,sending:false,fullscreen:false,mobile:i.TOUCH_MODE,ponymode:false,adaptive:false,hidden:false,"expand-status":false,closing:false,"translate-mode":false,darkMode:false,extended:false,"support-extend":true,autosend:false,"is-drag-and-drop":false,"drag-and-drop-item":null,errors:null,receipt:false,priority:3,schedule:false,scheduleDate:new Date,collectors:[],aliases:[]},events:{send:"onSend",save:"_updateComposeFields",shortcut:"onShortcut","nav:draft":"onNavDraft","nav:template":"onNavTemplate","focus-zone:first":"onRequestFirstFocus","focus-zone:last":"onRequestLastFocus","translation:use":"onTranslationSave","translation:cancel":"onTranslationCancel","translation:retry":"onTranslationRetry","first-render":"onFirstRender"},attrChanged:{errors:function(a){this.errors=a;this.composeRender()},priority:function(a){var b=this.get("form");b.set("priority",a);this.set("has-changes",true)},receipt:function(a){var b=this.get("form");b.set("receipt",a);this.set("has-changes",true)},sending:function(a,b){if(a!==b&&!a){this.get("form").set("finalized",false)}this.composeRender()},ponymode:function(){this.composeRender()},darkMode:function(){this.composeRender()},extended:function(){this.composeRender()},"mobile-xxs":function(){this.composeRender()},"support-extend":function(){this.composeRender()},"expand-status":function(){this._updateComposeVisuals()},"window-mode":function(){this.composeRender()},hidden:function(a){if(!a){this._setupFocus()}},sendDate:function(a){if(a){this.set({schedule:a,scheduleDate:new Date(a*1e3)})}this.composeRender()},schedule:function(a){var b=this.get("form");if(a){b.set("send_date",(this.get("scheduleDate").getTime()+"").slice(0,-3))}else{b.set("send_date","")}this.composeRender();this.set("has-changes",true)},scheduleDate:function(a){var b=this;new Promise(function(a,b){require(["ui-react"],a,b)}).then(__importStar).then(function(c){if(!b.isMounted()){return}var d=c.default;var e=b.get("form");if(b.get("schedule")){e.set("send_date",(a.getTime()+"").slice(0,-3));b.set("scheduleText",d.getFullMomentFormat(a))}b.set("has-changes",true);b.composeRender()})},remind:function(a){var b=this.get("form");b.set("remind",a);this.set("has-changes",true)},"draft-on-close-enabled":function(a){this.setAutosaveOnClose(a)}},tabIndexes:Y.compose,constructor:function(a,b){k.default.Block.call(this,a,b);this.onWindowUnload=this.onWindowUnload.bind(this);this.composeRender=this.composeRender.bind(this);this._updateComposeVisuals=this._updateComposeVisuals.bind(this);this._setupFocus=this._setupFocus.bind(this);this._changeTranslateMode=this._changeTranslateMode.bind(this);this.emitter=new j.default;this.emitter.on("translate-mode",this._changeTranslateMode);this.emitter.on("translation-error",this.onTranslationError.bind(this));this.emitter.on("translation-ok",this.onTranslationOk.bind(this))},didMount:function(){(0,U.default)("on_route_compose");this.composeRender()},composeRender:function(){var j=this;var k=this.get("compose-options");var o=this.get("form");var q=J.default.user.get("signs");var s=J.default.user.getEmail();var u=J.default.user.get("name");var z="".concat(u.first," ").concat(u.last);if(i.LOG_EMPTY_COLLECTORS&&!this.get("collectors")){G.default.send("empty-cltrs-compose",{rlog:"empty-collectors",rlog_message:{collectors:typeof this.get("collectors"),place:"composeRender"}})}var D=(this.get("collectors")||[]).filter(function(a){return a.canSendLetters()});var I=this.get("aliases");var K=this.is("support-extend")?this.onExtend.bind(this):null;this.onClose=this.onClose.bind(this);this.onCollapse=this.onCollapse.bind(this);this.sendLetter=this.sendLetter.bind(this);this.onReadyToSave=this.onReadyToSave.bind(this);this.onFilesFromCloud=this.onFilesFromCloud.bind(this);this.onFilesFromMail=this.onFilesFromMail.bind(this);this.onCallsInvite=this.onCallsInvite.bind(this);this.onCallTo=this.onCallTo.bind(this);this.onContactsFromMail=this.onContactsFromMail.bind(this);this.openAddressbook=this.openAddressbook.bind(this);this.onSignatureFromMail=this.onSignatureFromMail.bind(this);this.onTemplateSelect=this.onTemplateSelect.bind(this);this.onSaveAsTemplate=this.onSaveAsTemplate.bind(this);this.onExceedMaxSize=this.onExceedMaxSize.bind(this);this.onComposeCreateTo=this.onComposeCreateTo.bind(this);this.onSearchFrom=this.onSearchFrom.bind(this);this.onContactAdd=this.onContactAdd.bind(this);this.onOpenAddressbook=this.onOpenAddressbook.bind(this);this.updateMailboxQuotas=this.updateMailboxQuotas.bind(this);this.lastSeenUpdate=this.lastSeenUpdate.bind(this);this.onSend=this.onSend.bind(this);this.onTranslationSave=this.onTranslationSave.bind(this);this.onTranslationCancel=this.onTranslationCancel.bind(this);this.onChangePriority=this.onChangePriority.bind(this);this.onChangeReceipt=this.onChangeReceipt.bind(this);this.onClickRemind=this.onClickRemind.bind(this);this.onChangeRemind=this.onChangeRemind.bind(this);this.onClickSchedule=this.onClickSchedule.bind(this);this.onChangeSchedule=this.onChangeSchedule.bind(this);this.onTranslationRetry=this.onTranslationRetry.bind(this);Promise.all([(0,w.lazyFileAPI)(),(0,w.lazyClipboard)(),M.default.preload(),new Promise(function(a,b){require(["ui-react"],a,b)}).then(__importStar)]).then(function(u){var w=u[0],G=u[1],M=u[2].ui,P=u[3].default.PromtAboutAdWrapper;if(!j.isMounted()){return}var Q=D.concat(I);j.compose=new M.default(j.refs.compose);j.compose.injectDependencies(__assign(__assign({Attachment:B.default,cloud:L.default,Alias:A.default,Collector:C.default,CloudEntry:h.default,Message:E.default,MessageFormData:F.default,FileAPI:w,RPC:H.default,ContactSuggests:y.default,checkContactsPossessing:e.checkContactsPossessing,Phishing:O.default},i.PROMT_LOGO_WITH_AD_DROPDOWN&&{PromtAboutAdWrapper:P}),{Clipboard:G,TabIndex:Y.compose,browser:p.default,features:{CKE_ENABLE_TAB:i.CKE_ENABLE_TAB,CKE_DEFAULT_STYLES:i.CKE_DEFAULT_STYLES,CKE_ATTACH_BASE64:i.CKE_ATTACH_BASE64,CKE_CLIPBOARD_FIX:i.CKE_CLIPBOARD_FIX,CKE_AUTOCORRECT_AFTER_DELETE_CONTENTS_DISABLED:i.CKE_AUTOCORRECT_AFTER_DELETE_CONTENTS_DISABLED,CKE_AUTOCORRECT_ALPHABET_LIST:i.CKE_AUTOCORRECT_ALPHABET_LIST,CKE_QUOTE_PARSE_FIX_DISABLE:i.CKE_QUOTE_PARSE_FIX_DISABLE,COMPOSE_EMOJI:i.COMPOSE_EMOJI,COMPOSE_EMOJI_FILTER:i.COMPOSE_EMOJI_FILTER,COMPOSE_EMOJI_RECENTLY_COUNT:i.COMPOSE_EMOJI_RECENTLY_COUNT,COMPOSE_SLIDER_LAST_STEP_DELTA:i.COMPOSE_SLIDER_LAST_STEP_DELTA,COMPOSE_TRANSLATOR:i.COMPOSE_TRANSLATOR,CORRESPONDENTS_LIMIT:i.CORRESPONDENTS_LIMIT,DISABLE_CALLS_COMPOSE_TIP:i.DISABLE_CALLS_COMPOSE_TIP,DISABLE_CLOUD:i.COMPOSE_DISABLE_CLOUD_ATTACHES,DISABLE_FROM_MAIL_ATTACHES:i.DISABLE_FROM_MAIL_ATTACHES,EMOJI_FALLBACK:i.EMOJI_FALLBACK,ENABLE_WYSIWYG_STICKY:i.ENABLE_WYSIWYG_STICKY,EXPIRED_ATTACHES_TOOLTIP:i.EXPIRED_ATTACHES_TOOLTIP,IS_NEW_ADDRESSBOOK:i.IS_NEW_ADDRESSBOOK,LETTER_TO_YOURSELF:i.LETTER_TO_YOURSELF,NEW_AB_SUGGEST:i.NEW_AB_SUGGEST,TRANSLATOR_REQUEST_TIMEOUT:i.TRANSLATOR_REQUEST_TIMEOUT,MAX_CLOUD_STOCK_SIZE_LIMIT:i.MAX_CLOUD_STOCK_SIZE_LIMIT,OVERSIZE_CLOUD_ATTACHES:i.OVERSIZE_CLOUD_ATTACHES,OVERSIZE_CLOUD_ATTACHES_FOLDER:i.OVERSIZE_CLOUD_ATTACHES_FOLDER,VK:i.VK,MESSAGES_ATTACHES_BLOBCLOUD:i.MESSAGES_ATTACHES_BLOBCLOUD,MESSAGES_ATTACHES_BLOBCLOUD_PATH:i.MESSAGES_ATTACHES_BLOBCLOUD_PATH,LASTSEEN_ONLINE_STATUS:i.LASTSEEN_ONLINE_STATUS,TOUCH_MODE:i.TOUCH_MODE,COMPOSE_FETCH_AUTOREPLY:i.COMPOSE_FETCH_AUTOREPLY,ENABLE_MENTIONS:i.ENABLE_MENTIONS,MENTIONS_MARK:i.MENTIONS_MARK,WEBVIEW:i.WEBVIEW,B2B_INNER_ATTACHMENTS_NOTIFY:i.B2B_INNER_ATTACHMENTS_NOTIFY,FAKE_BUTTON_TYPE:i.FAKE_BUTTON_TYPE,FAKE_NOTE_IN_CONTACTS:i.FAKE_NOTE_IN_CONTACTS,FAKE_BUTTON_DISCUSS_DOCUMENT:i.FAKE_BUTTON_DISCUSS_DOCUMENT,FAKE_BUTTON_SIGNING:i.FAKE_BUTTON_SIGNING,FAKE_GOS_TEMPLATE_SUGGESTION:i.FAKE_GOS_TEMPLATE_SUGGESTION},ContactValidation:a,radar:(0,U.createConfiguredRadar)({prefix:"cmps",data:o}),onError:function(a,b){Z.default.addErrorFromApp(a,b?"cmps_".concat(b):"cmps_internal_caught")},logger:x.default,scrollbarWidth:t.default,Storage:W.default,mods:{fileSize:m.fileSize,fileSizeRange:m.fileSizeRange,fileCount:l.fileCount,letterAttachLinkDate:n.letterAttachLinkDate},flags:c.default,emojiParser:N.default}));var R=b.default.get("isNativeStickyDisabled");var S=b.default.get("compose-expand-contacts");var T=j.get("router");j.compose.render({signatures:q,fromOptions:Q,defaultEmail:s,userName:z,model:o,scrollTarget:j.refs.compose,templatesFetch:j.templatesFetch,lastSeenUpdate:j.lastSeenUpdate,suggestFinder:j.getSuggestFinder(),onFilesFromCloud:j.onFilesFromCloud,onFilesFromMail:j.onFilesFromMail,onCallsInvite:i.CALLS&&!i.CALLS_DISABLE_COMPOSE_BTN?j.onCallsInvite:null,onCallTo:i.CALLS?j.onCallTo:undefined,onContactsFromMail:j.onContactsFromMail,onSignatureFromMail:j.onSignatureFromMail,onReadyToSave:j.onReadyToSave,onClose:j.onClose,onExtend:K,fetchAutoreply:d.fetchAutoreply,fetchLastSeen:f.fetchLastSeen,onComposeCreateTo:j.onComposeCreateTo,onSearchFrom:j.onSearchFrom,onTemplateSelect:j.onTemplateSelect,onSaveAsTemplate:j.onSaveAsTemplate,onExceedMaxSize:j.onExceedMaxSize,onCollapse:j.onCollapse,onContactAdd:j.onContactAdd,onOpenAddressbook:j.onOpenAddressbook,onOversizeAttachAdd:r.default,onAttachmentClick:function(a){if(i.DISABLE_COMPOSE_ATTACHMENT_CLICK){return}if(a.isCloudStock()||a.isCloud()){return}X.default.openTemporary({messageId:o.uid,formData:o,router:T,attachment:a})},updateMailboxQuotas:j.updateMailboxQuotas,isNativeStickyDisabled:R&&R.state,isNativeAttachThumbRotation:i.IS_COMPOSE_NATIVE_ATTACH_THUMB_ROTATION,isAllVisibleContactsFeature:S&&S.state,onChangeErrors:j.onChangeErrors,sendLetter:j.sendLetter,errors:j.errors||null,disableInterface:j.get("window-mode")==="collapsed"?true:j.get("sending"),eventEmitter:j.emitter,darkMode:j.get("darkMode"),extended:j.get("extended"),compressedMode:j.get("ponymode")&&!j.get("mobile-xxs"),isTouch:j.get("mobile"),mobilePhoneLayout:j.get("mobile-xxs"),qaParams:{enabled:g.default.get("qa")},additionalOptions:k,utils:{isCyrillic:v.isCyrillic},schedule:j.get("schedule"),scheduleText:j.get("scheduleText"),onSend:j.onSend.bind(j),onSave:j.onClickSave.bind(j),onTranslationUse:j.onTranslationSave,onTranslationCancel:j.onTranslationCancel,onChangePriority:j.onChangePriority,onChangeReceipt:j.onChangeReceipt,onClickRemind:j.onClickRemind,onChangeRemind:j.onChangeRemind,onClickSchedule:j.onClickSchedule,onChangeSchedule:j.onChangeSchedule,onTranslationRetry:j.onTranslationRetry,onFooterChooseTemplateClick:j.onFooterChooseTemplateClick.bind(j),translationHref:j.getPromtLogoHref(),avatarBaseUrl:g.default.get("urls.avatarUrl"),quotasEnabled:J.default.user.get("common_purpose_flags.enabled_mbox_quotas"),hideAvatar:i.COMPOSE_HIDE_AVATAR&&j.get("mobile-xxs"),unclickableLabels:i.COMPOSE_DISABLE_CLICKABLE_LABELS&&j.get("mobile-xxs"),hideToolbar:i.COMPOSE_DISABLE_TOOLBAR&&j.get("mobile-xxs"),shortAttachPanel:i.COMPOSE_SHORT_ATTACH_PANEL&&j.get("mobile-xxs"),hideChangeSignature:i.HIDE_CHANGE_SIGNATURE&&j.get("mobile-xxs"),hideCancelButton:i.HIDE_COMPOSE_CANCEL_BUTTON&&j.get("mobile-xxs"),hideWidgets:i.HIDE_COMPOSE_WIDGETS&&j.get("mobile-xxs"),footerDropdown:i.COMPOSE_FOOTER_DROPDOWN&&j.get("mobile-xxs")});if(!j.hasRendered){j.broadcast("first-render");j.hasRendered=true}})},onFirstRender:function(){var a=this;if(this.get("is-drag-and-drop")){var b=this.get("drag-and-drop-item");if(b){var c=b.files;if(this.compose.appComponent){this.compose.appComponent.addFilesToModel(c).then(function(b){if(a.get("autosend")){a.broadcast("send")}a.compose.appComponent.uploadFiles(b)}).catch(function(b){a.radar("dnd_err_".concat(b))})}}}},onContactAdd:function(a){a.scope="compose-notify";this.broadcast("addressbook:addcontact",a)},onOpenAddressbook:function(a){this.openAddressbook({"free-space":false,composeMode:false,openEmail:a.email},true)},onChangeErrors:function(a){this.errors=a},onSend:function(){var a=this.get("form");this._updateComposeFields();a.set("body.html",(0,u.cleanHTMLSignature)(a.get("body.html")),{silent:true});var b=this.get("autosend");var c=b?true:this.compose.appComponent.checkSend();if(c){this.sendLetter()}},getSuggestFinder:function(){if(i.NEW_AB_SUGGEST){return null}return I.default.lazyInit()},lastSeenUpdate:function(a){if(!i.LAST_SEEN_V2_ENABLE){return null}var b=this.get("getLastSeen");G.default.send("lastseen-v2-compose",{skipdwh:true});var c=i.LASTSEEN_COMPOSE_ALLOW_GARAGE;return b(a,{allowUseGarage:c}).then(function(b){var c=b.payload;var d=a.map(function(a){var b=c[a];return(0,P.default)(b).then(function(b){return{email:a,lastSeen:b}})});return Promise.all(d)})},sendLetter:function(){if(this.get("schedule")){this.broadcast("letter-schedule",{composeApp:this,scheduleText:this.get("scheduleText")})}else{this.broadcast("letter-send")}},templatesFetch:function(){return R.default.load({folder:D.default.TEMPLATES,limit:25}).catch(function(){return{threads:[]}}).then(function(a){return a.threads.map(function(a){var b=a.subject||a.snippet;return{data:{folder:a.folder,id:a.expand,value:b.trim()?b:"<".concat(i18n("Без темы"),">")}}})})},onTemplateSelect:function(a){var b=this;var c=a.id,d=a.folder;var e=this.get("form");e.fetchTemplate({id:c,folder:d}).then(function(a){if(e.is("source.reply")||e.is("source.forward")){var c=e.mergeTemplate(a,{attachments:true});b.compose.applyTemplate(c)}else{b.broadcast("close",Object.assign(b,{noAnimate:true}));M.default.open({mode:"template",model:a})}})},didUnmount:function(){this.setAutosaveInterval(false);this.setAutosaveOnClose(false);try{this.compose.unmount()}catch(a){if(i.IS_DEBUG){console.error(a)}(0,U.default)({type:"compose_unmount_error",rlog:"octavius_jserror",rlog_message:JSON.stringify(a)})}},removeScheduleFromDatalist:function(a){var b=this.get("router");b.model.letters.filter(function(b){var c=b.getFolder();return c.isOutbox()&&b.get("last")===a}).forEach(function(a){b.model.letters.remove(a)})},removeSchedule:function(){var a=this;var b=this.get("form");var c=b.get("source.schedule");var d=b.get("source.draft");var e={id:c};if(d){e.source={draft:d}}z.default.execute({method:z.default.REMOVE,data:e}).then(function(){b.set("source.schedule","");b.set("source.draft",c);a.radar("remove_schedule");a.removeScheduleFromDatalist(c)}).catch(function(){a.radar("remove_schedule_error")})},onClickSave:function(){this._updateComposeFields();this.broadcast("letter-save")},onClickSchedule:function(a){var b=!this.get("schedule");var c=new Date(a);if(!b){c=new Date}this.set({schedule:b,scheduleDate:c});if(!b){this.removeSchedule()}this.composeRender()},onChangeSchedule:function(a){this.set({schedule:true,scheduleDate:new Date(a)})},onChangePriority:function(){this.set({priority:this.get("priority")===3?1:3})},onChangeReceipt:function(){this.set({receipt:!this.get("receipt")})},onClickRemind:function(a){var b=!!this.get("remind");this.set({remind:b?"":a})},onChangeRemind:function(a){this.set({remind:a})},onRequestFirstFocus:function(){var a=this.el.querySelector((0,V.selector)('[tabindex="'.concat(Y.compose.INPUT_SUBJECT,'"]')));a&&a.focus()},onRequestLastFocus:function(){var a=this.el.querySelector((0,V.selector)('[tabindex="'.concat(Y.compose.BUTTON_ATTACH_CLOUD,'"]')));a&&a.focus()},layerSingleton:function(a,b,c,d,e){var f=this;if(!this.activeLayer){this.activeLayer=new Promise(function(g,h){a.then(function(){if(!f.isMounted()){f.activeLayer=null;g();return}f.set("hidden",true);Q.default.open(b,c,{dimmer:false,resolvable:true}).then(function(a){if(f.isMounted()){f.set("hidden",false)}return a}).then(function(a){if(e){return e(a)}return Promise.resolve(a)}).then(function(a){return g(a)}).catch(function(a){d(a);if(f.isMounted()){f.set("hidden",false)}if(i.IS_DEBUG){console.error(a)}f.activeLayer=null;h(a);return Promise.reject(a)}).then(function(){f.activeLayer=null})},h)})}return this.activeLayer},onFilesFromCloud:function(a){var b=a.attachments,c=a.selectLimit,d=a.freeSpace;(0,U.default)("compose_cloud_click");return this.layerSingleton(new Promise(function(a,b){require(["ui-block/layer-explorer-from-cloud/layer-explorer-from-cloud"],a,b)}).then(__importStar),"explorer-from-cloud",{attachments:b,"select-limit":c,"free-space":d},function(){return(0,U.default)("explorer-cloud_error")})},onFooterChooseTemplateClick:function(){var a="compose-template-select";var b={fetchTemplates:this.templatesFetch,onChoose:this.onTemplateSelect};require(["ui-block/layer-compose-template-select/layer-compose-template-select"],function(){Q.default.open(a,b,{dimmer:false,resolvable:true,mobile:true})})},onContactsFromMail:function(a){var b=a.contacts,c=a.selectLimit,d=a.freeSpace;(0,U.default)("compose_contacts-search_click");var e=i.NEW_AB_COMPOSE_VIEW;return this.openAddressbook({contacts:b,"select-limit":c,"free-space":d,composeMode:e},i.NEW_AB_COMPOSE_VIEW)},openAddressbook:function(a){return this.layerSingleton(new Promise(function(a,b){require(["ui-block/layer-addressbook/layer-addressbook"],a,b)}).then(__importStar),"addressbook",__assign(__assign({},a),{router:this.get("router")}),function(){return(0,U.default)("new-addressbook-layer_error")})},onFilesFromMail:function(a){var b=a.attachments,c=a.selectLimit,d=a.freeSpace;(0,U.default)("compose_filesearch_click");return this.layerSingleton(new Promise(function(a,b){require(["ui-block/layer-explorer-from-filesearch/layer-explorer-from-filesearch"],a,b)}).then(__importStar),"explorer-from-filesearch",{attachments:b,"select-limit":c,"free-space":d},function(){return(0,U.default)("explorer-files_error")})},onCallTo:function(a){K.default.getCallsAPIClient().callTo([a]).then(function(a){if(a.redirectUrl){(0,s.default)(a.redirectUrl)}}).catch(function(a){x.default.add("onCallTo_compose_error",a);(0,U.default)({type:"onCallTo_compose_error",rlog:"onCallTo_compose_error",rlog_message:a})})},onCallsInvite:function(){return new Promise(function(a){K.default.createRoom().then(function(b){var c=K.default.getTemplate(b);a(c)}).catch(function(){S.default.error({text:i18n("Не удалось создать ссылку на звонок")},"compose-notify")})})},onSignatureFromMail:function(){(0,U.default)("compose_sign-edit_click");(0,s.default)(i.SIGNATURE_URL)},onWindowUnload:function(a){if(this.is("has-changes")||this.isUploadingAttachments()){var b=i18n("Текст письма будет потерян.");var c=Date.now();setTimeout(function(){var a=Date.now()-c;if(a<100){(0,G.default)("compose_unload_confirm_disabled&v=".concat(a),{immediately:true});x.default.add("compose_unload_confirm_disabled",{unloadConfirmDuration:a})}},0);(0,U.default)("compose_try_leave_with_unsaved");x.default.add("try to leave compose with unsaved changes");a.returnValue=b;return b}},onClose:function(){this.set("closing",true);if(this.is("translate-mode")){this.broadcast("save")}this.broadcast("close")},onExtend:function(){this.broadcast("extend")},onCollapse:function(){this._updateComposeFields();this.broadcast("collapse")},_updateComposeFields:function(){this.compose.updateFields()},_updateComposeVisuals:function(){if(this.compose){this.compose.updateVisuals()}},_setupFocus:function(){if(this.compose){this.compose.setupFocus()}},onSaveAsTemplate:function(){var a=this;this._updateComposeFields();return new Promise(function(b){a.broadcast("savetemplate",{composeApp:a,resolve:b})})},onExceedMaxSize:function(){this.broadcast("exceedmaxsize")},onAutoSave:function(){if(!this.isMounted()){this.setAutosaveInterval(false);return}if(this.get("saving")){return}this._updateComposeFields();this.broadcast("autosave")},onReadyToSave:function(){this.set("has-changes",true);this.setAutosaveInterval(true)},onShortcut:function(a){var b=a.originalEvent;var c=false;var d=b;var e=d.metaKey||d.ctrlKey;if(e&&d.keyCode==13){(0,U.default)("compose_action_send_shortcut");this.broadcast("send")}if(e&&(0,q.default)(d.keyCode)==="s"){(0,U.default)("compose_action_save_shortcut");this.broadcast("save");c=true}c&&d.preventDefault();return!!c},onNavDraft:function(){this.broadcast("collapse");this.get("router").go("#letters",{folder:D.default.DRAFTS})},onNavTemplate:function(){this.broadcast("collapse");this.get("router").go("#letters",{folder:D.default.TEMPLATES})},onTranslationOk:function(){this.get("form").set({"translation-error":null,"translation-first-ok":true})},onTranslationError:function(a){var b="some-error";if(a.status===Number(H.default.statuses.many_requests)){b="many-requests"}var c=this.showTranslationNotify("error");this.emitter.one("translation-ok",function(){c===null||c===void 0?void 0:c.close()});this.get("form").set("translation-error",b)},onTranslationCancel:function(){this.compose.disableTranslate(false);this.get("form").clearTranslation()},onTranslationSave:function(){var a=this;this.compose.disableTranslate(true);var b=this.showTranslationNotify("saved");this.emitter.one("translate-mode",function(a){a&&(b===null||b===void 0?void 0:b.close())});b===null||b===void 0?void 0:b.on("action",function(){a.compose.revertTranslation();b.close()})},onTranslationRetry:function(){this.compose.translate()},showTranslationNotify:function(a){var b="";var c=S.default.types.default;var d=[];if(a==="ok"){b=i18n("Переведено")}if(a==="loading"){b=i18n("Переводим...")}if(a==="error"){b=i18n("Не удалось перевести текст");c=S.default.types.error}if(a==="saved"){b=i18n("Вы перевели письмо");d=[{text:i18n("Отменить")}]}var e={text:b,type:c,actions:d,unique:true};return S.default.add(e,"compose-notify")},_changeTranslateMode:function(a){this.get("form").set({"translate-mode":a,"translation-first-ok":false})},onComposeCreateTo:function(a){this._updateComposeFields();this.broadcast("collapse",Object.assign(this,{noAnimate:true}));M.default.open({correspondents:{to:[a]}})},onSearchFrom:function(a){this._updateComposeFields();this.broadcast("collapse");this.get("router").go("#search",{},{q_from:a})},setAutosaveInterval:function(a){if(!a){clearTimeout(this._saveDraftTimeoutId);this._saveDraftTimeoutId=void 0;if(i.IS_DEBUG){console.warn("[compose-app]","Таймер автосохранения остановлен.")}return}if(!this.isMounted()){if(i.IS_DEBUG){console.warn("[compose-app]","Не удалось запустить таймер автосохранения: компонент не в DOM!")}return}if(!this._saveDraftTimeoutId){var b=this.get("draft-timeout")*1e3;this._saveDraftTimeoutId=setInterval(this.onAutoSave.bind(this),b);if(i.IS_DEBUG){console.warn("[compose-app]","Запущен таймер автосохранения. Таймаут",b,"мс")}}},setAutosaveOnClose:function(a){if(!a){window.removeEventListener("beforeunload",this.onWindowUnload);return}window.addEventListener("beforeunload",this.onWindowUnload)},getDraftUrl:function(){return this.get("router").getUrl("#letters",{folder:D.default.DRAFTS})},getTemplateUrl:function(){return this.get("router").getUrl("#letters",{folder:D.default.TEMPLATES})},isUploadingAttachments:function(){var a=this.get("form");return a.isUploadingAttachments()},insertHtml:function(a){if(this.compose.appComponent){this.compose.appComponent.insertHtml(a)}},updateMailboxQuotas:function(a,b){J.default.user.set("mbox_quotas.".concat(a),b);if(a==="attach"){this.get("form").resetSpaceLeft()}},getPromtLogoHref:function(){return i.PROMT_LOGO_HREF}}))});define("feast-tpl!app/feast-tpl!ui-block/compose-windows/compose-windows.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="visible" value="{attrs.items.length > 0}"/>\n\t<fn:var name="collapsedCnt" value="{attrs.items.length - (attrs.active ? 1 : 0)}"/>\n\t<fn:var name="rise" value="{attrs.rise}"/>\n\n\t<bem:mod name="hidden" test="!visible"/>\n\t<bem:mod name="fullscreen" test="attrs.fullscreen"/>\n\t<bem:mod name="rise" test="rise"/>\n\n\t<bem:mod name="animate-open" test="attrs[\'animate-open\']"/>\n\t<bem:mod name="animate-close" test="attrs[\'animate-close\']"/>\n\t<bem:mod name="animate-expand" test="attrs[\'animate-expand\']"/>\n\t<bem:mod name="animate-collapse" test="attrs[\'animate-collapse\']"/>\n\n\t<bem:mod name="show-mobile-footer" test="attrs[\'show-mobile-footer\']"/>\n\n\t<bem:mod name="new-toolbar" test="_this.useNewToolbar()"/>\n\n\t<fn:if test="visible">\n\t\t<b:dimmer fn:if="attrs.active"\n\t\t\t\t  remit:click="window-collapse"\n\t\t\t\t  event:details="false"\n\t\t/>\n\n\t\t<fn:for data="attrs.items" as="item">\n\t\t\t<b:compose-app\n\t\t\t\t\tuse:mediator="compose-manager addressbook-manager themes-manager"\n\t\t\t\t\tkey="compose-{item.formData.uid}"\n\t\t\t\t\tid="{\'compose-\' + item.formData.uid}"\n\t\t\t\t\tform="{item.formData}"\n\t\t\t\t\twindow-mode="{attrs.active == item.formData.uid ? \'window\' : \'collapsed\'}"\n\t\t\t\t\texpand-status="{attrs.active == item.formData.uid && attrs[\'expand-status\']}"\n\t\t\t\t\trouter="{attrs.router}"\n\t\t\t\t\tpriority="{item.formData.get(\'priority\')}"\n\t\t\t\t\treceipt="{item.formData.get(\'receipt\')}"\n\t\t\t\t\tremind="{item.formData.get(\'remind\')}"\n\t\t\t\t\tsendDate="{item.formData.get(\'send_date\')}"\n\t\t\t\t\tcollectors="{_this._getCollectors()}"\n\t\t\t\t\taliases="{_this._getAliases()}"\n\t\t\t\t\tadaptive="{attrs.adaptive}"\n\t\t\t\t\tfullscreen="{attrs.fullscreen}"\n\t\t\t\t\tmobile-xxs="{attrs[\'mobile-xxs\']}"\n\t\t\t\t\tponymode="{attrs.ponymode}"\n\t\t\t\t\tsupport-extend="{attrs[\'support-extend\']}"\n\t\t\t\t\textended="{attrs.extended}"\n\t\t\t\t\tcompose-options="{item.additionalOptions}"\n\t\t\t\t\tautosend="{item.autosend}"\n\t\t\t\t\tsaving="{item.formData.isSaving}"\n\t\t\t\t\tis-drag-and-drop="{item.isDragAndDrop}"\n\t\t\t\t\tdrag-and-drop-item="{item.dragAndDropItem}"\n\t\t\t\t\tremit:open="window-open"\n\t\t\t\t\tremit:close="window-close"\n\t\t\t\t\tremit:collapse="window-collapse"\n\t\t\t\t\tremit:extend="window-extend"\n\t\t\t\t\tremit:autosave="letter-autosave"\n\t\t\t\t\tremit:savetemplate="letter-savetemplate"\n\t\t\t\t\tremit:exceedmaxsize="letter-exceedmaxsize"\n\t\t\t/>\n\t\t</fn:for>\n\n\t\t<b:compose-collapsed\n\t\t\t\tfn:if="collapsedCnt"\n\t\t\t\titems="{_this.getCollapsed(attrs.items)}"\n\t\t\t\tmultiple="{false}"\n\t\t\t\tmobile="{attrs.active && attrs.overlap}"\n\t\t\t\tcompact="{_this.isCompactCollapsed()}"\n\t\t\t\tabove-paginator="{_this.isAbovePaginator() && !_this.isCompactCollapsed()}"\n\t\t/>\n\t</fn:if>\n\n\t<div bem:elem="notify"\n\t\t qa:id="compose-notify-stack"\n\t\t qa:state="rise:{rise}">\n\t\t<b:notify-stack ref="compose-notify" id="compose-notify" fixed />\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/compose-windows/compose-windows.html")});define("feast-tpl!ui-block/compose-windows/compose-windows.html",["feast-tpl!app/feast-tpl!ui-block/compose-windows/compose-windows.html"],function(a){return a});define("helpers/autocomplete",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(a,b){var c=document.createElement("iframe");c.setAttribute("name","autocomplete_iframe");c.style.display="none";document.body.appendChild(c);var d=document.createElement("form");d.setAttribute("target","autocomplete_iframe");d.setAttribute("action","about:blank");d.style.position="absolute";d.style.top="-9999px";d.setAttribute("tabindex","-1");document.body.appendChild(d);var e=document.createElement("input");e.setAttribute("name",a);e.setAttribute("value",b);e.setAttribute("type","text");d.appendChild(e);if(d.requestSubmit&&typeof d.requestSubmit==="function"){d.requestSubmit()}else{d.submit()}var f=function a(){d.remove();c.removeEventListener("load",a);c.remove()};c.addEventListener("load",f)}});define("helpers/email-length-postfix",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getEmailLengthPostfix=a;function a(a){switch(true){case a<100:{return"0"}case a<500:{return"100"}case a<1e3:{return"500"}case a<1e4:{return Math.floor(a/1e3)+"k"}case a<15e3:{return"10k"}case a<2e4:{return"15k"}case a<25e3:{return"20k"}case a<3e4:{return"25k"}case a<1e5:{return"30k"}case a<5e5:{return"100k"}case a<1e6:{return"500k"}case a<5e6:{return"1m"}case a<1e7:{return"5m"}default:{return Math.floor(a/1e6)+"m"}}}});define("helpers/user-track",["exports","default-values"],function(exports,a){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function b(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++){c[b]=a[b]}return c}else{return Array.from(a)}}function c(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||false;d.configurable=true;if("value"in d)d.writable=true;Object.defineProperty(a,d.key,d)}}return function(b,c,d){if(c)a(b.prototype,c);if(d)a(b,d);return b}}();var e={Alt:1,AltGraph:2,CapsLock:3,Control:4,Fn:5,Shift:6,Enter:7,Tab:8,Space:9,ArrowDown:10,ArrowLeft:11,ArrowRight:12,ArrowUp:13,End:14,Home:15,PageDown:16,PageUp:17,Escape:18,Backspace:19,Clear:20,Delete:21};var f={" ":"Space",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Esc:"Escape",Del:"Delete"};var g={passive:true,capture:true};var h=function(){function h(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},d=b.limit,e=d===undefined?a.COMPOSE_SEND_USER_TRACK_CONF[0]:d,f=b.trackMouseInterval,g=f===undefined?a.COMPOSE_SEND_USER_TRACK_CONF[1]:f;c(this,h);this.limit=e;this.trackMouseInterval=g;this.reset();this.trackMouse=this.trackMouse.bind(this);this.onMouseMove=this.onMouseMove.bind(this);this.onClick=this.onClick.bind(this);this.onKeyDown=this.onKeyDown.bind(this)}d(h,[{key:"reset",value:function a(){this.composes={};this.active={};this.lastPointerSpeed=0;this.lastPointerPositionX=0;this.lastPointerPositionY=0;this.mouseTrackLastEventTimestamp=0;this.currentPointerPositionX=0;this.currentPointerPositionY=0;this.trackMouseIntervalObj=null;this.mouseCaptured=false;this.started=false}},{key:"addEvent",value:function a(c,d,e){var f=this.composes[c];if(!f||!this.active[c]){return}var g=Date.now();var h=Math.max(g-f.lastEventTimestamp,0);f.lastEventTimestamp=g;f.events.push([d,h].concat(b(e)).join("|"));if(f.events.length>this.limit){f.events.shift()}}},{key:"hasComposes",value:function a(){return Object.keys(this.active).reduce(function(a,b){return b?a+1:a},0)>0}},{key:"addEvents",value:function a(b,c){var d=this;Object.keys(this.active).forEach(function(a){d.addEvent(a,b,c)})}},{key:"serialize",value:function a(b){var c=this.composes[b];if(!c){return""}return c.events.join(";")}},{key:"trackMouse",value:function a(){var b=Date.now();if(this.mouseCaptured){var c=Math.max(b-this.mouseTrackLastEventTimestamp,1);var d=this.currentPointerPositionX-this.lastPointerPositionX;var e=this.currentPointerPositionY-this.lastPointerPositionY;this.lastPointerPositionX=this.currentPointerPositionX;this.lastPointerPositionY=this.currentPointerPositionY;var f=Math.ceil(Math.sqrt(d*d+e*e));var g=f/c;var h=(g-this.lastPointerSpeed)/c;this.lastPointerSpeed=g;g=Math.ceil(g);h=Math.ceil(h);if(f||g||h){this.addEvents("m",[f,g,h])}}this.mouseTrackLastEventTimestamp=b;this.trackMouseIntervalObj=window.setTimeout(this.trackMouse,this.trackMouseInterval)}},{key:"onMouseMove",value:function a(b){this.currentPointerPositionX=b.clientX;this.currentPointerPositionY=b.clientY;this.mouseCaptured=true}},{key:"onClick",value:function a(b){this.addEvents("c",[b.button,b.clientX,b.clientY])}},{key:"onKeyDown",value:function a(b){var c=b.key;if(f[c]){c=f[c]}if(e[c]){this.addEvents("k",[e[c]])}}},{key:"addCompose",value:function a(b){this.composes[b]={events:[],lastEventTimestamp:Date.now()}}},{key:"removeCompose",value:function a(b){delete this.composes[b];delete this.active[b];if(!this.hasComposes()){this.stopTracking()}}},{key:"startComposeTrack",value:function a(b){if(!this.composes[b]){this.addCompose(b)}this.active[b]=true;this.startTracking()}},{key:"pauseComposeTrack",value:function a(b){if(!this.composes[b]){this.addCompose(b)}this.active[b]=false;if(!this.hasComposes()){this.stopTracking()}}},{key:"startTracking",value:function a(){if(this.started){return}document.body.addEventListener("keydown",this.onKeyDown,g);document.body.addEventListener("click",this.onClick,g);document.body.addEventListener("mousemove",this.onMouseMove,g);this.trackMouse();this.started=true}},{key:"stopTracking",value:function a(){if(this.trackMouseIntervalObj){window.clearInterval(this.trackMouseIntervalObj)}document.body.removeEventListener("keydown",this.onKeyDown,g);document.body.removeEventListener("click",this.onClick,g);document.body.removeEventListener("mousemove",this.onMouseMove,g);this.reset()}}]);return h}();var i=new h;exports.default=i});var __spreadArray=this&&this.__spreadArray||function(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++){if(f||!(d in b)){if(!f)f=Array.prototype.slice.call(b,0,d);f[d]=b[d]}}return a.concat(f||Array.prototype.slice.call(b))};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("service/compose-validators",["require","exports","lazy.modules","mail/Message","service/smokescreen"],function(require,exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);var d={checkOnMissingAttach:function(b){if(b.get("source.forward")||b.attachments.length){return Promise.resolve(false)}return(0,a.lazyMailTextAnalyzer)().then(function(a){return a.hasAttachment(d.getEnteredText(b.get("body.html")))})},checkOnRettachToReply:function(a){var c=this;var d=a.get("source.reply");if(!d){return Promise.resolve({})}var e=a.get("folder_id");return b.default.findOne({id:d,folder_id:e}).then(function(b){var d=c._hasNewEmails(b,a);var e=c._hasAttachToReattach(b);return{hasNewAttach:d&&e,source:b}})},getEnteredText:function(a){var b=document.createElement("div");b.innerHTML=a;Array.prototype.forEach.call(b.querySelectorAll((0,c.selector)("blockquote")),function(a){a.parentNode&&a.parentNode.removeChild(a)});Array.prototype.forEach.call(b.querySelectorAll((0,c.selector)("br")),function(a){if(a.parentNode){a.parentNode.insertBefore(document.createTextNode("\n"),a);a.parentNode.removeChild(a)}});return b.innerHTML},_hasNewEmails:function(a,b){var c=a.get("correspondents");var d=__spreadArray(__spreadArray(__spreadArray(__spreadArray([],c.from,true),c.to,true),c.cc,true),c.bcc,true).map(function(a){return a.email});var e=b.get("correspondents");var f=__spreadArray(__spreadArray(__spreadArray([],e.to,true),e.cc,true),e.bcc,true).map(function(a){return a.email});return f.some(function(a){return!d.includes(a)})},_hasAttachToReattach:function(a){var b=a.get("attaches.list");var c=["text/calendar","application/ics"];var d=new RegExp(/.ics$/);return b.some(function(a){return!c.includes(a.get("content_type"))&&!d.test(a.get("name"))})}};exports.default=d});define("feast-tpl!app/feast-tpl!ui-block/compose-collapsed/compose-collapsed.html",["feast"],function(a){return a.smartParse('<div qa:id="compose-collapsed">\n\t<fn:var name="messages" value="{_this.getMessages()}"/>\n\n\t<bem:mod name="multiple" test="attrs.multiple"/>\n\t<bem:mod name="empty" test="!attrs.items.length"/>\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\t<bem:mod name="compact" test="attrs.compact"/>\n\t<bem:mod name="above-paginator" test="attrs[\'above-paginator\']"/>\n\n\t<fn:for data="attrs.items" as="item" key="formKey">\n\t\t<div bem:elem="item"\n\t\t\t key="compose-collapsed-{item.formData.uid}"\n\t\t\t remit:click="window-expand"\n\t\t\t event:details="item.formData"\n\t\t\t qa:id="compose-collapsed-item:{item.formData.uid}">\n\n\t\t\t<fn:var name="isLast" value="{formKey === attrs.items.length - 1}"/>\n\t\t\t<div bem:elem="content">\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="label"\n\t\t\t\t\tpromo:id="{isLast ? \'compose-collapsed-label\' : \'\'}"\n\t\t\t\t>\n\t\t\t\t\t<span promo:id="{isLast ? \'compose-collapsed-icon\' : \'\'}">\n\t\t\t\t\t\t\x3c!-- in_viewport не работает на svg, поэтому нужен враппер для плашки --\x3e\n\t\t\t\t\t\t<b:ico\n\t\t\t\t\t\t\tname="compose"\n\t\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span bem:elem="title" qa:id="subject">\n\t\t\t\t\t\t<fn:value>\n\t\t\t\t\t\t\tattrs.multiple ?\n\t\t\t\t\t\t\t\ti18n(\'Черновики\') :\n\t\t\t\t\t\t\t\t(item.formData.get(\'subject\') || messages.draft(Object.fromEntries([[\'draftId\', formKey + 1]])))\n\t\t\t\t\t\t</fn:value>\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\n\t\t\t\t<div bem:elem="ico-close">\n\t\t\t\t\t<b:button2\n\t\t\t\t\t\tico="actions:close"\n\t\t\t\t\t\tsize="s"\n\t\t\t\t\t\tsecondary\n\t\t\t\t\t\tshort\n\t\t\t\t\t\tremit:click="collapsed-item-close"\n\t\t\t\t\t\tevent:details="item.formData"\n\t\t\t\t\t\tqa:id="close"\n\t\t\t\t\t\tcentered\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</fn:for>\n</div>\n',"app/feast-tpl!ui-block/compose-collapsed/compose-collapsed.html")});define("feast-tpl!ui-block/compose-collapsed/compose-collapsed.html",["feast-tpl!app/feast-tpl!ui-block/compose-collapsed/compose-collapsed.html"],function(a){return a});define("ui-block/compose-collapsed/compose-collapsed",["exports","feast","feast-tpl!./compose-collapsed.html","service/radars/decorator","ui-block/button2/button2","ui-block/ico/ico"],function(exports,a,b,c,d,e){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=k(a);var g=k(b);var h=k(c);var i=k(d);var j=k(e);function k(a){return a&&a.__esModule?a:{default:a}}exports.default=f.default.Block.extend((0,h.default)({events:[{name:"window-expand",rename:"expand"}]})({name:"compose-collapsed",blocks:{button2:i.default,ico:j.default},defaults:{compact:false,mobile:false},events:{},template:g.default,isolateEvents:false,getMessages:function a(){return{draft:function a(b){return i18n("Черновик {draftId}",b)}}}}))});define("feast-tpl!app/feast-tpl!ui-block/layer-sent-page/layer-sent-page.html",["feast"],function(a){return a.smartParse('<div qa:id="layer-sent-page">\n\t<fn:var name="message" value="{attrs.model}"/>\n\t<fn:var name="messageAttachments" value="{_this.getAttachments()}"/>\n\t<fn:var name="isReady" value="{_this.isReady()}"/>\n\t<fn:var name="slim" value="{attrs.slim}"/>\n\t<fn:var name="messages" value="{_this.getMessages()}"/>\n\t<fn:var name="timerValueText" value="{_this.get(\'delivery-cancel-timer-text\')}"/>\n\t<fn:var name="isNotifyVersion" value="{_this.get(\'is-notify-version\')}"/>\n\t<fn:var name="isDeliveryCancelVersion" value="{_this.get(\'is-delivery-cancel-version\')}"/>\n\t<fn:var name="cancellationResultText" value="{_this.get(\'cancellation-result-text\')}"/>\n\t<fn:var name="cancellationOver" value="{_this.get(\'is-cancellation-over\')}"/>\n\t<fn:var name="cancellationWithDraft" value="{_this.get(\'cancellation-with-draft\')}"/>\n\t<fn:var name="cancelShortcut" value="{_this.getCancelShortcut()}"/>\n\t<fn:var name="cancellationInProgress" value="{_this.get(\'is-cancellation-progress\')}"/>\n\t<fn:var name="isLetterCanceled" value="{_this.get(\'is-letter-canceled\')}"/>\n\t<fn:var name="openDraftFail" value="{_this.get(\'open-draft-fail\')}"/>\n\n\t<bem:mod name="slim" test="slim"/>\n\t<bem:mod name="mobile" test="attrs.mobile"/>\n\n\t\x3c!-- Поле Кому --\x3e\n\t<fn:match name="correspondents" args="contactString, dir">\n\t\t<fn:var name="contacts" value="{_this.getContactList(contactString)}"/>\n\t\t<fn:var name="contactList" value="{contacts}"/>\n\n\t\t<fn:for data="contactList" as="contact" key="contactKey">\n\t\t\t<fn:var name="key" value="{_this.getContactKey(contactKey, dir)}"/>\n\n\t\t\t<span\n\t\t\t\ttitle="{contact.email}"\n\t\t\t\tdata-id="{key}"\n\t\t\t\tbem:elem="contact-item"\n\t\t\t\tkey="{key}">\n\n\t\t\t\t<fn:value mod="correspondent">contact</fn:value>\n\t\t\t\t<fn:value>contactKey === contactList.length - 1 ? \' \': \', \'</fn:value>\n\t\t\t</span>\n\t\t</fn:for>\n\t</fn:match>\n\n\t\x3c!-- Поле получателей --\x3e\n\t<fn:if test="!isDeliveryCancelVersion">\n\t\t<fn:match name="recipients" args="message, more, expanded">\n\t\t\t<div bem:elem="recipients">\n\t\t\t\t<bem:mod name="more" value="{more > 0}"/>\n\t\t\t\t<bem:mod name="expanded" value="{expanded}"/>\n\n\t\t\t\t<div bem:elem="recipients-container" ref="recipients">\n\t\t\t\t\t<span bem:elem="recipient" fn:if="message.get(\'correspondents.to.length\')">\n\t\t\t\t\t\t<span bem:elem="recipient-field">{i18n(\'Кому\')}: </span>\n\t\t\t\t\t\t<fn:apply-match name="correspondents" args="message.get(\'to\'), \'to\'"/>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span bem:elem="recipient" fn:if="message.get(\'correspondents.cc.length\')">\n\t\t\t\t\t\t<span bem:elem="recipient-field">{i18n(\'Копия\')}: </span>\n\t\t\t\t\t\t<fn:apply-match name="correspondents" args="message.get(\'cc\'), \'cc\'"/>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<span bem:elem="recipient" fn:if="message.get(\'correspondents.bcc.length\')">\n\t\t\t\t\t\t<span bem:elem="recipient-field">{i18n(\'Скрытая\')}: </span>\n\t\t\t\t\t\t<fn:apply-match name="correspondents" args="message.get(\'bcc\'), \'bcc\'"/>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="recipients-more"\n\t\t\t\t\tfn:if="more > 0 && !expanded"\n\t\t\t\t\tremit:click="recipients-more:click">\n\t\t\t\t\t<fn:var name="contextMore" value="{Object.fromEntries([[\'more\', more]])}"/>\n\t\t\t\t\t<fn:value output="raw">messages.more(contextMore)</fn:value>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="recipient-more"\n\t\t\t\t\tfn:if="more > 0 && expanded"\n\t\t\t\t\tremit:click="recipients-more:click">\n\t\t\t\t\t<span class="layer__link">{i18n(\'Свернуть\')}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</fn:match>\n\t</fn:if>\n\n\t<fn:match name="controls" args="message, type" qa:id="controls">\n\t\t<div bem:elem="controls">\n\t\t\t<b:button2\n\t\t\t\tfn:if="type === \'error\'"\n\t\t\t\ttext="{i18n(\'Отправить ещё раз\')}"\n\t\t\t\tevent:details="message"\n\t\t\t\tremit:click="resend"\n\t\t\t\tqa:id="resend"\n\t\t\t/>\n\t\t\t<b:button2\n\t\t\t\tfn:if="type === \'error\'"\n\t\t\t\ttext="{i18n(\'Вернуться к письму\')}"\n\t\t\t\tevent:details="message"\n\t\t\t\tremit:click="compose-back"\n\t\t\t\tqa:id="compose-back"\n\t\t\t/>\n\n\t\t\t<fn:if test="isDeliveryCancelVersion">\n\t\t\t\t<div bem:elem="cancel">\n\t\t\t\t\t<fn:if test="!cancellationOver && !cancellationInProgress">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{timerValueText}"\n\t\t\t\t\t\t\ttitle="{i18n(\'Отменить отправку\')}"\n\t\t\t\t\t\t\tremit:click="cancel"\n\t\t\t\t\t\t\tshortcut="ctrl+z|command+z"\n\t\t\t\t\t\t\tqa:id="cancel"\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<p bem:elem="cancel-combination">{cancelShortcut}</p>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="cancellationInProgress">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{i18n(\'Идёт отмена отправки...\')}"\n\t\t\t\t\t\t\tqa:id="cancel-progress"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="cancellationOver && cancellationWithDraft && !openDraftFail">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{i18n(\'Открываю черновик...\')}"\n\t\t\t\t\t\t\tqa:id="draft-progress"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="cancellationOver && cancellationWithDraft && openDraftFail">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{i18n(\'Редактировать в черновике\')}"\n\t\t\t\t\t\t\tqa:id="draft-open-fail"\n\t\t\t\t\t\t\tremit:click="go-drafts"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="cancellationOver && !cancellationWithDraft">\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{i18n(\'Перейти во входящие\')}"\n\t\t\t\t\t\t\tremit:click="go-inbox"\n\t\t\t\t\t\t\tqa:id="go-inbox"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="!isDeliveryCancelVersion">\n\t\t\t\t<fn:choose>\n\t\t\t\t\t\x3c!-- Шаблон сохраняется --\x3e\n\t\t\t\t\t<fn:when test="attrs[\'template-status\'] === \'saving\'">\n\t\t\t\t\t\t<b:spinner small color="gray"/>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\x3c!-- Шаблон сохранили --\x3e\n\t\t\t\t\t<fn:when test="attrs[\'template-status\'] === \'saved\'">\n\t\t\t\t\t\t<span bem:elem="template-saved">\n\t\t\t\t\t\t\t<b:ico name="status:doneround"/>\n\t\t\t\t\t\t\t<span>{i18n(\'Шаблон сохранён\')}</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\x3c!-- Сохранение в шаблон не нажали --\x3e\n\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t<b:button2\n\t\t\t\t\t\t\ttext="{i18n(\'Сохранить в шаблон\')}"\n\t\t\t\t\t\t\tevent:details="message"\n\t\t\t\t\t\t\tremit:click="template"\n\t\t\t\t\t\t\tqa:id="template"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</fn:otherwise>\n\t\t\t\t</fn:choose>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Ссылка на звонок --\x3e\n\t<fn:match name="calls" args="message, link">\n\t\t<div bem:elem="calls" qa:id="calls">\n\t\t\t<fn:var name="calls" value="{message.get(\'calls\')}"/>\n\n\t\t\t<fn:if test="calls.length === 1">\n\t\t\t\t<span>{i18n(\'Ссылка на видеозвонок:\')}</span>\n\t\t\t\t<a\n\t\t\t\t\tbem:elem="calls-link"\n\t\t\t\t\thref="{calls[0]}"\n\t\t\t\t\ttarget="_blank"\n\t\t\t\t\trel="noopener"\n\t\t\t\t\tremit:click="calls-link"\n\t\t\t\t\tqa:id="calls-link"\n\t\t\t\t>\n\t\t\t\t\t{calls[0]}\n\t\t\t\t</a>\n\t\t\t\t<span\n\t\t\t\t\tbem:elem="calls-ico"\n\t\t\t\t\tqa:id="copy"\n\t\t\t\t\tremit:click="calls-copy"\n\t\t\t\t\tref="callsLinkCopy"\n\t\t\t\t\ttitle="{i18n(\'Скопировать ссылку\')}"\n\t\t\t\t>\n\t\t\t\t\t<b:ico secondary name="actions:copy" size="s"/>\n\t\t\t\t</span>\n\t\t\t</fn:if>\n\n\t\t\t<fn:if test="calls.length > 1 && !!link">\n\t\t\t\t<span>{i18n(\'В письме есть несколько ссылок на звонки.\') }</span>\n\t\t\t\t<a\n\t\t\t\t\tbem:elem="calls-link"\n\t\t\t\t\tremit:click="calls-message-link"\n\t\t\t\t\thref="{link}"\n\t\t\t\t\trel="noopener"\n\t\t\t\t\tqa:id="calls-message-link"\n\t\t\t\t>\n\t\t\t\t\t{i18n(\'Перейти в письмо\')}\n\t\t\t\t</a>\n\t\t\t</fn:if>\n\t\t</div>\n\t</fn:match>\n\n\t\x3c!-- Поле аттачей --\x3e\n\t<fn:if test="!isDeliveryCancelVersion">\n\t\t<fn:match name="attachments" args="attachments, more, expanded">\n\t\t\t<div bem:elem="attachments" qa:id="attachments:{attachments.length}">\n\t\t\t\t<bem:mod name="more" value="{more > 0}"/>\n\t\t\t\t<bem:mod name="expanded" value="{expanded}"/>\n\n\t\t\t\t<div bem:elem="attachments-container" ref="attachments">\n\t\t\t\t\t<fn:for data="attachments" as="attach" key="attachKey">\n\t\t\t\t\t\t<fn:var name="key" value="{_this.getAttachKey(attachKey)}"/>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tkey="{key}"\n\t\t\t\t\t\t\tbem:elem="attach-item"\n\t\t\t\t\t\t\tdata-id="{key}">\n\t\t\t\t\t\t\t<b:attach-filename model="{attach}"/>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</fn:for>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="attachments-more"\n\t\t\t\t\tfn:if="more > 0 && !expanded"\n\t\t\t\t\tremit:click="attachments-more:click">\n\t\t\t\t\t<fn:var name="contextMore" value="{Object.fromEntries([[\'more\', more]])}"/>\n\t\t\t\t\t<fn:value output="raw">messages.more(contextMore)</fn:value>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tbem:elem="attachments-more"\n\t\t\t\t\tfn:if="more > 0 && expanded"\n\t\t\t\t\tremit:click="attachments-more:click">\n\t\t\t\t\t<span class="layer__link">{i18n(\'Свернуть\')}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</fn:match>\n\t</fn:if>\n\n\t\x3c!-- Рекламный баннер --\x3e\n\t<fn:match name="banner">\n\t\t<div bem:elem="banner" ref="banner" qa:id="banner"></div>\n\t</fn:match>\n\n\t\x3c!-- Лейер не рисуем, если нужен только notify --\x3e\n\t<fn:if test="!isNotifyVersion">\n\t\t<fn:if test="!attrs.mobile">\n\t\t\t<b:layer\n\t\t\t\t\tremit:close="close"\n\t\t\t\t\thiddenfooter="{attrs[\'hide-ads\']}"\n\t\t\t\t\tclose\n\t\t\t\t\theader\n\t\t\t\t\tmedia\n\t\t\t\t\tcompose\n\t\t\t\t\twide="{!slim}"\n\t\t\t\t\tsize="{slim ? \'m\' : \'\'}"\n\t\t\t\t\tcenter>\n\n\t\t\t\t<fn:match name="header">\n\t\t\t\t\t<fn:if test="!attrs.error">\n\t\t\t\t\t\t<fn:if test="!isReady">\n\t\t\t\t\t\t\t<div qa:id="is-in-progress">\n\t\t\t\t\t\t\t\t{i18n(\'Письмо отправляется...\')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t\t<fn:if test="isReady">\n\t\t\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t\t<fn:when test="attrs.isLateSent">\n\t\t\t\t\t\t\t\t\t<div qa:id="is-schedule-sent">\n\t\t\t\t\t\t\t\t\t\t{messages.lateSent}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</fn:when>\n\n\t\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\tbem:elem="link"\n\t\t\t\t\t\t\t\t\t\t\thref="{attrs.link}"\n\t\t\t\t\t\t\t\t\t\t\tremit:click="link:click"\n\t\t\t\t\t\t\t\t\t\t\tqa:id="is-sent"\n\t\t\t\t\t\t\t\t\t\t\tfn:if="!isLetterCanceled"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{messages.sent}\n\t\t\t\t\t\t\t\t\t</a>\n\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\t\tbem:elem="link"\n\t\t\t\t\t\t\t\t\t\t\thref="{attrs.link}"\n\t\t\t\t\t\t\t\t\t\t\tremit:click="link:click"\n\t\t\t\t\t\t\t\t\t\t\tqa:id="is-canceled"\n\t\t\t\t\t\t\t\t\t\t\tfn:if="isLetterCanceled"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{cancellationResultText}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t\t</fn:choose>\n\t\t\t\t\t\t</fn:if>\n\t\t\t\t\t</fn:if>\n\t\t\t\t\t<fn:if test="attrs.error">\n\t\t\t\t\t\t<div qa:id="error">\n\t\t\t\t\t\t\t{i18n(\'При отправке письма произошла ошибка\')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:match>\n\t\t\t\t<fn:match name="content">\n\t\t\t\t\t<fn:if test="!isReady && !attrs.error">\n\t\t\t\t\t\t<b:spinner/>\n\t\t\t\t\t</fn:if>\n\n\t\t\t\t\t<fn:if test="isReady || attrs.error">\n\t\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\t\tname="recipients"\n\t\t\t\t\t\t\t\targs="message, attrs[\'recipients-more\'], attrs[\'recipients-expanded\']"/>\n\n\t\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\t\tname="calls"\n\t\t\t\t\t\t\t\tfn:if="!attrs[\'hide-calls\'] && message.get(\'calls\') && message.get(\'calls\').length"\n\t\t\t\t\t\t\t\targs="message, attrs.link"/>\n\n\t\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\t\tname="attachments"\n\t\t\t\t\t\t\t\tfn:if="messageAttachments && messageAttachments.length"\n\t\t\t\t\t\t\t\targs="messageAttachments, attrs[\'attachments-more\'], attrs[\'attachments-expanded\']"/>\n\n\t\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\t\tname="controls"\n\t\t\t\t\t\t\t\targs="message, attrs.error ? \'error\': \'ok\'"/>\n\t\t\t\t\t</fn:if>\n\t\t\t\t</fn:match>\n\t\t\t\t<fn:match name="footer">\n\t\t\t\t\t<fn:apply-match name="banner"/>\n\t\t\t\t</fn:match>\n\t\t\t</b:layer>\n\t\t</fn:if>\n\n\t\t<fn:if test="attrs.mobile">\n\t\t\t<b:layer-mobile media>\n\t\t\t\t<fn:match name="header">\n\t\t\t\t<span\n\t\t\t\t\t\tbem:elem="back"\n\t\t\t\t\t\tremit:click="layer:close">\n\t\t\t\t\t<b:button2 text="{i18n(\'Назад\')}"\n\t\t\t\t\t\t\t   ico="arrow-back"\n\t\t\t\t\t\t\t   pure\n\t\t\t\t\t\t\t   touch\n\t\t\t\t\t\t\t   short\n\t\t\t\t\t\t\t   text-center\n\t\t\t\t\t/>\n\t\t\t\t</span>\n\t\t\t\t\t<span bem:elem="title">\n\t\t\t\t\t<fn:choose>\n\t\t\t\t\t\t\t<fn:when test="attrs.isLateSent">\n\t\t\t\t\t\t\t\t{messages.lateSent}\n\t\t\t\t\t\t\t</fn:when>\n\t\t\t\t\t\t\t<fn:otherwise>\n\t\t\t\t\t\t\t\t{messages.sent}\n\t\t\t\t\t\t\t</fn:otherwise>\n\t\t\t\t\t\t</fn:choose>\n\t\t\t\t</span>\n\t\t\t\t</fn:match>\n\n\t\t\t\t<fn:match name="content">\n\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\tname="recipients"\n\t\t\t\t\t\t\targs="message, 0, true"/>\n\n\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\tname="calls"\n\t\t\t\t\t\t\tfn:if="!attrs[\'hide-calls\'] && message.get(\'calls\') && message.get(\'calls\').length"\n\t\t\t\t\t\t\targs="message, attrs.link"/>\n\n\t\t\t\t\t<fn:apply-match\n\t\t\t\t\t\t\tfn:if="messageAttachments.length"\n\t\t\t\t\t\t\tname="attachments"\n\t\t\t\t\t\t\targs="messageAttachments, 0, true"/>\n\t\t\t\t</fn:match>\n\n\t\t\t\t<fn:match name="footer">\n\t\t\t\t\t<fn:apply-match name="banner"/>\n\t\t\t\t</fn:match>\n\t\t\t</b:layer-mobile>\n\t\t</fn:if>\n\t</fn:if>\n</div>\n',"app/feast-tpl!ui-block/layer-sent-page/layer-sent-page.html")});define("feast-tpl!ui-block/layer-sent-page/layer-sent-page.html",["feast-tpl!app/feast-tpl!ui-block/layer-sent-page/layer-sent-page.html"],function(a){return a});define("feast-tpl!app/feast-tpl!ui-block/attach-filename/attach-filename.html",["feast"],function(a){return a.smartParse('<div>\n\t<span bem:elem="icon">\n\t\t<b:attach-icon name="{attrs.model.getExtension()}"/>\n\t</span>\n\t<span bem:elem="text">{attrs.model.get(\'name\')}</span>\n</div>\n',"app/feast-tpl!ui-block/attach-filename/attach-filename.html")});define("feast-tpl!ui-block/attach-filename/attach-filename.html",["feast-tpl!app/feast-tpl!ui-block/attach-filename/attach-filename.html"],function(a){return a});define("ui-block/attach-filename/attach-filename",["exports","feast","feast-tpl!./attach-filename.html","ui-block/attach-icon/attach-icon"],function(exports,a,b,c){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var d=g(a);var e=g(b);var f=g(c);function g(a){return a&&a.__esModule?a:{default:a}}exports.default=d.default.Block.extend({name:"attach-filename",template:e.default,blocks:{"attach-icon":f.default}})});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-sent-page/layer-sent-page",["require","exports","@mail/adman","data-source/index","default-values","feast","feast-mod/correspondents","feast-mod/utils","feast-tpl!./layer-sent-page.html","helpers/browser","lazy.modules","mail/Folder","mail/Message","service/adv/index","service/compose","service/notify","service/radars/decorator","service/radars/index","service/smokescreen","ui-block/attach-filename/attach-filename","ui-block/button2/button2","ui-block/ico/ico","ui-block/layer/layer","ui-block/layer-mobile/layer-mobile","ui-block/spinner/spinner"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importStar(d);g=__importStar(g);h=__importDefault(h);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);r=__importDefault(r);s=__importDefault(s);t=__importDefault(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);var x={ok:i18n("Вы отменили отправку письма"),fail:i18n("Не удалось отменить отправку"),openDraft:i18n("Отправка отменена, открываем черновик"),openDraftFail:i18n("Не удалось открыть черновик")};var y="command+z,ctrl+z";exports.default=d.Block.extend((0,o.default)({events:["calls-link","calls-copy","calls-message-link"]})((0,q.withWelter)({name:"layer-sent-page",template:g,clipboard:null,mods:{correspondent:e.correspondent},blocks:{layer:u.default,"attach-filename":r.default,button2:s.default,"layer-mobile":v.default,spinner:w.default,ico:t.default},events:{"attachments-more:click":"onAttachmentsToggle","recipients-more:click":"onRecipientsToggle","link:click":"onLinkClick","calls-message-link":"onLinkClick",close:"onClose",resend:"onResend","compose-back":"onComposeBack",template:"onTemplate","calls-copy":"onCallsCopyClick",cancel:"onCancel","go-inbox":"goToInboxFolder","go-drafts":"openDraft"},defaults:{mobile:false,visible:false,responsive:true,isLateSent:false,lateSentText:"",model:null,loading:false,error:false,"delay-visible":c.LAYER_SENT_PAGE_CONFIG.delayVisible,"hide-ads":c.HIDE_TOYS===c.BL_PROP_NAME,"hide-calls":c.DISABLE_CALLS_ON_SENT_PAGE,"loader-timeout-exceeded":false,"visibility-timeout-exceeded":false,"template-status":"idle","promo-disabled":false,"attachments-more":0,"attachments-expanded":false,"recipients-more":0,"recipients-expanded":false,"last-recipients-id":"","last-attachments-id":"","is-notify-version":false,"is-delivery-cancel-version":false,"delivery-cancel-timer-text":null,"cancellation-result-text":x.ok,"cancellation-interval":null,"is-cancellation-over":false,"cancellation-with-draft":false,"is-cancellation-progress":false,"is-letter-canceled":false,"timer-start":0,"prev-timer-value":0,"cancel-lifetime":0,"open-draft-fail":false},attrChanged:{visible:function(){this.isReady()&&this.redraw()},loading:function(){if(this.isMounted()){if(this.isReady()){this.redraw()}this.setVisibilityTimeout()}},error:function(a){if(a){this.is("visible")&&this.redraw();clearTimeout(this.visibleTimer)}},mobile:function(){this.isReady()&&this.redraw(true)},model:function(a){this._attachments=a.attachments.filter(function(a){return!a.isInline()})},"loader-timeout-exceeded":function(){this.isReady()&&this.redraw()},"visibility-timeout-exceeded":function(){if(this.isReady()){(0,p.default)("sent_close_timeout");this.onClose()}}},isReady:function(){return this.is("visible")&&!this.is("loading")&&!this.is("error")&&(this.is("loader-timeout-exceeded")||!this.loadingTimer)},redraw:function(a){var b=this;if(a===void 0){a=false}this.hideElements("attachments","layer-sent-page__attach-item",a);this.hideElements("recipients","layer-sent-page__contact-item",a);if(this.clipboard){this.clipboard.destroy()}var c=this.refs.callsLinkCopy;if(c){var d=this.get("model");var e=d===null||d===void 0?void 0:d.get("calls");if(!e||!e.length){return(0,p.default)([this.name,"calls","error","no-link-to-copy"])}c.setAttribute("data-clipboard-text",e[0]);(0,i.lazyClipboard)().then((0,i.uniqCallback)(this,function(a){b.clipboard=b.isMounted()?new a(c):null}))}this.sendCallsRadar()},hideElements:function(a,b,c){if(c===void 0){c=false}var d=this.refs[a];if(!d){return}var e=d.offsetWidth;if((c||!this.get("".concat(a,"-more")))&&d.scrollWidth>e){var f=d.getElementsByClassName(b);var g=0;while(g<f.length&&f[g].offsetLeft+f[g].offsetWidth<e){g++}if(g!==f.length){this.set("".concat(a,"-more"),f.length-g-1);this.set("last-".concat(a,"-id"),this.get("".concat(a,"-more"))>0?f[g].getAttribute("data-id"):"")}}(0,p.default)([this.name,a,"more",this.is("".concat(a,"-more")).toString()])},onAttachmentsToggle:function(){this.set("attachments-expanded",!this.is("attachments-expanded"));(0,p.default)([this.name,"attachments","more","click"])},onRecipientsToggle:function(){this.set("recipients-expanded",!this.is("recipients-expanded"));(0,p.default)([this.name,"recipients","more","click"])},onLinkClick:function(){var a=this;(0,p.default)([this.name,"link"]);this.get("router").nav(this.get("link")).then(function(){a.onClose()})},onResend:function(){var a=this;var b=this.get("model");this.set({loading:true,error:false});(0,p.default)([this.name,"resend","click"]);b.send().then(function(b){a.broadcast("resent",{sentMessage:b});(0,p.default)([a.name,"resend","ok"])}).catch(function(){a.set("error",true);(0,p.default)([a.name,"resend","fail"])})},onComposeBack:function(){var a=this.get("model");a.set("finalized",false);m.default.add(a);(0,p.default)([this.name,"compose-back","click"]);this.broadcast("layer:close",{type:"compose-back"})},prepareModelForTemplate:function(){var a=this.get("model");return k.default.findOne(this.get("sent-id")).then(function(b){return a.reattach({sync_space_left:true,sync_attachments:true,reset_attachments:true,source_model:b,force:true})})},onTemplate:function(){var a=this;var c=this.name;(0,p.default)([c,"template","click"]);this.set("template-status","saving");this.clearTimeouts();var d=this.get("model");this.prepareModelForTemplate().then(function(){return d.save({template:true})}).then(function(){(0,p.default)([c,"template","ok"]);if(a.isMounted()){a.set("template-status","saved");a.setVisibilityTimeout()}else{n.default.add({text:i18n("Сохранено в шаблоны")})}b.default.updateAll()}).catch(function(){if(a.isMounted()){a.broadcast("layer:close");a.set("template-status","idle")}(0,p.default)([c,"template","fail"]);n.default.add({type:n.default.types.error,text:i18n("Что-то пошло не так")})})},clearCancellationInterval:function(){var a=this.get("cancellation-interval");if(a){clearInterval(a);this.set("cancellation-interval",null)}},forceDelivery:function(){var a=this.get("model");var b=a.get("delivery_forced");var c=a.get("delivery_canceled");var d=a.get("cancellation_token");if(!b&&!c&&d){a.forceDelivery().then(function(a){var b=a.success;var c=b?"suc":"err";(0,p.default)("del_force_".concat(c))}).catch(function(a){(0,p.default)({type:"del_force_fail",rlog:"del_force_fail",rlog_message:a})})}},onCancel:function(){var a=this;(0,p.default)({type:"del_cancel_click",value:this.get("time-difference")});this.set("is-cancellation-progress",true);var b=this.get("cancellation-notify");b===null||b===void 0?void 0:b.close();clearTimeout(this.visibleTimer);var c=this.get("model");c.cancelDelivery().then(function(b){var d=b.success,e=b.error;var f=!a.get("cancellation-interval");var g=d&&!f?[x.ok,"ok"]:[x.fail,"error_".concat(e)],h=g[0],i=g[1];var j=d&&c.get("draft_id");a.set({"cancellation-result-text":h,"is-cancellation-over":true,"cancellation-with-draft":j,"is-cancellation-progress":false,"is-letter-canceled":true});if(a.get("is-notify-version")){n.default.add({text:d?x.openDraft:x.fail,qa:"cancellation-".concat(d?"ok":"fail","-notify")})}a.clearCancellationInterval();(0,p.default)("del_cancel_".concat(i));if(j){a.openDraft()}}).catch(function(b){a.set({"cancellation-result-text":x.fail,"is-cancellation-progress":false,"is-letter-canceled":true});if(a.get("is-notify-version")){n.default.add({text:x.fail,qa:"cancellation-error-notify"})}(0,p.default)({type:"del_cancel_fail",rlog:"del_cancel_fail",rlog_message:b})}).finally(function(){a.setVisibilityTimeout()})},setTimerValues:function(a,b){var c=this.get("prev-timer-value");if(a>=c){return}if(this.get("is-notify-version")){var d=this.get("cancellation-notify");d&&n.default.setData(d,{actions:[{text:this.getCancelMsg(a)}]});this.set({"time-difference":b,"prev-timer-value":a})}else{this.set({"delivery-cancel-timer-text":this.getCancelMsg(a,false),"time-difference":b,"prev-timer-value":a})}},setCancellationTimer:function(){var a=this;var b=this.get("cancel-lifetime");var d=setInterval(function(){var d=a.get("timer-start");var e=Math.round((Date.now()-d)/1e3);var f=b-e;var g=f+c.CANCELLATION_RESERVE_TIME;f<=0?a.onCancelTimerOver():a.setTimerValues(f,e);if(g===0){a.clearCancellationInterval()}},200);this.set({"timer-start":Date.now(),"delivery-cancel-timer-text":this.getCancelMsg(b,false),"cancellation-interval":d,"prev-timer-value":b})},onClose:function(){if((this===null||this===void 0?void 0:this.el)&&!this.get("is-cancellation-progress")){this.broadcast("layer:close")}},onBeforeHide:function(){this.clearTimeouts();var b=a.default.placement("sent");if(b){b.sleep()}l.default.wakeUp("sent");l.default.update();var d=(this===null||this===void 0?void 0:this.el)&&this.get("is-cancellation-progress");if(c.DELAY_FOR_CANCELLATION&&!d){this.forceDelivery()}if(d){return{stopHiding:true}}this.broadcast("layer:on-before-hide")},onCancelTimerOver:function(){var a=(this===null||this===void 0?void 0:this.el)&&this.get("is-cancellation-progress");if(!a){this.set("is-cancellation-over",true);this.forceDelivery();var b=this.get("cancellation-notify");b===null||b===void 0?void 0:b.close()}},showNotify:function(){var a=this.getMessages();var b=this.get("is-delivery-cancel-version");if(!b){n.default.add({text:this.get("isLateSent")?a.lateSent:a.sent,qa:"".concat(this.get("isLateSent")?"scheduled-":"","letter-sent-notify")});return}var c=n.default.add({text:a.sent,actions:[{text:this.getCancelMsg(this.get("cancel-lifetime"))}],qa:"letter-cancellation-notify",duration:this.get("cancel-lifetime")});c.on("action",this.onCancel.bind(this));c.on("closed",this.onClose.bind(this));this.set("cancellation-notify",c)},didMount:function(){var b=this;if(a.default.placement("sent")){var c=a.default.placement("sent");c.attachToContainer(this.refs.banner);c.wakeUp();c.render(true).catch(function(){return null})}var d=this.get("is-delivery-cancel-version");var e=this.get("is-notify-version");if(e){this.showNotify();(0,i.lazyMailKeymaster)().then(function(a){if(b.mounted&&!b.keyLib){b.keyLib=a;a(y,function(){b.onCancel()})}})}if(!d){return}(0,p.default)("cancel_on");this.setCancellationTimer()},didUnmount:function(){this.clearTimeouts();if(a.default.placement("sent")){a.default.placement("sent").destroy()}if(this.clipboard){this.clipboard.destroy()}this.clearCancellationInterval();if(this.keyLib){this.keyLib.unbind(y)}},setVisibilityTimeout:function(){var a=this;this.visibleTimer=setTimeout(function(){a.set("visibility-timeout-exceeded",true)},this.get("delay-visible"))},clearTimeouts:function(){clearTimeout(this.loadingTimer);clearTimeout(this.visibleTimer)},getContactList:function(a){return(0,e.correspondentsFull)(a)},getContactKey:function(a,b){return"contact-".concat(b,"-").concat(a)},getAttachKey:function(a){return"attach-".concat(a)},getAttachments:function(){return this._attachments},getMessages:function(){var a=this;var b=!Object.values(f.TRANSLATE_STRINGS_TO_MOMENT).find(function(b){return a.attrs.lateSentText.includes(b)});return{more:function(a){return i18n("и {spanOpen}ещё {more}{spanClose}",__assign({"unsafe-spanOpen":'<span class="layer__link">',"unsafe-spanClose":"</span>"},a))},sent:i18n("Письмо отправлено"),lateSent:b?i18n("Ваше письмо будет отправлено {lateSentText}",{lateSentText:this.attrs.lateSentText}):i18n("Ваше письмо будет отправлено {lateSentTextWithoutPrefix}",{lateSentTextWithoutPrefix:this.attrs.lateSentText})}},onCallsCopyClick:function(){n.default.add({text:i18n("Ссылка скопирована")},"layer-window")},sendCallsRadar:function(){var a=this.get("model");var b=a===null||a===void 0?void 0:a.get("calls");var c=this.get("hide-calls");if(c||!b||!b.length){(0,p.default)([this.name,"show","no-calls"])}else if(b.length===1){(0,p.default)([this.name,"show","calls-one"])}else{(0,p.default)([this.name,"show","calls-many"])}},goToInboxFolder:function(){var a=this.get("router");a===null||a===void 0?void 0:a.go("#letters");this.broadcast("layer:close");(0,p.default)([this.name,"go","inbox"])},openDraft:function(){var a=this;(0,p.default)("cncl_draft_clk");var b=this.get("model");return k.default.fetchData({id:b.get("draft_id"),folder_id:j.default.DRAFTS},true,true).then(function(b){(0,p.default)("cncl_draft_ok");k.default.set([b]);a.set("open-draft-fail",false);a.broadcast("compose:draft",new k.default(b));a.onClose()}).catch(function(b){(0,p.default)({type:"cncl_draft_fail",rlog:"cncl_draft_fail",rlog_message:b});a.set({"open-draft-fail":true,"cancellation-result-text":x.openDraftFail})})},getCancelShortcut:function(){return h.default.mac?"CMD+Z":"CTRL+Z"},getCancelMsg:function(a,b){if(b===void 0){b=true}var d=c.LETTER_SEND_CANCEL_TIMER_DISPLAY_TIME_AT_THE_END;if(d>0&&a<=d){return b?i18n("Отменить {timerValue}",{timerValue:a}):i18n("Отменить отправку {timerValue}",{timerValue:a})}return b?i18n("Отменить"):i18n("Отменить отправку")}})))});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __createBinding=this&&this.__createBinding||(Object.create?function(a,b,c,d){if(d===undefined)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable)){e={enumerable:true,get:function(){return b[c]}}}Object.defineProperty(a,d,e)}:function(a,b,c,d){if(d===undefined)d=c;a[d]=b[c]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:true,value:b})}:function(a,b){a["default"]=b});var __importStar=this&&this.__importStar||function(a){if(a&&a.__esModule)return a;var b={};if(a!=null)for(var c in a)if(c!=="default"&&Object.prototype.hasOwnProperty.call(a,c))__createBinding(b,a,c);__setModuleDefault(b,a);return b};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/compose-windows/compose-windows",["require","exports","@mail/adman","@mail/features","@mail/xray","cfg","data-source/actions","data-source/index","default-values","feast","feast-tpl!./compose-windows.html","helpers/autocomplete","helpers/email-length-postfix","helpers/user-track","logger","mail/Folder","mail/Message","mail/Thread","mediator/layout-manager","RPC","service/addressbook/addressbook","service/adv/index","service/auth","service/captcha","service/compose-validators","service/layer","service/mailbox/loader","service/notify","service/radars/decorator","service/radars/index","service/smokescreen","ui-block/compose-app/compose-app","ui-block/compose-collapsed/compose-collapsed","ui-block/dimmer/dimmer","ui-block/layer-sent-page/layer-sent-page","ui-block/notify-stack/notify-stack","../../feast-mod/utils"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);f=__importDefault(f);h=__importStar(h);i=__importStar(i);j=__importDefault(j);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);q=__importDefault(q);r=__importDefault(r);s=__importStar(s);t=__importStar(t);u=__importDefault(u);v=__importDefault(v);w=__importDefault(w);x=__importDefault(x);y=__importDefault(y);z=__importDefault(z);A=__importDefault(A);B=__importDefault(B);D=__importDefault(D);E=__importDefault(E);F=__importDefault(F);G=__importDefault(G);H=__importDefault(H);var J=100;var K=100;var L=350;var M=350;var N="too_long";var O=m.default.getScope("compose.mail.ru");var P=function(){t.default.wakeUp.apply(t.default,t.SLOTS_EXCEPT_SENT);t.default.updateOnAction()};exports.default=h.Block.extend((0,A.default)({explicit:"radar"})({name:"compose-windows",blocks:{dimmer:F.default,"compose-app":D.default,"compose-collapsed":E.default,"notify-stack":H.default,"layer-sent-page":G.default},events:{"collapsed-item-close":"onCollapsedItemClose","window-close":"onClose","window-collapse":"onCollapse","window-expand":"onExpand","letter-send":"onLetterSend","letter-schedule":"onLetterSchedule","letter-save":"onLetterSave","letter-autosave":"onLetterAutosave","letter-savetemplate":"onLetterSaveTemplate","letter-exceedmaxsize":"onExceedSize"},defaults:{adaptive:false,fullscreen:false,compact:false,overlap:false,ponymode:false,mobile:g.TOUCH_MODE,"mobile-layout":false,"expand-status":false,"has-right-column":false,"right-column-compact":false,rise:false,"support-extend":true,extended:false,"close-on-error":false,autosend:false,"show-mobile-footer":g.CAN_SHOW_FOOTER_APP_TOOLBAR},template:i,isolateEvents:false,constructor:function(){h.Block.prototype.constructor.apply(this,arguments);this.onLayoutUpdate=this.onLayoutUpdate.bind(this);this.onDataSourceChange=this.onDataSourceChange.bind(this)},didMount:function(){this._sending={};this._sendingCaptchaCallbacks={};z.default.setup(this.ids["compose-notify"],"compose-notify");f.default.on("change",this.onDataSourceChange);this.onLayoutUpdate();if(g.COMPOSE_INIT_ADDRESSBOOK){s.default.lazyInit()}},didUnmount:function(){f.default.off("change",this.onDataSourceChange)},animate:function(a,b,c){var d=this;if(g.COMPOSE_WINDOW_ANIMATION){var e="animate-".concat(a);setTimeout(function(){d.set(e,false);if(c){c()}},b);this.set(e,true)}else if(c){c()}},onCollapsedItemClose:function(a){var b=a.details;this.remove(b.uid);b.destroy();this.broadcast("window-collapsed-hide")},onClose:function(a){var b=this;var c=a.details;var d=c.get("form");var e=c.get("compose-options");var f=this.get("active");var g=function(){P();d.uid===f&&b.set("active",null);b.remove(d.uid);d.destroy();b.broadcast("window-hide")};if(!c.noAnimate){this.animate("close",K,g)}else{g()}if(e===null||e===void 0?void 0:e.templateName){(0,B.default)({type:"compose-templates_close",dwh:{template:e.templateName}})}return false},onCollapse:function(a){var b=this;var c=a.details;var d=c&&c.get("form");var e=this.ids["compose-"+this.get("active")];var f=c||e;if(f){f._updateComposeFields();this.saveDraft(f,{silent:true})}var g=function(){b.hide(d.uid);b.set("expand-status",false);P();b.broadcast("window-hide")};if(!c.noAnimate){this.animate("collapse",M,g)}else{g()}},onExpand:function(a){var b=this;var c=a.details;var d=c.get("form")||c;this.show(d.uid);this.animate("expand",L,function(){b.set("expand-status",true)})},onLetterAutosave:function(a){var b=a.details;(0,B.default)("compose_action_save_auto");O.add("autosave",{id:b.attrs.form.uid});this.saveDraft(b)},onLetterSave:function(a){var b=a.details;(0,B.default)("compose_action_save");var c=b.get("compose-options");this.saveDraft(b,{userAction:true});if(c===null||c===void 0?void 0:c.templateName){(0,B.default)({type:"compose-templates_save",dwh:{template:c.templateName}})}},onLetterSaveTemplate:function(a){var b=a.details,c=b.composeApp,d=b.resolve;(0,B.default)("compose_action_save_template");this.saveTemplate(c).then(d,d)},onLetterSchedule:function(a){var b=a.details,c=b.composeApp,d=b.scheduleText;var e=c.get("compose-options");this.letterSend({composeApp:c,scheduleText:d,schedule:true});if(e===null||e===void 0?void 0:e.templateName){(0,B.default)({type:"compose-templates_schedule",dwh:{template:e.templateName}})}},onExceedSize:function(){this.showExceedNotify()},onLetterSend:function(a){var b;var c=a.details;var d=this.get("active");if(d!=((b=c.get("form"))===null||b===void 0?void 0:b.uid)){return}var e=c.get("compose-options");this.letterSend({composeApp:c});if(e===null||e===void 0?void 0:e.templateName){(0,B.default)({type:"compose-templates_send",dwh:{template:e.templateName}})}},onDataSourceChange:function(a){var b=a.details;if(!b){return}var c=b.changes;if(!c){return}var d=c.some(function(a){var b=a.action;if(!b){return false}var c=b.type;return c===e.UPDATE_LAYOUT_SUPPORT_3_PANE});if(d){this.onLayoutUpdate()}},onLayoutUpdate:function(){var a;var b=this.get("layout");if(b){var c="default"in b&&"isLessThen"in b.default&&"isMoreThen"in b.default?b.default:b;var e=c.columnRight;var f=e>=40;var h=(c===null||c===void 0?void 0:c.isMoreThen("xs"))&&(c===null||c===void 0?void 0:c.isLessThen("l"))&&e<=40;var i=!!(((a=d.default.headline)===null||a===void 0?void 0:a.headlinePromoHeight)!==0&&document.querySelector(".vk-slides-iframe_show"));this.set({fullscreen:(c===null||c===void 0?void 0:c.isLessThen("s"))||g.TOUCH_MODE,adaptive:!i&&(c===null||c===void 0?void 0:c.isVertical("l")),mobile:(c===null||c===void 0?void 0:c.isLessThen("s"))||g.TOUCH_MODE,"mobile-xxs":c===null||c===void 0?void 0:c.isLessThen("xs"),overlap:(c===null||c===void 0?void 0:c.isLessThen("m"))||g.TOUCH_MODE,compact:h,rise:(c===null||c===void 0?void 0:c.isLessThen("xl"))||g.TOUCH_MODE,"3pane":(c===null||c===void 0?void 0:c.getType())==="3pane","has-right-column":f,"right-column-compact":f&&e<=40,"support-extend":(c===null||c===void 0?void 0:c.supportComposeExtend)&&!g.TOUCH_MODE})}},letterSend:function(a){var b=this;var c=a.composeApp,d=a.schedule,e=a.scheduleText;var f=c.get("form");w.default.checkOnRettachToReply(f).then(function(a){return!a.hasNewAttach?w.default.checkOnMissingAttach(f).then(function(b){return __assign(__assign({},a),{missingAttach:b})}):__assign(__assign({},a),{missingAttach:false})}).then(function(a){var g=a.hasNewAttach,h=a.source,i=a.missingAttach;if(!g){if(i){b.checkLostAttaches(c,d,e)}else{b.send(c,d,e)}return}(0,B.default)("reattach-to-reply_reattach-open");c.set("focusoff",true);x.default.open("reattach-to-reply",{mobile:q.default.isLessThen("xs")},{dimmer:true,compact:true,resolvable:true,mobile:q.default.isLessThen("xs")}).then(function(a){if(a==="skip"){return w.default.checkOnMissingAttach(f).then(function(b){return{type:a,missingAttach:b}})}return{type:a,missingAttach:false}}).then(function(a){var g=a.type,i=a.missingAttach;c.set("focusoff",false);if(g==="attach"){(0,B.default)("reattach-to-reply_reattach-attach");f.reattach({sync_space_left:true,sync_attachments:true,reset_attachments:false,source_model:h,force:true}).then(function(){b.send(c,d,e)},function(){(0,B.default)("reattach-to-reply_reattach-fail")})}else if(g==="skip"){(0,B.default)("reattach-to-reply_reattach-skip");if(i){b.checkLostAttaches(c,d,e)}else{b.send(c,d,e)}}else{(0,B.default)("reattach-to-reply_reattach-close");c.set("sending",false)}},function(){(0,B.default)("reattach-to-reply_open-fail");c.set("focusoff",false);b.send(c,d,e)})})},checkLostAttaches:function(a,b,c){var d=this;(0,B.default)("missing_attach_open");a.set("focusoff",true);x.default.open("missing-attach",{mobile:q.default.isLessThen("xs")},{dimmer:true,compact:true,resolvable:true,mobile:q.default.isLessThen("xs")}).then(function(e){a.set("focusoff",false);if(e==="skip"){(0,B.default)("missing_attach_skip");d.send(a,b,c)}else{(0,B.default)("missing_attach_back");a.set("sending",false)}},function(){a.set("focusoff",false);(0,B.default)("missing_attach_open-fail");d.send(a,b,c)})},getBodyCount:function(a){var b;try{var c=document.createElement("div");c.innerHTML=a;var d=c.querySelectorAll((0,C.selector)("blockquote"));var e=d.length;for(var f=0;f<e;f++){if(d[f].parentNode){d[f].parentNode.removeChild(d[f])}}b=c.innerHTML.length}catch(a){this.radar(["body-count","error"])}return b},_getCountPostfix:function(a){return(0,k.getEmailLengthPostfix)(a)},send:function(a,b,c){var d=this;if(b===void 0){b=false}if(c===void 0){c=""}if(g.COMPOSE_INIT_ADDRESSBOOK){s.default.lazyInit().then(function(){d._send(a,b,c)})}else{this._send(a,b,c)}},_send:function(a,c,d){var e=this;if(c===void 0){c=false}if(d===void 0){d=""}if(!a.isMounted()){return}var f=a.get("form");var h=f.get("subject");if(g.COMPOSE_SUBJECT_AUTOCOMPLETE&&h){(0,j.default)("Subject",h)}if(g.COMPOSE_SEND_STAT){this._updateComposeStatsFields(f)}if(g.COMPOSE_SEND_USER_TRACK){this._updateComposeUserTrackFields(f)}f.set({"compose_stat.build":g.BUILD,"compose_stat.serverTime":g.SERVER_TIME},{silent:true});if(b.default.has("body-size-radars")){setTimeout(function(){var a=e.getBodyCount(f.get("body.html"));if(a!==void 0){e.radar(["send","body-count",e._getCountPostfix(a)],a);e.radar(["send","body-count"],a)}else{e.radar(["send","no-body-count"])}},0)}a.set("sending",true);v.default.retryUntilCaptchaSuccess(function(a){var b=a.capcha;var d={delay_for_cancellation:g.DELAY_FOR_CANCELLATION};if(b){d.capcha=b}f.set(d);return f.send(c)}).then(function(){var b=f.attachments.reduce(function(a,b){return a+(b.isCloudStock()?1:0)},0);if(b){e.radar(["send","has-cloud-stock"],b)}if(g.OVERSIZE_CLOUD_ATTACHES){var h=f.attachments.reduce(function(a,b){if(!b.isOverMaxLinkSize()){return a}var c=b.get("size");var d=a.total,e=a.max,f=a.count,g=a.extensions;g.push(b.get("content_type"));return{max:Math.max(c,e),total:d+c,count:f+1,extensions:g}},{total:0,max:0,count:0,extensions:[]}),i=h.total,j=h.max,k=h.count,l=h.extensions;if(k){(0,B.default)({type:"compose_oversize-cloud_send",dwh:{count:k,total:i,max:j,extensions:l.join()}})}}(0,B.default)("compose_send");var m=f.id,n=f.cid,o=f.uid;O.add("send",{id:m,cid:n,uid:o,schedule:c});e._sendEmailTypeRadar(f.get("correspondents.from.0.email"));e._sendTranslationTypeRadar(f.meta("lastSavedTranslation"));a.set("sending",false);e._openSentPage(a,{isLateSent:c,lateSentText:d});if(c){e.onLateSent(f)}else{e.onSent(f)}},function(b){(0,B.default)("compose_send_fail");a.set({sending:false,errors:b.body,capcha:null});e.onFailSent(f,b,a)}).catch(function(){a.set("sending",false)})},unsubscribeCaptchaCallback:function(a){if(this._sendingCaptchaCallbacks[a]){v.default.off("open-captcha-popup",this._sendingCaptchaCallbacks[a]);delete this._sendingCaptchaCallbacks[a]}},isCancelDeliveryTurnOn:function(a){if(!a){return false}var b=a.get("cancellation_token");var c=a.get("cancellation_button_lifetime");return b&&c},_openSentPage:function(b,c){var d=this;var e=this.get("router");var f=b.get("form");var h=this.isCancelDeliveryTurnOn(f);var i=(!a.default.placement("sent")||g.OCTAVIUS_MOBILE)&&g.SENT_PAGE_NOTIFY;var j=f.uid;var k=c.isLateSent,l=c.lateSentText;this._sending[j]=true;this.hide(j);this.layerPromise=x.default.open("sent-page",{model:f,loading:false,link:e.getUrl("#letters",{folder:n.default.SENT}),router:e,"is-delivery-cancel-version":h,"is-notify-version":i,"cancel-lifetime":f.get("cancellation_button_lifetime"),isLateSent:k,lateSentText:l},{dimmer:!i,silent:i,"close-on-esc":!i,resolvable:false});this.layerPromise.then(function(a){a.on("resent",d.onSent.bind(d));a.on("layer:close",function(a){var b=a.details;if((b===null||b===void 0?void 0:b.type)!=="compose-back"){d.close(f.uid)}P();d.broadcast("window-hide")})})},saveDraft:function(a,b){var c=this;var d=b===void 0?{}:b,e=d.silent,g=e===void 0?false:e,h=d.userAction,i=h===void 0?false:h;var j=a.get("form");if(a.is("closing")){return j.save().then(function(){(0,B.default)("compose_save");return f.default.updateAll()}).then(function(){c.showDraftNotify(false,"default")}).catch(function(a){c.onFailDraft(a,false)})}a.set("saving",true);return j.save().then(function(){(0,B.default)("compose_save");var b=j.id,d=j.cid,e=j.uid;O.add("save",{id:b,cid:d,uid:e});a.set({saving:false,"has-changes":false});a.setAutosaveInterval(false);c.reloadFormData(j);if(!g){c.showDraftNotify()}}).then(function(){return f.default.updateAll()}).catch(function(b){var d=i;c.onFailDraft(b,false);var e=j.id,f=j.cid,g=j.uid;O.add("save failed",{id:e,cid:f,uid:g,error:b});a.set(__assign(__assign({},d&&{errors:b.body}),{saving:false,"has-changes":true}))})},onFailDraft:function(a,b,c){if(c===void 0){c=true}(0,B.default)("compose_save_".concat(b?"template_":"","fail"));try{var d=a.body;var e=d&&Object.keys(d).some(function(a){return/^attaches.list\[.*].id$/.test(a)&&d[a].error==="not_exists"});if(e){(0,B.default)("compose_save_".concat(b?"template_":"","fail_badattach"))}}catch(a){console.error(a);(0,B.default)("compose_save_".concat(b?"template_":"","fail_unknown"))}if(c){this.showDraftFailNotify(b)}},showDraftFailNotify:function(a,b){if(b===void 0){b="compose-notify"}var c=i18n("Не удалось сохранить в Черновики");if(a){c=i18n("Не удалось сохранить в Шаблоны")}z.default.add({type:z.default.types.error,text:c,qa:"message-save-fail"},b)},saveTemplate:function(a){var b=this;var c=a.get("form");return c.save({template:true}).then(function(){(0,B.default)("compose_save_template");return f.default.updateAll().then(function(){a.set({"template-enabled":false});b.showDraftNotify(true);b.reloadFormData(c,true)})}).catch(function(c){a.set({errors:c.body});b.onFailDraft(c,true,false);(0,B.default)("compose_save_template_fail")})},showDraftNotify:function(a,b){var c=this;if(a===void 0){a=false}if(b===void 0){b="compose-notify"}var d=new Date;var e=this.get("router");var f=z.default.add({text:a?i18n("Сохранено в шаблонах в {now}",{now:(0,I.formatDate)(d,[["hour","2-digit"],["minute","2-digit"]])}):i18n("Сохранено в черновиках в {now}",{now:(0,I.formatDate)(d,[["hour","2-digit"],["minute","2-digit"]])}),actions:[{text:i18n("Посмотреть"),event:a?"openTemplate":"openDraft"}]},b);f===null||f===void 0?void 0:f.on("action",function(a){var b=a.details;if(b==="openDraft"){if(c.get("active")){c.hide()}e.go("#letters",{folder:n.default.DRAFTS})}else if(b==="openTemplate"){if(c.get("active")){c.hide()}e.go("#letters",{folder:n.default.TEMPLATES})}})},showExceedNotify:function(a){if(a===void 0){a="compose-notify"}var b={text:i18n("Картинка прикреплена как вложение"),qa:"image-attached-as-file"};z.default.add(b,a)},removeDraft:function(a){var b=this.get("router");b.model.letters.filter(function(b){var c=b.getFolder();return c.isDrafts()&&!c.isTemplates()&&b.get("last")===a}).forEach(function(a){o.default.all.remove(a)})},onLateSent:function(a){this.close(a.uid);var b=a.get("source.draft");this.layerPromise.then(function(b){b.set({loading:false,"sent-id":a.id})}).catch(function(a){z.default.add({text:i18n("Письмо будет отправлено")});console.error(a)});if(b){this.removeDraft(b)}this.reloadFormData(a,false,true)},onSent:function(a){var b=this;var c;var d=a.get("source.reply")||a.get("source.forward");var e=a.get("source.draft");var f=p.default.getListByMessageId(d);var g=this.get("router");this.close(a.uid);var h=p.default.findOne(a.id);this.set("autosend",false);(c=this.layerPromise)===null||c===void 0?void 0:c.then(function(b){var c=g.getUrl("#read-letter",{folder:n.default.SENT,letter:a.id});b.set({link:c,loading:false,"sent-id":a.id});(0,B.default)("compose_sent-page")}).catch(function(a){z.default.add({text:i18n("Письмо отправлено")});(0,B.default)("compose_sent-page");(0,B.default)("compose_sent-page_layer-error");console.error(a)});h.then(function(){f.forEach(function(b){if(b.get("last")===d){a.get("source.reply")&&b.set("flags.reply",true,{silent:true});a.get("source.forward")&&b.set("flags.forward",true,{silent:true})}b.expire()&&b.fetch()});if(e){b.removeDraft(e)}b.reloadFormData(a,false,true)}).catch(function(a){(0,B.default)("compose_sent-page_thread-error");console.error(a)});if(a.get("calls")){this.radar(["send","calls"])}},onFailSent:function(a,b,c){var d=b.body,e=b.status;delete this._sending[a.uid];this.unsubscribeCaptchaCallback(a.uid);if(r.default.codes[e]==="invalid"&&d===N){z.default.add({type:z.default.types.error,text:i18n("Превышен лимит на размер письма")},"compose-notify");return}this.showSendFailNotify();if(this.get("close-on-error")){this.onClose({details:c})}},showSendFailNotify:function(a){if(a===void 0){a="compose-notify"}z.default.add({type:z.default.types.error,text:i18n("Не удалось отправить письмо"),qa:"message-send-fail"},a)},reloadFormData:function(a,b,c){if(!b){this.updateAffectedMessage(a,c)}y.default.invalidateCache();y.default.emit("any:reload")},updateAffectedMessage:function(a,b){var c=["reply","forward"];var d=c.find(function(b){return a.is("source.".concat(b))});if(d){var e=o.default.all.get(a.get("source.".concat(d)));if(e){if(b){e.set("drafts.".concat(d),"")}else{var f=[];["to","cc"].forEach(function(b){a.get("correspondents.".concat(b)).forEach(function(a){if(~a.email.indexOf("@")&&!f.includes(a.email)){f.push(a.email)}})});if(d==="reply"&&f.length>1){d="replyall"}var g={"drafts.last_type":d};g["drafts.".concat(d)]=a.get("source.draft");e.set(g)}}}},getCollapsed:function(a){var b=this;var c=this.get("active");return a.filter(function(a){var d=a.formData;return d.uid!==c&&!b._sending[d.uid]})},add:function(a,b){var c=this.get("items").find(function(b){var c=b.formData;if(c.uid===a.uid){return true}else{var d=c.get("source");var e=a.get("source");var f=d.draft&&!Object.keys(d).some(function(a){return d[a]!==e[a]});if(f){return true}}return false});if(c){this.animate("expand",L);this.show(c.formData.uid);return}this.animate("open",J);this.get("items").push({formData:a,autosend:b&&b.autosend,isDragAndDrop:b&&b.isDragAndDrop,dragAndDropItem:b&&b.dragAndDropItem,additionalOptions:b});this.show(a.uid);this.render()},show:function(a){this.set("active",a);if(g.COMPOSE_SEND_USER_TRACK){l.default.startComposeTrack(a)}t.default.sleep.apply(t.default,t.SLOTS_EXCEPT_SENT);this.broadcast("window-show")},hide:function(a){var b=this.get("active");if(!a&&b!==null){a=this.get("items").find(function(a){var c=a.formData;return c.uid==b}).formData.uid}if(a===b){this.set("active",null)}if(g.COMPOSE_SEND_USER_TRACK){l.default.pauseComposeTrack(a)}},close:function(a){var b=this.get("active");a===b&&this.set("active",null);this.remove(a)},remove:function(a){delete this._sending[a];this.unsubscribeCaptchaCallback(a);var b=this.get("items").filter(function(b){var c=b.formData;return c.uid!==a});this.set({items:b});if(g.COMPOSE_SEND_USER_TRACK){l.default.removeCompose(a)}},_updateComposeStatsFields:function(a){var b=s.default.getCachedAll();if(b){var d=a.get("correspondents");var e=[];["to","cc","bcc"].forEach(function(a){d[a].forEach(function(a){var c=a.email;if((0,s.isInAddressbook)(b,c)){e.push(1)}else{e.push(0)}})});var f={is_in_ab:e.join(""),ab_size:String(b.length)};a.set("compose_stat",f,{silent:true});c.default.send("compose_stat&i=ab_size:"+f.ab_size,null)}},_updateComposeUserTrackFields:function(a){var b=l.default.serialize(a.uid);a.set("compose_stat.user_track",b,{silent:true});c.default.send("compose-user-track",{i:{size:b.length}})},_getCollectors:function(){return this.get("router").model.collectors},_getAliases:function(){return this.get("router").model.aliases},_sendEmailTypeRadar:function(a){var b="unknown-email";if(a===u.default.user.getEmail()){b="main-email"}if(this._getCollectors().some(function(b){return b.getEmail()===a})){b="collector"}if(this._getAliases().some(function(b){return b.getEmail()===a})){b="alias"}(0,B.default)(["send","email",b])},_sendTranslationTypeRadar:function(a){if(!a){return}(0,B.default)({type:"send_translated_languages",intervals:[["from",a.fromlang],["to",a.tolang]]});(0,B.default)("send_translated")},insertHtml:function(a){var b=this.ids["compose-"+this.get("active")];if(b){b.insertHtml(a)}},useNewToolbar:function(){return g.NEW_TOOLBAR}}))});define("feast-tpl!app/feast-tpl!ui-block/gallery/gallery.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:var name="hasPreviousControl" value="{this.hasPreviousControl()}"/>\n\t<fn:var name="hasNextControl" value="{this.hasNextControl()}"/>\n\t<fn:var name="blockCount"/>\n\n\t<bem:mod name="arrows-bottom" test="~attrs.controls.indexOf(\'arrows_bottom\')"/>\n\n\t\x3c!-- Элементы списка --\x3e\n\t<div\n\t\t\tbem:elem="content-outer"\n\t\t\tref="contentOuter"\n\t>\n\t\t<div\n\t\t\t\tbem:elem="content-inner"\n\t\t\t\tref="content"\n\t\t>\n\t\t\t<bem:mod name="animated" test="attrs._animated"/>\n\n\t\t\t<fn:apply-match name="default" count="blockCount"/>\n\t\t</div>\n\t</div>\n\n\t<div bem:elem="controls">\n\t\t\x3c!-- Кнопка "Назад" --\x3e\n\t\t<div\n\t\t\t\tbem:elem="nav-button"\n\t\t\t\ttitle="{i18n(\'Назад\')}"\n\t\t\t\tremit:click="click:previous"\n\t\t\t\ttabindex="-1"\n\t\t>\n\t\t\t<bem:mod name="hidden" test="!hasPreviousControl"/>\n\n\t\t\t<b:ico name="navigation:arrow_list_previous" size="s"/>\n\t\t</div>\n\n\t\t\x3c!-- Текущая страница --\x3e\n\t\t<div bem:elem="pages" fn:if="~attrs.controls.indexOf(\'pages\')">\n\t\t\t{_this._findCurrentStartIndex() | formatPages:blockCount}\n\t\t</div>\n\n\t\t\x3c!-- Кнопка "Вперёд" --\x3e\n\t\t<div\n\t\t\t\tbem:elem="nav-button"\n\t\t\t\ttitle="{i18n(\'Вперёд\')}"\n\t\t\t\tremit:click="click:next"\n\t\t\t\ttabindex="-1"\n\t\t>\n\t\t\t<bem:mod name="hidden" test="!hasNextControl"/>\n\n\t\t\t<b:ico name="navigation:arrow_list_next"/>\n\t\t</div>\n\t</div>\n</div>\n',"app/feast-tpl!ui-block/gallery/gallery.html")});define("feast-tpl!ui-block/gallery/gallery.html",["feast-tpl!app/feast-tpl!ui-block/gallery/gallery.html"],function(a){return a});define("helpers/animation-transition",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.animationTransition=void 0;function a(){var a;var b={transitionOnce:function(c,d){c();if(a){clearTimeout(a)}a=setTimeout(function(){if(b.onEnd){b.onEnd()}a=undefined},d)},stopAll:function(){if(a){clearTimeout(a);if(b.onEnd){b.onEnd()}}}};return b}exports.animationTransition=a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};define("helpers/touch-tracker",["require","exports"],function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.touchTracker=void 0;var a={mouse:false,touch:true,mouseDragThreshold:10};function b(b,c){if(c===void 0){c={}}var d=__assign(__assign({},a),c);var e=null;var f;var g;var h;var i;var j=false;var k=false;var l=function(a,b){f=a;g=b;h=f;i=g;k=false};var m=function(a,b){if(f===undefined||g===undefined){f=a;g=b}if(h===undefined||i===undefined){h=f;i=g}var c=f-a;var j=g-b;f=a;g=b;if(Math.abs(h-f)>=d.mouseDragThreshold||Math.abs(i-g)>=d.mouseDragThreshold){k=true}if(e.onMove){e.onMove(c,j)}};var n=function(){f=undefined;g=undefined;if(e.onMoveEnd){e.onMoveEnd()}};var o=function(a){var b=a.changedTouches[0];if(b){l(b.clientX,b.clientY)}};var p=function(a){j=true;l(a.clientX,a.clientY)};var q=function(a){var b=a.changedTouches[0];if(!b){return}m(b.clientX,b.clientY)};var r=function(a){if(j){m(a.clientX,a.clientY)}};var s=function(){n()};var t=function(){j=false;n()};var u=function(a){a.preventDefault()};var v=function(a){if(k){a.preventDefault()}};if(d.touch){b.addEventListener("touchstart",o,{passive:true});b.addEventListener("touchmove",q,{passive:true});b.addEventListener("touchend",s,{passive:true});b.addEventListener("touchcancel",s,{passive:true})}if(d.mouse){b.addEventListener("mousedown",p);b.addEventListener("mousemove",r);b.addEventListener("mouseup",t);b.addEventListener("mouseleave",t);b.addEventListener("dragstart",u);b.addEventListener("click",v)}e={stop:function(){if(d.touch){b.removeEventListener("touchstart",o);b.removeEventListener("touchmove",q);b.removeEventListener("touchend",s);b.removeEventListener("touchcancel",s)}if(d.mouse){b.removeEventListener("mousedown",p);b.removeEventListener("mousemove",r);b.removeEventListener("mouseup",t);b.removeEventListener("mouseleave",t);b.removeEventListener("dragstart",u);b.removeEventListener("click",v)}}};return e}exports.touchTracker=b});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/gallery/gallery",["require","exports","feast","feast-tpl!./gallery.html","helpers/animation-transition","helpers/resizer","helpers/touch-tracker","ui-block/ico/ico"],function(require,exports,a,b,c,d,e,f){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);f=__importDefault(f);var g=a.default.Block.extend({name:"gallery",template:b.default,blocks:{ico:f.default},mods:{formatPages:function(a,b){return i18n("{current} из {total}",{current:String(a+1),total:String(b)})}},defaults:{controls:"touch, arrows_middle",_offset:0,_width:window.innerWidth},attrChanged:{_width:function(a){var b=this;this.checkScrollEnd();if(!a){return}if(this.allBlocksVisibleTimeout){clearTimeout(this.allBlocksVisibleTimeout)}this.allBlocksVisibleTimeout=setTimeout(function(){if(b.isMounted()&&b._fitsInWidth(a)){b.broadcast("all-blocks-visible")}b.allBlocksVisibleTimeout=null});if(this.allBlocksRenderedTimeout){clearTimeout(this.allBlocksRenderedTimeout)}this.allBlocksRenderedTimeout=setTimeout(function(){if(b.isMounted()){b.handleAllBlocksRendered()}b.allBlocksRenderedTimeout=null},500)},_offset:function(){this.checkScrollEnd()}},events:{"click:previous":"onClickPrevious","click:next":"onClickNext","touchstart:content-inner":"onTouchStart","touchmove:content-inner":"onTouchMove"},constructor:function(){var b=this;a.default.Block.apply(this,arguments);this.onResize=this.onResize.bind(this);this._itemOffsets=[];this._itemsWidth=0;this._transition=(0,c.animationTransition)();this._transition.onEnd=function(){if(b.isMounted()){b.set("_animated",false)}}},didMount:function(){this._resizer=(0,d.default)();this._resizer.set(this.onResize);this._resizer.observe(this.refs.content,"content");this._resizer.observe(this.refs.contentOuter,"contentOuter");this._measureItemOffsets({});this.onResize();this.setupTouchTracker()},didUpdate:function(){this._measureItemOffsets({})},shouldUpdate:function(a){if(a._offset!==undefined){this.refs.content.style.marginLeft="".concat(-a._offset,"px");return Object.keys(a).length>1}if(a.controls!==undefined&&this._touchTracker){this._touchTracker.stop();this.setupTouchTracker()}return true},didUnmount:function(){this._resizer.unbind();this._touchTracker.stop();this._transition.stopAll()},setupTouchTracker:function(){var a=this;this._touchTracker=(0,e.touchTracker)(this.el,{touch:this.get("controls").includes("touch"),mouse:this.get("controls").includes("mouse")});this._touchTracker.onMove=function(b){a.set("_offset",Math.max(Math.min(a.get("_offset")+b,a._itemsWidth-a.get("_width")),0))};this._touchTracker.onMoveEnd=function(){a._transition.transitionOnce(function(){a.set({_offset:a._getItemOffset(a._findNearestStartIndex()),_animated:true})},200)}},onClickPrevious:function(){var a=this;if(this.hasPreviousControl()){var b=this._findCurrentStartIndex();this._transition.transitionOnce(function(){a.set({_offset:a._getItemOffset(b-1),_animated:true})},200)}},onClickNext:function(){var a=this;if(this.hasNextControl()){var b=this._findCurrentStartIndex();this._transition.transitionOnce(function(){a.set({_offset:a._getItemOffset(b+1),_animated:true})},200)}},onResize:function(a){var b=this._getOuterRectWidth(a!==null&&a!==void 0?a:{});this._measureItemOffsets(a!==null&&a!==void 0?a:{},false);this.set({_width:b,_offset:this._getItemOffset(this._findCurrentStartIndex(),b)})},hasPreviousControl:function(a){if(a===void 0){a=this.get("_offset")}return!this._fitsInWidth()&&a>0},hasNextControl:function(a){if(a===void 0){a=this.get("_offset")}return!this._fitsInWidth()&&this._itemsWidth-a>this.get("_width")&&this._findCurrentStartIndex()<this._itemOffsets.length-1},_getItemOffset:function(a,b){var c;if(b===void 0){b=this.get("_width")}var d=((c=this._itemOffsets[a])!==null&&c!==void 0?c:{offset:0}).offset;var e=this._fitsInWidth(b)?d:Math.max(b-(this._itemsWidth-d),0);return d-e},_findCurrentStartIndex:function(){var a=this.get("_offset");for(var b=0;b<this._itemOffsets.length;b++){var c=this._itemOffsets[b];if(Math.round(c.offset)>=Math.round(a)){return b}}return 0},_findNearestStartIndex:function(){var a=this.get("_offset");var b=0;var c=-1;for(var d=0;d<this._itemOffsets.length;d++){var e=this._itemOffsets[d];var f=Math.abs(a-e.offset);if(f<c||c===-1){b=d;c=f}}return b},_fitsInWidth:function(a){if(a===void 0){a=this.get("_width")}return this._itemsWidth<=a},_getOuterRectWidth:function(a){if(a.contentOuter){return a.contentOuter.width}var b=this.refs.contentOuter.getBoundingClientRect();return b?b.width:window.innerWidth},_measureItemOffsets:function(a,b){var c,d,e;if(b===void 0){b=true}if(!a.content){if(!this.refs.content){return}if(b){a.content=(c=this.refs.content.getBoundingClientRect())!==null&&c!==void 0?c:{width:window.innerWidth}}}this._itemsWidth=(e=(d=a.content)===null||d===void 0?void 0:d.width)!==null&&e!==void 0?e:this._itemsWidth;this._itemOffsets=[];var f;var g=0;var h=0;for(var i=0;i<this.refs.content.children.length;i++){var j=this.refs.content.children[i];var k=a[i];var l=this._itemOffsets[i];var m=this._getItemAbsoluteOffset(j,k,l),n=m[0],o=m[1];if(f===undefined){f=n}var p=n-f;var q=n-g-h;this._itemOffsets.push({offset:p,width:o,margin:q});g=n;h=0}},_getItemAbsoluteOffset:function(a){var b;var c=[];for(var d=1;d<arguments.length;d++){c[d-1]=arguments[d]}c=c.filter(function(a){return!!a});if(!c.length){c.push(a.getBoundingClientRect())}var e=c[0];return e?[(b=e.left)!==null&&b!==void 0?b:e.offset,e.width]:[0,0]},checkScrollEnd:function(){var a=this.hasNextControl();if(this._lastHasNextControl&&!a&&!this._fitsInWidth()){this.broadcast("scroll-end")}this._lastHasNextControl=a},getVisibleItemsCount:function(){var a=this.get("_width");var b=0;this._itemOffsets.forEach(function(c){if(c.offset+c.width<a){b++}});return b},handleAllBlocksRendered:function(){var a=this.getVisibleItemsCount();this.broadcast("all-blocks-rendered",{visibleItemsCount:a})}});exports.default=g});define("feast-tpl!app/feast-tpl!ui-block/unsubscribe/unsubscribe.html",["feast"],function(a){return a.smartParse('<div>\n\t<b:dropdown\n\t\t\tid="unsubscribe-dropdown"\n\t\t\tradar-id="unsubscribe"\n\t\t\ttext="{attrs[\'dropdown-button-text\']}"\n\t\t\tico="status_block"\n\t\t\tbase\n\t\t\tpure\n\t\t\ttouch="{attrs.touch}"\n\t\t\tshort="{attrs.touch || attrs.withoutText}"\n\t\t\tremit:dropdown-change-state="expanded"\n\t\t\texpand-left="{attrs[\'position-right\']}"\n\t\t\tauto-close="{false}"\n\t\t\tponymode="{attrs.ponymode}"\n\t\t\tpromoId="{attrs.promoId}"\n\t>\n\t\t<fn:match name="items" args="data">\n\t\t\t<fn:if test="data.attrs.expanded">\n\t\t\t\t<b:react-async\n\t\t\t\t\t\tcomponent="UnsubscribeDropdown"\n\t\t\t\t\t\tonButtonClick="{_this.onUnsubscribeButtonClick.bind(_this)}"\n\t\t\t\t\t\tonClose="{data.hide}"\n\t\t\t\t\t\tsenderName="{attrs.senderFrom}"\n\t\t\t\t\t\tlettersCount="{attrs[\'sender-letters\']}"\n\t\t\t\t\t\tinProgress="{attrs[\'in-progress\']}"\n\t\t\t\t\t\tuse:mediator="themes-manager"\n\t\t\t\t/>\n\t\t\t</fn:if>\n\t\t</fn:match>\n\t</b:dropdown>\n</div>\n',"app/feast-tpl!ui-block/unsubscribe/unsubscribe.html")});define("feast-tpl!ui-block/unsubscribe/unsubscribe.html",["feast-tpl!app/feast-tpl!ui-block/unsubscribe/unsubscribe.html"],function(a){return a});define("helpers/unsubscribe-actions",["exports"],function(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var a=exports.EUnsubscribeAction={UNSUBSCRIBE:"unsubscribe_action",UNSUBSCRIBE_READ:"unsubscribe_read_action",UNSUBSCRIBE_REMOVE:"unsubscribe_remove_action"}});define("ui-block/unsubscribe/unsubscribe",["exports","default-values","feast","feast-mod/correspondents","feast-tpl!./unsubscribe.html","helpers/radar-utils","helpers/unsubscribe-actions","RPC","service/radars/decorator","service/radars/index","ui-block/dropdown/dropdown","ui-block/react-async/react-async"],function(exports,a,b,c,d,e,f,g,h,i,j,k){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var l=s(b);var m=s(d);var n=s(g);var o=s(h);var p=s(i);var q=s(j);var r=s(k);function s(a){return a&&a.__esModule?a:{default:a}}exports.default=l.default.Block.extend((0,o.default)({events:[{name:"unsubscribe",data:e.getModelData}]})({name:"unsubscribe",template:m.default,isolateEvents:false,mods:{correspondent:c.correspondent},blocks:{dropdown:q.default,"react-async":r.default},defaults:{"sender-letters":0,"dropdown-button-text":i18n("Отписаться от рассылки"),"is-component-visible":false,"actions-finished":false,"in-progress":false},events:{expanded:"handleExpandEvent"},attrChanged:{"actions-finished":function a(b){if(b){this.ids["unsubscribe-dropdown"].hide();this.set("in-progress",false)}},model:function b(){var c=this;(0,p.default)({type:"unsubscribe_button_show",intervals:[["button_position",this._getPositionString()]]});if(this.is("short")){this.set("dropdown-button-text",i18n("Отписаться"))}if(!a.UNSUBSCRIBE_COUNT_ALL){return}n.default.call("messages/count/all",{from:[this.get("senderFrom")],only_newsletters:true}).then(function(a){var b=a.body.count;if(!b){return}if(!c.is("is-component-visible")){c.set("sender-letters",b);(0,p.default)("unsubscribe_count_all-success")}}).catch(function(a){return(0,p.default)("unsubscribe_count_all-error",a)})}},onUnsubscribeButtonClick:function a(b){var c=this.get("letterId");var d=this.get("senderFrom");var e=this.get("insteadSpamButton");this.set("in-progress",true);(0,p.default)({type:"unsubscribe_button_click",intervals:[["action_type",b],["button_position",this._getPositionString()]],dwh:{position:e?"portal-menu":"default",action_type:b}});this.broadcast("unsubscribe",{ids:Array.isArray(c)?c:[c],position:e?"portal-menu":"default"});switch(b){case f.EUnsubscribeAction.UNSUBSCRIBE:return;case f.EUnsubscribeAction.UNSUBSCRIBE_REMOVE:this.broadcast("moveallfrom",{from:d});break;case f.EUnsubscribeAction.UNSUBSCRIBE_READ:this.broadcast("markallfrom",{from:d});break}},handleExpandEvent:function a(b){if(!b.details){return}var c=b.details.state;if(c){(0,p.default)({type:"unsubscribe_open_click",intervals:[["button_position",this._getPositionString()]]})}this.set("is-component-visible",c)},_getPositionString:function a(){return this.is("position-right")?"right":"left"}}))});define("feast-tpl!app/feast-tpl!ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal.html",["feast"],function(a){return a.smartParse('<div\n  ref="layer-cleanmaster-modal"\n>\n</div>\n',"app/feast-tpl!ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal.html")});define("feast-tpl!ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal.html",["feast-tpl!app/feast-tpl!ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal.html"],function(a){return a});var __assign=this&&this.__assign||function(){__assign=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e]}return a};return __assign.apply(this,arguments)};var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-cleanmaster-modal/layer-cleanmaster-modal",["require","exports","@mail/features","@mail/xray","default-values","feast","feast-tpl!./layer-cleanmaster-modal.html","mediator/unsubscribe-actions","service/notify"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);var h=function(a){var b=a.text,d=a.qa;g.default.add({text:b,qa:d,duration:c.SETTINGS_DOCK_CLEANMASTER_NOTIFY_DURATION,inline:false})};var i=function(a){var b=a.text,d=a.qa;g.default.error({text:b,qa:d,duration:c.SETTINGS_DOCK_CLEANMASTER_NOTIFY_DURATION,inline:false})};var j={remove:"@modal/senders/remove",unsubscribe:"@modal/senders/unsubscribe"};exports.default=d.default.Block.extend({name:"layer-cleanmaster-modal",template:e.default,blocks:{},_modalPage:null,defaults:{compact:false,isAvailable:false},events:{},_isValidAction:function(a){return a in j},didMount:function(){var c=this;var d=this.refs["layer-cleanmaster-modal"];var e=this.get("ponymode");var g=this.get("action");var k=this.get("from");var l=this.onClose.bind(this);if(!this._isValidAction(g)){this.set("isAvailable",false);return}window.require(["cleanmaster"],function(m){c._modalPage=m.createCleanmasterModal(d,{features:a.default,septima:false,app:false,touch:false,octavius:true,headerMode:"hidden",isDockSettings:false,compact:e});var n={"@stat/radar":function(a){var c=a.name,d=a.params,e=a.dwh,f=e===void 0?{}:e;b.default.send(c,{i:d,v:1,dwh:__assign(__assign({},f),{query:true})})},"@clean/clean/success":function(a){var b=a.senders,c=b===void 0?[]:b;f.default.deleteSenderFromUnsubscribeList(c.map(function(a){var b=a.emails;return b}))},"@notify/success":h,"@notify/info":h,"@notify/error":i,"@redux-popup/popup/CLOSE_ALL":l};Object.keys(n).forEach(function(a){c._modalPage.on(a,n[a])});c._modalPage.create();c._modalPage.store.dispatch({type:j[g],payload:{sendersEmailList:k}})});this.set("isAvailable",true)},onClose:function(){var a;var b=this.get("isAvailable");if(!b){return}(a=this._modalPage)===null||a===void 0?void 0:a.destroy();this.set("isAvailable",false);this.broadcast("layer:close")}})});define("feast-tpl!app/feast-tpl!ui-block/layer-edit-settings-filter/layer-edit-settings-filter.html",["feast"],function(a){return a.smartParse('<div>\n\t<fn:match name="spinner">\n\t\t<div bem:elem="spinner-container">\n\t\t\t<b:spinner/>\n\t\t</div>\n\t</fn:match>\n\n\t<b:layer name="edit-settings-filter"\n\t\t\t remit:close="layer:close"\n\t\t\t center\n\t\t\t hiddenfooter\n\t\t\t standard>\n\n\t\t<fn:match name="content">\n\t\t\t<div class="layer-edit-settings-filter_content" ref="content">\n\t\t\t\t<fn:apply-match name="spinner"/>\n\t\t\t</div>\n\t\t</fn:match>\n\t</b:layer>\n</div>\n',"app/feast-tpl!ui-block/layer-edit-settings-filter/layer-edit-settings-filter.html")});define("feast-tpl!ui-block/layer-edit-settings-filter/layer-edit-settings-filter.html",["feast-tpl!app/feast-tpl!ui-block/layer-edit-settings-filter/layer-edit-settings-filter.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("filters/actions/Edit",["require","exports","RPC","Action","filters/Filter"],function(require,exports,a,b,c){"use strict";a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);var d=b.default.extend({url:c.default.url("edit"),prepare:function(a){return this._removeEmptyParams(a)},_removeEmptyParams:function(a){a.filters.forEach(function(a){if(a.actions.notify&&!a.actions.notify.length){delete a.actions.notify}if(a.actions.replace_category===null){delete a.actions.replace_category}});return a},operation:function(b){var c={};b.filters.forEach(function(a,b){if(!a.id){c["filters."+b+".id"]="required"}});if(Object.keys(c).length){return Promise.reject(c)}return a.default.call(this.url,b).then(function(a){return d.processResult(b,a)})}});d.processResult=function(a,b){return c.default.map(a.filters.map(function(a,c){a.id=b.get("body."+c);a.apply_folders=b.get("data.apply_folders");if(!a.conditions){a.conditions=[]}return a}))};b.default.register("filters.Edit",d);d.version="0.1.0";exports.default=d;return d});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-edit-settings-filter/layer-edit-settings-filter",["require","exports","data-source/index","default-values","feast","feast-tpl!./layer-edit-settings-filter.html","filters/actions/Edit","filters/actions/SaveSeveral","filters/Filter","helpers/define-utils","mail/Folder","service/getModule","service/notify","service/radars/decorator","service/radars/index","service/secure-folder","ui-block/layer/layer","ui-block/spinner/spinner"],function(require,exports,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);i=__importDefault(i);j=__importDefault(j);k=__importDefault(k);l=__importDefault(l);m=__importDefault(m);n=__importDefault(n);o=__importDefault(o);p=__importDefault(p);exports.default=c.default.Block.extend((0,l.default)()({name:"layer-edit-settings-filter",template:d.default,blocks:{layer:o.default,spinner:p.default},events:{close:"onClose",cancel:"onCancel"},defaults:{filterModel:{},applyFolders:[],expandExtendOptions:false},onLoad:function(){},onClose:function(){this.broadcast("layer:close")},onCancel:function(){},didUnmount:function(){this.editor.unmount()},load:function(){var a=this;return new Promise(function(b){Promise.all([(0,j.default)("blitz")]).then(function(){(0,h.defineExternalForSyncUse)("filters/actions/Edit",e.default);(0,h.defineExternalForSyncUse)("filters/Filter",g.default);(0,h.defineExternalForSyncUse)("filters/actions/SaveSeveral",f.default);(0,j.default)("filters.mail.ru").then(function(c){a.ui=c;require(["mediator/themes-manager"],function(c){var d=c.default;d.register(a);b()})})})})},didMount:function(){var c=this;this.load().then(function(){if(!c.isMounted()){return}var d=c.refs.content;c.editor=new c.ui(d);c.editor.mount({model:c.get("filterModel"),templateValues:c.get("templateValues"),expandExtendOptions:c.get("expandExtendOptions"),useBlackTheme:c.is("dark-mode"),useOctaviusTheme:true,autoreplyLink:b.SETTINGS_AUTOREPLY_LINK,config:{radar:{p:b.RADAR_PROJECT},popup:true},onClose:function(){c.onClose()},onCancel:function(){c.onClose()},successSave:function(){c.onClose();setTimeout(function(){a.default.updateAll()},b.FILTER_SAVE_UPDATE_TIMEOUT);k.default.add({text:i18n("Фильтр успешно создан")})},successApply:function(){setTimeout(function(){a.default.updateAll()},b.FILTER_SAVE_UPDATE_TIMEOUT)},onSendRadar:m.default,onFolderNeedOpen:function(a){return i.default.findOne({id:a}).then(function(a){return(0,n.default)(a)}).then(function(a){return!a&&Promise.reject()})}})})}}))});define("feast-tpl!app/feast-tpl!ui-block/layer-create-folder/layer-create-folder.html",["feast"],function(a){return a.smartParse("<div/>\n","app/feast-tpl!ui-block/layer-create-folder/layer-create-folder.html")});define("feast-tpl!ui-block/layer-create-folder/layer-create-folder.html",["feast-tpl!app/feast-tpl!ui-block/layer-create-folder/layer-create-folder.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-create-folder/layer-create-folder",["require","exports","@mail/features","data-source/index","feast","feast-tpl!./layer-create-folder.html","mail/Folder","service/getModule","service/mailbox/loader","service/notify","service/secure-folder","service/themes.setup"],function(require,exports,a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);h=__importDefault(h);i=__importDefault(i);j=__importDefault(j);function k(a){return(a===null||a===void 0?void 0:a.moveLetters)===true}exports.default=c.default.Block.extend({name:"layer-create-folder",template:d.default,defaults:{mode:"new",model:null,selectMode:false},registerInMediators:function(){var a=this;return new Promise(function(b){require(["mediator/letters-selection"],function(c){var d=c.default;d.register(a);b()})})},didMount:function(){var c=this;var d=this.attrs,h=d.model,l=d.mode;this.registerInMediators().then(function(){if(!c.isMounted()){return}var d=false;var m=null;if(k(h)){d=h.moveLetters;m=h.letterCurrentFolder}var n=l==="edit"||d?null:h;var o=c.get("selectMode");var p=d?function(a){g.default.invalidateCache();c.broadcast("move",{id:a.id,selection:o})}:function(){g.default.invalidateCache();b.default.updateAll()};Promise.all([(0,f.default)("react"),(0,f.default)("blitz")]).then(function(b){var f;var g=b[0],k=b[1],o=k.CreateFolder,q=k.LayerManager;if(!c.isMounted()){return}var r=c.layerManager||new q;r.setup(c.el,{popup:false,radarPrefix:"folders-lr"});var s={mode:l,folder:l==="edit"?h:new e.default({name:""}),parentFolder:n,folders:e.default.all,FEATURES:a.default,onClose:c.onClose.bind(c),onError:c.onError.bind(c),handleFinal:p,isMoveLetters:d,letterCurrentFolder:m,openSecureFolder:i.default,layerManager:r,isDarkMode:!!((f=j.default.getSelectedModel())===null||f===void 0?void 0:f.isDarkMode())};var t=r.openLayer(g.createElement(o,s),{noPanelWrap:true,responsive:"auto"}).id;c.layerManager=r;c.id=t})})},onError:function(a){h.default.add({type:h.default.types.error,text:i18n("Что-то пошло не так!"),unique:true})},onClose:function(){this.broadcast("layer:close");if(this.layerManager){this.layerManager.destroyLayer(this.id)}}})});define("feast-tpl!app/feast-tpl!ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder.html",["feast"],function(a){return a.smartParse('<div qa:id="layer-confirm-delete-folder">\n\t<fn:var name="messages" value="{_this.getMessages()}"/>\n\n\t<bem:mod name="touch" test="attrs.mobile"/>\n\t<bem:mod name="full" test="!attrs.mobile"/>\n\t<bem:mod name="hidden" test="attrs.hidden"/>\n\n\t<b:layer\n\t\t\tremit:close="layer:close"\n\t\t\tmodel="{attrs.model}"\n\t\t\terror="{attrs.error}"\n\t\t\tmobile="{attrs.mobile}"\n\t\t\tprocessing="{attrs.processing}"\n\t\t\tname="confirm-clear-folder"\n\t\t\tclose\n\t\t\theader\n\t\t\tfooter\n\t\t\tcenter\n\t\t\tstandard\n\t\t\tresolvable\n\t>\n\n\t\t<fn:match name="header" args="attrs">\n\t\t\t{messages.confirm}\n\t\t</fn:match>\n\n\t\t<fn:match name="content" args="attrs">\n\t\t\t<fn:if test="attrs.error">\n\t\t\t\t<div bem:elem="error" qa:id="{attrs.error}">\n\t\t\t\t\t{messages[attrs.error]}\n\t\t\t\t</div>\n\t\t\t</fn:if>\n\t\t\t{i18n(\'Все письма будут перенесены в папку «Корзина».\')}\n\t\t</fn:match>\n\n\t\t<fn:match name="footer" args="attrs">\n\t\t\t<div bem:elem="submit-button">\n\t\t\t\t<b:button2\n\t\t\t\t\t\tremit:click="layer:resolve"\n\t\t\t\t\t\tdisabled="{attrs.processing}"\n\t\t\t\t\t\ttext="{i18n(\'Удалить\')}"\n\t\t\t\t\t\tprimary\n\t\t\t\t\t\tfluid\n\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t\t\tqa:id="submit"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div bem:elem="cancel-button">\n\t\t\t\t<b:button2\n\t\t\t\t\t\tremit:click="layer:close"\n\t\t\t\t\t\tdisabled="{attrs.processing}"\n\t\t\t\t\t\ttext="{i18n(\'Отменить\')}"\n\t\t\t\t\t\tfluid\n\t\t\t\t\t\ttouch="{attrs.mobile}"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</fn:match>\n\n\t</b:layer>\n</div>\n',"app/feast-tpl!ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder.html")});define("feast-tpl!ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder.html",["feast-tpl!app/feast-tpl!ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-confirm-delete-folder/layer-confirm-delete-folder",["require","exports","feast","feast-tpl!./layer-confirm-delete-folder.html","ui-block/button2/button2","ui-block/layer/layer"],function(require,exports,a,b,c,d){"use strict";Object.defineProperty(exports,"__esModule",{value:true});a=__importDefault(a);b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);exports.default=a.default.Block.extend({name:"layer-confirm-delete-folder",template:b.default,blocks:{layer:d.default,button2:c.default},events:{"layer:resolve":"onConfirm"},defaults:{processing:false,error:null},getMessages:function(){return{confirm:i18n("Удалить папку «{folderName}»?",{folderName:this.attrs.model.get("name")}),isCollectorRoot:i18n("Нельзя удалить папку, так как в неё собирается почта из другого ящика"),systemFolder:i18n("Невозможно удалить системную папку"),folderNotExists:i18n("Папка больше не существует"),invalidFolder:i18n("Невозможно удалить папку"),unknownError:i18n("Произошла неизвестная ошибка")}},onConfirm:function(){if(this.is("processing")||this.is("error")){return}this.set("processing",true)}})});define("feast-tpl!app/feast-tpl!ui-block/layer-metathreads-settings/layer-metathreads-settings.html",["feast"],function(a){return a.smartParse('<div qa:id="layer-metathreads-settings" promo:id="layer-metathreads-settings">\n\t<b:react-async\n\t\tkey="{attrs.metathreadsData.length}"\n\t\tcomponent="MetathreadsSettingsContainer"\n\t\tlayer\n\t\tdarkMode="{attrs[\'dark-mode\']}"\n\t\tmetathreadsData="{attrs.metathreadsData}"\n\t\tonHelpClick="{_this.onHelpClick}"\n\t\tonSettingsEdit="{_this.onSettingsEdit}"\n\t\tonCreateFilter="{_this.onCreateFilter}"\n\t\tfiltersCount="{attrs.metathreadsFiltersCount}"\n\t\tfiltersCountLoading="{attrs.metathreadsFiltersCountLoading}"\n\t\tonClose="{_this.onClose}"\n\t\tuse:mediator="settings-manager themes-manager folders-actions"\n\t/>\n</div>\n',"app/feast-tpl!ui-block/layer-metathreads-settings/layer-metathreads-settings.html")});define("feast-tpl!ui-block/layer-metathreads-settings/layer-metathreads-settings.html",["feast-tpl!app/feast-tpl!ui-block/layer-metathreads-settings/layer-metathreads-settings.html"],function(a){return a});var __importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};define("ui-block/layer-metathreads-settings/layer-metathreads-settings",["require","exports","data-source/actions","feast","feast-tpl!./layer-metathreads-settings.html","helpers/data-source-dispatch","service/radars/decorator","ui-block/layer/layer","ui-block/react-async/react-async"],function(require,exports,a,b,c,d,e,f,g){"use strict";Object.defineProperty(exports,"__esModule",{value:true});b=__importDefault(b);c=__importDefault(c);d=__importDefault(d);e=__importDefault(e);f=__importDefault(f);g=__importDefault(g);exports.default=b.default.Block.extend((0,e.default)({events:[{name:"help:open",rename:"help_open"}]})({name:"layer-metathreads-settings",template:c.default,defaults:{helpLink:"metathreads",metathreadsData:[],metathreadsFiltersCount:0,metathreadsFiltersCountLoading:false},blocks:{layer:f.default,"react-async":g.default},constructor:function(){b.default.Block.apply(this,arguments);this.onClose=this.onClose.bind(this);this.onSettingsEdit=this.onSettingsEdit.bind(this);this.onHelpClick=this.onHelpClick.bind(this)},onClose:function(){this.broadcast("layer:close")},uid:0,onSettingsEdit:function(b){var c=this;return(0,d.default)({type:a.EDIT_METATHREADS_SETTINGS,uid:this.uid++,settings:b}).then(function(a){c.broadcast("metathreads:settings:updated");return a})},onHelpClick:function(){this.broadcast("help:open",this.attrs.helpLink)},onCreateFilter:function(){this.broadcast("metathreads:filters:create")}}))});!function(a,b){if("object"==typeof exports&&"object"==typeof module)module.exports=b(require("@mail/xray"),require("RPC/statuses/sdc"),require("cfgUser"),require("default-values"),require("logger"),require("request"),require("service/notify"),require("service/storage"));else if("function"==typeof define&&define.amd)define("vk-messenger",["@mail/xray","RPC/statuses/sdc","cfgUser","default-values","logger","request","service/notify","service/storage"],b);else{var c="object"==typeof exports?b(require("@mail/xray"),require("RPC/statuses/sdc"),require("cfgUser"),require("default-values"),require("logger"),require("request"),require("service/notify"),require("service/storage")):b(a["@mail/xray"],a["RPC/statuses/sdc"],a.cfgUser,a["default-values"],a.logger,a.request,a["service/notify"],a["service/storage"]);for(var d in c)("object"==typeof exports?exports:a)[d]=c[d]}}(self,function(a,b,c,d,e,f,g,h){return function(){"use strict";var i={8556:function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.Tag=void 0,function(a){a.Core="core",a.Global="gl",a.Self="self",a.Async="async",a.Ignore="ign",a.Known="known",a.API="api",a.Shared="shr",a.Ext="ext",a.ThirdParty="3rd",a.RB="rb",a.Unknown="unk"}(b.Tag||(b.Tag={}))},2204:function(a,b,c){Object.defineProperty(b,"__esModule",{value:!0}),b.coreLoggerHMR=b.coreLoggerDispatchKnownError=b.coreLoggerDispatchAPIError=b.coreLoggerDispatchIgnoredError=b.coreLoggerDispatchSelfError=b.coreLoggerDispatchReactError=b.coreLoggerDispatchError=b.getCoreLogger=b.Tag=void 0;var d=c(8556);Object.defineProperty(b,"Tag",{enumerable:!0,get:function(){return d.Tag}});b.getCoreLogger=function(){return"undefined"!=typeof coreLogger?coreLogger:void 0};b.coreLoggerDispatchError=function(a,c,d){var e;null===(e=(0,b.getCoreLogger)())||void 0===e||e.dispatchError(a,c,d)};b.coreLoggerDispatchReactError=function(a,c,d){var e;null===(e=(0,b.getCoreLogger)())||void 0===e||e.dispatchReactError(a,c,d)};b.coreLoggerDispatchSelfError=function(a,c,e,f){(0,b.coreLoggerDispatchError)(c,e,{category:a,tag:d.Tag.Self,log:f})};b.coreLoggerDispatchIgnoredError=function(a,c,e,f){(0,b.coreLoggerDispatchError)(c,e,{category:a,tag:d.Tag.Ignore,log:f})};b.coreLoggerDispatchAPIError=function(a,c,e,f){(0,b.coreLoggerDispatchError)(c,e,{category:a,tag:d.Tag.API,log:f})};b.coreLoggerDispatchKnownError=function(a,c,e,f){(0,b.coreLoggerDispatchError)(c,e,{category:a,tag:d.Tag.Known,log:f})};b.coreLoggerHMR=function(a,c){var d=(0,b.getCoreLogger)();if(d){var e=d.errors.rules,f=d.errors.opts.errors,g=a.priority||[];if(e.set("clear"),f&&f.rules)e.set(f.rules),g.push.apply(g,[].concat(f.priority||Object.keys(f.rules)));if(c)e.set(c.rules),g.push.apply(g,c.priority||[]);e.set(a.rules),e.priority(g);try{d.pkg.v=process.env.PACKAGE_VERSION,localStorage.setItem(process.env.LOGGER_LS_PRESET_VER_KEY,process.env.PACKAGE_VERSION)}catch(a){}}}},5881:function(a,b,c){var d=Object.create?function(a,b,c,d){if(void 0===d)d=c;var e=Object.getOwnPropertyDescriptor(b,c);if(!e||("get"in e?!b.__esModule:e.writable||e.configurable))e={enumerable:!0,get:function(){return b[c]}};Object.defineProperty(a,d,e)}:function(a,b,c,d){if(void 0===d)d=c;a[d]=b[c]},e=function(a,b){for(var c in a)if("default"!==c&&!Object.prototype.hasOwnProperty.call(b,c))d(b,a,c)};Object.defineProperty(b,"__esModule",{value:!0}),b.createScopeEntry=b.createLogEntry=b.createLogger=b.octoLogger=b.logger=void 0,e(c(2204),b);var f=c(1862);Object.defineProperty(b,"logger",{enumerable:!0,get:function(){return f.logger}}),Object.defineProperty(b,"octoLogger",{enumerable:!0,get:function(){return f.octoLogger}}),Object.defineProperty(b,"createLogger",{enumerable:!0,get:function(){return f.createLogger}}),Object.defineProperty(b,"createLogEntry",{enumerable:!0,get:function(){return f.createLogEntry}}),Object.defineProperty(b,"createScopeEntry",{enumerable:!0,get:function(){return f.createScopeEntry}})},6947:function(a,b,c){Object.defineProperty(b,"__esModule",{value:!0}),b.browserFormat=b.resetFormatStyle=b.nodeFromat=b.createFormat=void 0;var d=c(6117),e=/:([^;]+)/g;function f(a,b){return function(c){return b(c,{base:a.level[c.level]||"",label:a.label[c.level]||""})}}b.createFormat=f,b.nodeFromat=f({level:{log:"[0m",info:"[34m",done:"[34m",warn:"[33m",error:"[31m",verbose:"[35m"},label:{log:"[4m",info:"[4m",done:"[4m",error:"[4m",warn:"[4m",verbose:"[4m"}},function(a,b){var c=[];if(null!=a.badge)c.push(a.badge);if(null!=a.label)c.push("".concat(b.base).concat(b.label).concat(a.label,"[0m"));if(null!=a.args)c.push.apply(c,a.args);if(null!==a.meta)c.push("".concat(a.meta.file,":").concat(a.meta.line,":").concat(a.meta.col));return c.push("[0m"),c});var g="text-decoration: underline; font-weight: bold;";function h(a){return a.replace(e,": inherit")}b.resetFormatStyle=h,b.browserFormat=f({level:{log:"color: #333;",info:"color: dodgerblue;",done:"color: #1aaa55;",warn:"color: orange;",error:"color: red;",verbose:"color: magenta;"},label:{log:g,info:g,done:g,warn:g,error:g,verbose:g}},function(a,b){var c=[],e=[],f=a.args;if(a.ts>0)e.push("%c[%s] "),c.push(b.base,(0,d.timeFormat)(a.ts));if(null!=a.badge)e.push("%s"),c.push(a.badge);if(null!=a.label)e.push("%c%s%c "),c.push(b.label+b.base,a.label,h(b.label));if(null!=f){var g=f.length;if(g>0){e.push("%c"),c.push(b.base);for(var i=0;i<g;i++){var j=f[i];e.push("".concat("string"==typeof j?"%s":"%o"," ")),c.push(j)}}}if(null!=a.meta)e.push("%s"),c.push("".concat(a.meta.file,":").concat(a.meta.line,":").concat(a.meta.col));return c.unshift(e.join("")),c})},1862:function(a,b,c){var d=function(){return(d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])if(Object.prototype.hasOwnProperty.call(b,e))a[e]=b[e];return a}).apply(this,arguments)};Object.defineProperty(b,"__esModule",{value:!0}),b.octoLogger=b.logger=b.createLogger=b.revertLoggerContext=b.switchLoggerContext=b.getLoggerContext=b.createScopeEntry=b.createLogEntry=b.isLogEntry=void 0;var e=c(7111),f=c(6117),g=c(5302),h=new Date,i=0;function j(a){return a&&3===a.length&&a[0]&&a[1]>0&&a[2]>0}function k(a){return{file:a[0],line:a[1],col:a[2]}}function l(a){return a&&void 0!==a.type&&void 0!==a.level}function m(a,b,c,d,e){return Object.defineProperty({cid:++i,ts:0,type:a,level:b,badge:c,label:d,args:e,meta:null,entries:[]},"parent",{writable:!0,enumerable:!1,value:null})}function n(a,b,c,d){return m(g.ENTRY,a,b,c,d)}function o(a,b,c,d){return m(g.SCOPE,a,b,c,d)}b.isLogEntry=l,b.createLogEntry=n,b.createScopeEntry=o;var p=null;function q(a,b){var c=function(b){return{add:function(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];var e,g=j(c[0])?k(c.shift()):null;if(l(c[0]))e=c[0];else e=n("log",null,null,c);if(null!==g)e.meta=g;if(a.time)e.ts=(0,f.now)();var h=b.parent;if(h){var i=(e.parent=h).entries.push(e);if(i>a.storeLast)h.entries.splice(0,1)}if(!0!==a.silent&&a.output)a.output(e);return e}}},e=o("info","🚧","#root",[{time:h,created:new Date}]),i={logger:null,parent:e},m=c(i),q=b({createEntry:n,logger:m});if(null==a.silent&&"undefined"!=typeof location)a.silent=!/^(about:|file:|https?:\/\/localhost\/)/.test("".concat(location));if(null==a.time)a.time=!0;if(null==a.storeLast)a.storeLast=1e3;return i.logger=m,["add","clear","scope","setup","entries","last","priny","m"].forEach(function(a){if(q.hasOwnProperty(a))throw new Error('[octoLogger] "'.concat(a,'" is a reserved identifier'))}),q.print=function(){if(function b(c){c.printed=!1,c.entries.forEach(function(c){if(c.printed=!1,a.output)a.output(c);if(c.type===g.SCOPE)b(c)})}(e),a.output)a.output(null)},q.add=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return m.add.apply(m,a)},q.clear=function(){return e.entries.splice(0,e.entries.length)},q.setup=function(b){a=d(d({},a),b)},q.entries=function(){return e.entries},q.last=function(){return e.entries[e.entries.length-1]||null},q.scope=function d(e,f,g){var h=arguments,m=null;if(0===h.length)return this._scopeEntry;if(j(h[0]))m=k(h[0]),e=h[1],f=h[2],g=h[3];var q=h.length>2;if(null==g&&"function"==typeof f)g=f,q=!1;var r=[e];if(q)r.push(f);var s=l(e)?e:o("info",null,null,r);s.meta=m,i.logger.add(s);var t=c({parent:s,logger:null}),u=b({createEntry:n,logger:t});if(u.add=function(){return t.add.apply(t,arguments)},u.scope=d,u._scopeEntry=s,"function"==typeof g){var v=p,w=i.parent,x=i.logger;p={entry:s,scope:u,logger:t,options:a,scopeContext:i},i.parent=s,g(u),p=v,i.parent=w,i.logger=x}return u},q}b.getLoggerContext=function(){return p},b.switchLoggerContext=function(a,b){if(null===a)return p=null,null;var c=p,d=a.scope,e=a.scopeContext,f=null;if(p=a,a.scope=b,a.scopeContext)f=a.scopeContext.parent,a.scopeContext.parent=b.scope();return{activeContext:c,ctx:a,scope:d,scopeContext:e,scopeContextParent:f}},b.revertLoggerContext=function(a){var b=a.ctx,c=a.scopeContext;if(b.scope=a.scope,b.scopeContext=c,c)c.parent=a.scopeContextParent;p=a.activeContext},b.createLogger=q;var r={log:null,info:"❕ ",done:"✅ ",warn:"⚠️ ",error:"🛑 ",verbose:"🔎 "};b.logger=q({output:(0,e.universalOutput)()},function(a){var b=a.logger;return Object.keys(r).reduce(function(a,c){return a[c]=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.add(n(c,r[c]||null,null,a))},a},{})}),b.octoLogger=b.logger},5302:function(a,b){Object.defineProperty(b,"__esModule",{value:!0}),b.SCOPE=b.ENTRY=void 0,b.ENTRY=1,b.SCOPE=2},7111:function(a,b,c){Object.defineProperty(b,"__esModule",{value:!0}),b.universalOutput=b.browserOutput=b.nodeOutput=b.createOutput=void 0;var d=c(6947),e=c(5302);b.createOutput=function(a){var b=a.out,c=a.format,d=b.log,f={},g=[];return function a(h,i){if(null===h)return g.forEach(function(){b.groupEnd()}),void(g.length=0);var j=h.parent,k=g.length;if(!i||!h.printed){if(k>0){for(var l=k;l--&&g[l]!==j;)g[l].printed=!0,b.groupEnd();g.length=l+1}if(h.type===e.SCOPE)g.push(h),b.group.apply(b,c(h));else{if(!i&&j&&j.printed&&"#root"!==j.label)return void(f[j.cid]||(f[j.cid]=setTimeout(function(){g.forEach(function(){b.groupEnd()}),g.length=0;var d=[],e=j;do{d.unshift(e),e=e.parent}while(e&&"#root"!==e.label);d.forEach(function(a){b.group.apply(b,c(a))}),j.entries.forEach(function(b){a(b,!0)}),d.forEach(function(){b.groupEnd()})},0)));h.printed=!0,d.apply(b,c(h))}}}};b.nodeOutput=function(a){if(void 0===a)a={};return(0,b.createOutput)({out:a.out||console,format:a.format||d.nodeFromat})};b.browserOutput=function(a){if(void 0===a)a={};return(0,b.createOutput)({out:a.out||console,format:a.format||d.browserFormat})},b.universalOutput="undefined"==typeof self?b.nodeOutput:b.browserOutput},6117:function(a,b){function c(a,b){var c=a<10?"0".concat(a):a;if(b>1&&a<100)c="0".concat(c);return c}Object.defineProperty(b,"__esModule",{value:!0}),b.timeFormat=b.zeroPad=b.now=void 0,b.now="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:Date.now,b.zeroPad=c,b.timeFormat=function(a){var b=a/1e3;return"".concat(c(b/60%24|0),":").concat(c(b%60|0),".").concat(c(a%1e3|0,2))}},1373:function(b){b.exports=a},3169:function(a){a.exports=b},5261:function(a){a.exports=c},1791:function(a){a.exports=d},7920:function(a){a.exports=e},3440:function(a){a.exports=f},8624:function(a){a.exports=g},7050:function(a){a.exports=h}},j={};function k(a){var b=j[a];if(void 0!==b)return b.exports;var c=j[a]={exports:{}};return i[a](c,c.exports,k),c.exports}k.n=function(a){var b=a&&a.__esModule?function(){return a.default}:function(){return a};return k.d(b,{a:b}),b},k.d=function(a,b){for(var c in b)if(k.o(b,c)&&!k.o(a,c))Object.defineProperty(a,c,{enumerable:!0,get:b[c]})},k.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},k.r=function(a){if("undefined"!=typeof Symbol&&Symbol.toStringTag)Object.defineProperty(a,Symbol.toStringTag,{value:"Module"});Object.defineProperty(a,"__esModule",{value:!0})};var l={};return function(){k.r(l),k.d(l,{vkMessenger:function(){return Ob}});var a=k(1373),b=k.n(a);function c(a){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}var d=["vk.com","vk.ru"],e=["agreements","promo","vkc_behavior","vkc_auth_action","vkc_brand","vkc_display_mode","service_groups","external_device_id"],f=!("undefined"==typeof window||!window.document||!window.document.createElement),g=f&&!!window.addEventListener;function h(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function i(a,b){return a(b={exports:{}},b.exports),b.exports}var j=h(i(function(a){function b(c){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(a.exports=b=function(a){return typeof a},a.exports.default=a.exports,a.exports.__esModule=!0):(a.exports=b=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a.exports.default=a.exports,a.exports.__esModule=!0),b(c)}a.exports=b,a.exports.default=a.exports,a.exports.__esModule=!0})),m=function(){};if(g)try{var n=Object.defineProperty({},"passive",{get:function(){}});window.addEventListener("test",m,n),window.removeEventListener("test",m,n)}catch(c){}!function(){if(!f)return!1;try{document.createElement("div").scrollTo({top:0,get behavior(){return!0,"smooth"}})}catch(a){}}();var o=i(function(a){a.exports=function(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=new Array(b);c<b;c++)d[c]=a[c];return d},a.exports.default=a.exports,a.exports.__esModule=!0});h(o);var p=i(function(a){a.exports=function(a){if(Array.isArray(a))return o(a)},a.exports.default=a.exports,a.exports.__esModule=!0});h(p);var q=i(function(a){a.exports=function(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)},a.exports.default=a.exports,a.exports.__esModule=!0});h(q);var r=i(function(a){a.exports=function(a,b){if(a){if("string"==typeof a)return o(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?o(a,b):void 0}},a.exports.default=a.exports,a.exports.__esModule=!0});h(r);var s=i(function(a){a.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},a.exports.default=a.exports,a.exports.__esModule=!0});h(s),h(i(function(a){a.exports=function(a){return p(a)||q(a)||r(a)||s()},a.exports.default=a.exports,a.exports.__esModule=!0}));var t=h(i(function(a){a.exports=function(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a},a.exports.default=a.exports,a.exports.__esModule=!0}));function u(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function v(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?u(Object(c),!0).forEach(function(b){t(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):u(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}var w=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==j(a)||null===a)return"";b=v({encode:!0},b);var c=function(a){return b.encode?encodeURIComponent(a):String(a)};return Object.keys(a).reduce(function(d,e){var f=a[e];return void 0===f?d:null===f?(b.skipNull||d.push([c(e),""].join("=")),d):Array.isArray(f)?(f.map(function(a){d.push("".concat(c(e),"[]=").concat(c(a)))}).join(),d):(d.push([c(e),c(f)].join("=")),d)},[]).join("&")};function x(a){return w(a,{skipNull:!0})}function y(a){return Object.keys(a).filter(function(a){return e.includes(a)})}function z(a){var b;return Boolean(null===(b=y(a))||void 0===b?void 0:b.length)}function A(a){var b=function(a){return y(a).reduce(function(b,c){return b[c]=a[c],b},{})}(a);return btoa(JSON.stringify(b))}function B(a,b){var c,d,e=document.createElement("iframe");for(var f in a&&(e.src=a),e.style.cssText=null!==(c=null==b?void 0:b.cssText)&&void 0!==c?c:"",e.width="100%",e.height="100%",e.style.border="none",null==b?void 0:b.properties)b&&b.properties.hasOwnProperty(f)&&(e[f]=null!==(d=b.properties[f])&&void 0!==d?d:"");return e}function C(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];var d=function(a){return a&&"object"===c(a)};return a.reduce(function(a,b){return Object.keys(b).forEach(function(c){var e=a[c],f=b[c];Array.isArray(e)&&Array.isArray(f)?a[c]=e.concat.apply(e,f):d(e)&&d(f)?a[c]=C(e,f):a[c]=f}),a},{})}function D(a,b){return void 0===a?b:"number"!=typeof a?a?1:0:a}function E(a,b){return a&&"object"===c(a)?Object.keys(a).reduce(function(c,d){return b.includes(d)?(c[d]=a[d],c):c},{}):a}h(i(function(a){a.exports=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},a.exports.default=a.exports,a.exports.__esModule=!0})),h(i(function(a){function b(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}a.exports=function(a,c,d){return c&&b(a.prototype,c),d&&b(a,d),a},a.exports.default=a.exports,a.exports.__esModule=!0}));var F,G,H,I=new(function(){function a(){this.savedStyles=[],this.bodyScrollYValue=0,this.isFreezed=!1}return a.prototype.freezeBodyOverflow=function(){if(!this.isFreezed){this.isFreezed=!0;var a=(c=window.document.documentElement.clientWidth,Math.abs(window.innerWidth-c)),b=parseInt(window.getComputedStyle(window.document.body).paddingRight,10)||0;this.bodyScrollYValue=window.pageYOffset||window.scrollY,this.savedStyles=[],this.savedStyles.push({value:window.document.body.style.paddingRight,property:"padding-right"},{value:window.document.body.style.overflow,property:"overflow"},{value:window.document.body.style.overflowX,property:"overflow-x"},{value:window.document.body.style.overflowY,property:"overflow-y"}),window.document.body.style.setProperty("overflow","hidden"),window.document.body.style.setProperty("padding-right",a+b+"px")}var c},a.prototype.restoreBodyOverflow=function(){this.isFreezed&&(this.savedStyles.forEach(function(a){var b=a.value,c=a.property;b?window.document.body.style.setProperty(c,b):window.document.body.style.removeProperty(c)}),window.scrollTo(0,this.bodyScrollYValue),this.isFreezed=!1)},a}());!function(a){a.OPEN="VKSDKOpen",a.CLOSE="VKSDKClose",a.LOGOUT="VKSDKLogout",a.GET_CAPTCHA="VKSDKGetCaptcha",a.CAPTCHA_SUCCESS="VKSDKGetCaptchaSuccess",a.CAPTCHA_FAILED="VKSDKGetCaptchaFail",a.AUTH_NEEDED="VKSDKAuthNeeded",a.UPDATE_PARAMS="VKSDKUpdateParams",a.REQUEST_SUPERAPP_TOKEN="VKSDKRequestSuperAppToken",a.ERROR="VKSDKError"}(F||(F={})),function(a){a.INIT="VKSDKInit"}(G||(G={})),function(a){a[a.UNKNOWN=1]="UNKNOWN",a[a.MISSING_PARAM=2]="MISSING_PARAM",a[a.CONNECTION_LOST=3]="CONNECTION_LOST",a[a.USER_DENIED=4]="USER_DENIED",a[a.INVALID_PARAMS=5]="INVALID_PARAMS",a[a.CUSTOM=6]="CUSTOM",a[a.LOADING_ERROR=7]="LOADING_ERROR",a[a.CONNECT_WINDOW_CLOSED=7]="CONNECT_WINDOW_CLOSED",a[a.CONNECT_WINDOW_NOT_OPENED=8]="CONNECT_WINDOW_NOT_OPENED",a[a.CONNECT_DOMAIN_NOT_ALLOWED=9]="CONNECT_DOMAIN_NOT_ALLOWED",a[a.CONNECT_UNKNOWN_SDK_MESSAGE=10]="CONNECT_UNKNOWN_SDK_MESSAGE",a[a.CONNECT_CLIENT_SDK_ERROR=11]="CONNECT_CLIENT_SDK_ERROR",a[a.VALIDATE_ERROR=12]="VALIDATE_ERROR",a[a.CAPTCHA_ERROR=14]="CAPTCHA_ERROR",a[a.OLD_MISSING_PARAM=100]="OLD_MISSING_PARAM"}(H||(H={}));var J=function(a,b){return'Wrong "'+a+'" param. '+(b||"")},K=function(a){return"The "+a+" parameter must be a string"},L=function(a){return"The "+a+" is required parameter"},M=function(a){return"The "+a+" parameter must be а function"},N=function(a,b){return(N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,b)};function O(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function c(){this.constructor=a}N(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}var P,Q,R,S,T=function(){return(T=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function U(a){return a=a||Object.create(null),{on:function(b,c){(a[b]||(a[b]=[])).push(c)},off:function(b,c){a[b]&&a[b].splice(a[b].indexOf(c)>>>0,1)},emit:function(b,c){(a[b]||[]).slice().map(function(a){a(c)}),(a["*"]||[]).slice().map(function(a){a(b,c)})}}}function V(a){return"number"==typeof a}function W(a){return"string"==typeof a}function X(a){return void 0!==a&&""!==a&&null!==a}function Y(a){return"function"==typeof a}function Z(a,b,c,d){return{type:a,code:b,message:c,params:d}}function _(a,b){return{type:H[H.VALIDATE_ERROR],code:H.VALIDATE_ERROR,message:a,params:b}}function $(a){return a.message?{code:a.code,reason:a.message,data:a.params}:{code:a.code,data:a.params}}!function(a){a.GET_CAPTCHA="VKSDKGetCaptcha",a.APP_CLOSE="VKWebAppClose",a.APP_READY="VKSDKMiniAppReady",a.RESIZE="VKSDKMiniAppResize",a.APP_INIT_CONFIG="VKSDKMiniAppInitConfig",a.OPEN_APP="VKWebAppOpenApp",a.OPEN_PAY_FORM="VKWebAppOpenPayForm",a.ACTION_DONE="VKWebAppActionDone",a.SET_TITLE="VKWebAppSetTitle",a.AUTH_BY_EXCHANGE_TOKEN="VKWebAppAuthByExchangeToken",a.FORCE_LOGOUT="VKWebAppForceLogout"}(P||(P={})),function(a){a.OPEN="open",a.HIDE="hide",a.CLOSE="close",a.SHOW="show",a.MESSAGE="message",a.CREATE_APP="createapp"}(Q||(Q={})),function(a){a.SUPERAPP_TOKEN="VKSDKGeneralSuperAppToken",a.AUTH_NEEDED="VKSDKGeneralAuthNeeded",a.OPEN_APP="VKSDKGeneralOpenApp"}(R||(R={})),function(a){a.SUPERAPP_TOKEN_CHANGE_V2="superAppTokenV2",a.SUPERAPP_TOKEN_CHANGE="superAppToken"}(S||(S={}));var aa,ba=function(){function a(a,b,c){void 0===a&&(a="Parameter validation error"),this.errorText=a,this.params=b,this.valid=c}return a.prototype.isValid=function(){return Boolean(this.valid)},a.prototype.error=function(a){return this.isValid()?null:a?$(_(this.errorText,this.params)):_(this.errorText,this.params)},a}(),ca=function(){function a(a){this.rules=a}return a.prototype.validate=function(a){for(var b in this.rules)if(this.rules.hasOwnProperty(b))for(var c=0;c<this.rules[b].length;c++){var d=this.rules[b][c];if(!d.rule(a[b]))return new ba(d.errorText,a,!1)}return new ba("",a,!0)},a}(),da=(new ca({params:[{rule:X,errorText:L("params")}]}),new ca({token:[{rule:W,errorText:K("token")}]})),ea=new ca({event:[{rule:W,errorText:K("event")},{rule:X,errorText:L("event")}],handler:[{rule:X,errorText:L("handler")}]}),fa=new ca({app:[{rule:function(a){return V(a)||W(a)},errorText:function(a){return"The "+a+" parameter must be a number or a string"}("app")},{rule:X,errorText:L("app")}]}),ga=new ca({message:[{rule:X,errorText:L("message")}]}),ha=new ca({handler:[{rule:X,errorText:L("handler")},{rule:Y,errorText:M("handler")}]}),ia=new ca({handler:[{rule:X,errorText:L("handler")},{rule:Y,errorText:M("handler")}]}),ja=new ca({handler:[{rule:X,errorText:L("handler")},{rule:Y,errorText:M("handler")}]}),ka=new ca({appId:[{rule:V,errorText:function(a){return"The "+a+" parameter must be a number"}("appId")}]}),la={appId:0,superAppToken:"",superAppTokenV2:"",loginDomain:"login.vk.com",oauthDomain:"oauth.vk.com",connectDomain:"id.vk.com",_debug:!1,_localhost:!1},ma={},na=function(){function a(){}return a.init=function(a){if(!a.appId)throw new Error("appId required");var b=ka.validate({appId:a.appId});!b.isValid()&&console.error(b.error()),la.appId=a.appId,la.superAppToken=a.superAppToken||"",la.superAppTokenV2=a.superAppTokenV2||"",la.loginDomain=a.loginDomain||"login.vk.com",la.oauthDomain=a.oauthDomain||"oauth.vk.com",la.connectDomain=a.connectDomain||"id.vk.com",la.appSettings=a.appSettings,la._debug=!!a._debug,la._localhost=!!a._localhost},a.get=function(){return la},a.setSuperAppToken=function(b,c){void 0===c&&(c={});var d=da.validate({token:b});!d.isValid()&&console.error(d.error()),2===c.version?(la.superAppTokenV2=b,a.events.emit(S.SUPERAPP_TOKEN_CHANGE_V2,b)):(la.superAppToken=b,a.events.emit(S.SUPERAPP_TOKEN_CHANGE,b))},a.onRequestSuperAppToken=function(a){var b=ha.validate({handler:a});!b.isValid()&&console.error(b.error()),ma.requestSuperAppToken=a},a._requestSuperAppToken=function(b,c){var d;void 0===c&&(c={}),ma.requestSuperAppToken&&(d=ma.requestSuperAppToken(b,c)),d&&d.then(function(b){return a.setSuperAppToken(b,c)}).catch(console.error)},a.onAuth=function(a){var b=ia.validate({handler:a});!b.isValid()&&console.error(b.error()),ma.auth=a},a._auth=function(b){var c;void 0===b&&(b={}),ma.auth&&(c=ma.auth()),c&&c.then(function(c){a.setSuperAppToken(c,b)}).catch(console.error)},a.onOpenApp=function(a){ma.openApp=a},a._openApp=function(a){ma.openApp&&ma.openApp(a.app)},a.onLogout=function(a){var b=ja.validate({handler:a});!b.isValid()&&console.error(b.error()),ma.logout=a},a._logout=function(){ma.logout&&ma.logout()},a.fetchDomain=function(){return Boolean(aa)||(aa=new Promise(function(a){fetch("https://vk.ru/domain.txt").then(function(a){return a.text()}).then(function(a){return a.trim()}).then(function(a){la.loginDomain=la.loginDomain.replace("vk.com",a),la.oauthDomain=la.oauthDomain.replace("vk.com",a),la.connectDomain=la.connectDomain.replace("vk.com",a)}).then(a).catch(function(b){a(),console.warn(b)})})),aa},a.events=U(),a}(),oa=new ca({iframe:[{rule:X,errorText:L("iframe")}],origin:[{rule:W,errorText:K("origin")},{rule:X,errorText:L("origin")}]}),pa=new ca({event:[{rule:X,errorText:L("event")}]}),qa=new ca({handler:[{rule:X,errorText:L("handler")},{rule:Y,errorText:M("handler")}]}),ra=new ca({handler:[{rule:X,errorText:L("handler")}],params:[{rule:X,errorText:L("params")}]}),sa=function(a){var b=this;this.handler=function(){return{}},this.destroy=function(){delete b.config,window.removeEventListener("message",b.handleMessage)},this.onMessage=function(a){var c=qa.validate({handler:a});!c.isValid()&&console.error(c.error()),b.handler=a},this.sendMessage=function(a){var c,d=ra.validate(a);!d.isValid()&&console.error(d.error()),null===(c=b.config.iframe.contentWindow)||void 0===c||c.postMessage(T({type:"vk-sak-sdk"},a),b.config.origin)},this.handleMessage=function(a){var c=pa.validate({event:a});!c.isValid()&&console.error(c.error()),b.config.origin&&a.origin===b.config.origin&&a.source===b.config.iframe.contentWindow&&a.data&&"vk-sak-sdk"===a.data.type&&b.handler(a.data)};var c=oa.validate(a);!c.isValid()&&console.error(c.error()),this.config=a,window.addEventListener("message",this.handleMessage)},ta=function(){function a(){var a=this;this.resolve=function(b){if(Boolean(a.promise))return a.finished=!0,a.active=!1,a.resolveHandler(b)},this.reject=function(b){if(Boolean(a.promise))return a.finished=!0,a.active=!1,a.rejectHandler(b)}}return a.prototype.start=function(){var a=this;this.active=!0,this.finished=!1,this.promise=new Promise(function(b,c){a.resolveHandler=b,a.rejectHandler=c})},a.prototype.get=function(){return this.promise},a}(),ua=["extend_token","login_with_user","login_silent_user","__sferum_invite_link","registration_with_phone","registration_with_email","validate_phone","bind_ok_account","no_password_flow","confirm_service_action","login_with_eljour","login_with_multi_user","auth_validation_phone","qr_auth","multi_account_flow"];function va(a){return a&&ua.includes(a.name)?btoa(JSON.stringify(a)):""}function wa(a){return a?btoa(JSON.stringify(a)):""}function xa(a,b){return void 0===b&&(b="auth"),na.fetchDomain().then(function(){var c=na.get(),d=c.appId,e=c.connectDomain,f=c.appSettings,g=c._debug,h=c._localhost,i=T({app_id:d,response_type:"silent_token",v:"1.58.6",debug:g?1:null,localhost:h?1:null},a);f&&z(f)&&(i.app_settings=A(f));var j=x(i);return Promise.resolve("https://"+e+"/"+b+"?"+j)})}var ya,za=[0,1,3,4,6,15,16,82];!function(a){a.Default="default",a.NamePhone="name_phone",a.PhoneName="phone_name"}(ya||(ya={}));var Aa,Ba=[ya.Default,ya.NamePhone,ya.PhoneName];!function(a){a.Primary="primary",a.Flat="flat"}(Aa||(Aa={}));var Ca,Da=[Aa.Primary,Aa.Flat];!function(a){a.CAPTCHA_SUCCESS="VKSDKAuthCaptchaSuccess",a.CAPTCHA_FAIL="VKSDKAuthCaptchaFail"}(Ca||(Ca={}));var Ea,Fa=function(a,b,c){var d=this;this.events=U(),this.showReadyPromiseTask=new ta,this.init=function(){na.fetchDomain().then(function(){xa(T(T({origin:location.protocol+"//"+location.host,uuid:d.uuid},d.captchaData),{scheme:d.scheme}),"auth_captcha").then(d.handleCaptcha)})},this.createFrame=function(){return d.iframe=B("",{cssText:"\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100vh;\n      min-height: 100vh;\n      border: none;\n      z-index: 99999;\n     "}),d},this.handleError=function(a){var b=$(Z(H[H.CUSTOM],H.CUSTOM,"",a));d.events.emit(F.ERROR,b)},this.onMessage=function(a){switch(a.handler){case F.ERROR:d.handleError(a.params);break;case Ca.CAPTCHA_SUCCESS:d.showReadyPromiseTask.resolve(a.params),d.destroy();break;default:d.showReadyPromiseTask.reject(),d.destroy()}},this.handleCaptcha=function(a){d.iframe.src=a,document.body.appendChild(d.iframe),d.bridge=new sa({iframe:d.iframe,origin:"https://"+na.get().connectDomain}),d.bridge.onMessage(d.onMessage)},this.destroy=function(){d.iframe&&document.body.removeChild(d.iframe),d.bridge&&d.bridge.destroy()},this.show=function(){return d.iframe.style.display="block",new Promise(function(a){d.showReadyPromiseTask.start(),d.showReadyPromiseTask.get().then(a)})},this.uuid=a,this.captchaData=b,this.scheme=c||"bright_light",this.createFrame().init()},Ga=function(){function a(b){var c=this;this.readyPromiseResolve=null,this.readyPromise=null,this.child=null,this.initialTitle=window.document.title,this.open=function(a,b){return na.fetchDomain().then(function(){return c.loading?(c.getMiniAppUrl(a,b).then(function(a){c.iframe.src=a}),c.loading=new Promise(function(a){c.iframe.onload=function(){c.iframe.onload=null,a()}}),c.readyPromise=new Promise(function(a){return c.readyPromiseResolve=a}),c.eventOpenSettings(),c.readyPromise):c.preload(a,b).catch(console.error)})},this.eventOpenSettings=function(){c.iframe.style.display="block",c.params.stackMode||I.freezeBodyOverflow(),c.loading.then(c.handleResize).catch(console.error),c.events.emit(Q.OPEN)},this.hide=function(){c.iframe.style.display="none",c.params.stackMode||I.restoreBodyOverflow(),c.events.emit(Q.HIDE)},this.close=function(a){window.document.title!==c.initialTitle&&(window.document.title=c.initialTitle),c.params.stackMode||I.restoreBodyOverflow(),c.iframe&&c.iframe.remove(),c.bridge&&c.bridge.destroy(),delete c.iframe,delete c.bridge,na.events.off(S.SUPERAPP_TOKEN_CHANGE,c.onSuperAppToken),window.removeEventListener("resize",c.handleResize),c.events.emit(Q.CLOSE,a)},this.show=function(){if(!c.loading)throw new Error('App is not loaded, use "open" or "preload" methods');c.iframe.style.display="block",c.params.stackMode||I.freezeBodyOverflow(),c.events.emit(Q.SHOW)},this.preload=function(a,b){return na.fetchDomain().then(function(){var d=document.createElement("iframe"),e=window.innerHeight,f=isFinite(c.params.zIndex)?c.params.zIndex:999999;return c.getMiniAppUrl(a,b).then(function(a){d.src=a}),d.setAttribute("allow","geolocation"),d.style.cssText="\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: "+e+"px;\n      min-height: "+e+"px;\n      border: none;\n      z-index: "+f+";\n    ",c.iframe=d,document.body.appendChild(c.iframe),c.bridge=new sa({iframe:c.iframe,origin:"https://"+na.get().connectDomain}),c.loading=new Promise(function(a){d.onload=function(){d.onload=null,a()}}),c.readyPromise=new Promise(function(a){return c.readyPromiseResolve=a}),c.bridge.onMessage(c.handleMessage),na.events.on(S.SUPERAPP_TOKEN_CHANGE,c.onSuperAppToken),window.addEventListener("resize",c.handleResize),c.eventOpenSettings(),c.loading})},this.sendMessage=function(a){var b=ga.validate({message:a});!b.isValid()&&console.error(b.error()),c.bridge.sendMessage(a)},this.onSuperAppToken=function(a){c.bridge.sendMessage({handler:R.SUPERAPP_TOKEN,params:{result:a}})},this.handleError=function(a){var b=$(Z(H[H.CUSTOM],H.CUSTOM,"",a));c.events.emit(F.ERROR,b)},this.handleMessage=function(a){switch(a.handler){case F.GET_CAPTCHA:var b=a.params.uuid,d=new Fa(b,{captcha_sid:a.params.captcha_sid,captcha_img:a.params.captcha_img});d.show().then(function(a){c.bridge.sendMessage({handler:F.CAPTCHA_SUCCESS,params:T({uuid:b},a)})}).catch(function(){c.bridge.sendMessage({handler:F.CAPTCHA_FAILED,params:{uuid:b}}),d.destroy()});break;case P.APP_CLOSE:c.hide();break;case F.ERROR:c.handleError(a.params);break;case P.APP_READY:c.resolveReadyPromise(),c.handleUpdateConfig();break;case P.OPEN_APP:c.openMiniapp(a.params);break;case P.OPEN_PAY_FORM:c.openPayForm(a.params);break;case P.SET_TITLE:c.setTitle(a.params);break;case P.AUTH_BY_EXCHANGE_TOKEN:c.onAuthByExchangeToken();break;case P.FORCE_LOGOUT:c.onForceLogout();break;case R.SUPERAPP_TOKEN:na._requestSuperAppToken(a.params);break;case R.AUTH_NEEDED:na._auth();break;default:c.events.emit(Q.MESSAGE,a)}},this.handleResize=function(){if(c.iframe){var a=innerWidth,b=innerHeight;c.iframe.style.height=b+"px",c.iframe.style.minHeight=b+"px",c.bridge.sendMessage({handler:P.RESIZE,params:{viewport_width:a,viewport_height:b}})}},this.handleUpdateConfig=function(){c.bridge.sendMessage({handler:P.APP_INIT_CONFIG,params:{fullMode:c.params.fullMode,hideMenu:c.params.hideMenu,scheme:c.params.scheme}})},this.update=function(a){a&&(c.params=C(c.params,a||{}),c.sendUpdateParamsMessage())},this.getMiniAppUrl=function(a,b){return na.fetchDomain().then(function(){var d=na.get(),e=d.connectDomain,f=d.appId,g=d.superAppToken,h=d._debug,i=d._localhost;return"https://"+e+"/mini_app?"+x({app:c.params.app,host_app_id:f,superapp_token:g,app_query:a?JSON.stringify(a):"",app_hash:b||"",debug:h?1:null,localhost:i?1:null})})},this.resolveReadyPromise=function(){c.readyPromise&&c.readyPromiseResolve&&(c.readyPromiseResolve(),c.readyPromise=null,c.readyPromiseResolve=null)},this.openMiniapp=function(b){c.child=new a({app:b.app_id,stackMode:c.params.stackMode}),c.events.emit(Q.CREATE_APP,{app:c.child,location:b.location})},this.openPayForm=function(b){var d=T({},b.params);d.data&&(d.data=JSON.stringify(d.data));var e=T(T({},d),{app_id:b.app_id,action:b.action}),f=new a({app:6217559,stackMode:c.params.stackMode});f.open(e).then(function(){return c.hide()}).catch(console.error),f.events.on(Q.MESSAGE,function(a){c.handleVKPayFormMessage(a),f.close(),c.show()}),f.events.on(Q.HIDE,function(){f.close(),c.close()})},this.setTitle=function(a){window.document.title=a.title},this.onAuthByExchangeToken=function(){c.close({closedByExchangeToken:!0})},this.onForceLogout=function(){c.close({closedByForceLogout:!0})},this.handleVKPayFormMessage=function(a){a.handler===P.ACTION_DONE&&c.sendMessage(a),a.handler===F.ERROR&&c.handleError(a.params)};var d=fa.validate(b);!d.isValid()&&console.error(d.error()),this.params=T(T({},b),{app:"number"==typeof b.app?"app"+b.app:b.app,scheme:"string"==typeof b.scheme?b.scheme:"bright_light"}),this.events=U()}return a.prototype.on=function(a,b){var c=ea.validate({event:a,handler:b});!c.isValid()&&console.error(c.error()),this.events.on(a,b)},a.prototype.off=function(a,b){var c=ea.validate({event:a,handler:b});!c.isValid()&&console.error(c.error()),this.events.off(a,b)},a.prototype.sendUpdateParamsMessage=function(){this.bridge&&this.bridge.sendMessage({params:this.params,handler:F.UPDATE_PARAMS})},a}(),Ha=(function(){function a(){this.stack=[]}a.prototype.removeMiniApp=function(a){var b=a.app,c=this.stack.lastIndexOf(b);if(c>-1&&c===this.stack.length-1)if(this.stack.splice(c,1),this.stack.length){this.stack[this.stack.length-1].show();var d=this.stack[this.stack.length-2];setTimeout(function(){return null==d?void 0:d.hide()},0)}else I.restoreBodyOverflow()},a.prototype.makeHandleMiniAppClose=function(a){var b=this,c=a.app;return function(){b.removeMiniApp({app:c})}},a.prototype.makeHandleMiniAppHide=function(a){var b=this,c=a.app;return function(){var a=b.stack.lastIndexOf(c);a>-1&&a===b.stack.length-1&&setTimeout(function(){return c.close()},0)}},a.prototype.handleMiniAppCreate=function(a){var b=a.app,c=a.query,d=a.hash;this.stack.push(b),b.open(c,d).catch(console.error),b.events.on(Q.CREATE_APP,this.handleMiniAppCreate.bind(this)),b.events.on(Q.HIDE,this.makeHandleMiniAppHide({app:b})),b.events.on(Q.CLOSE,this.makeHandleMiniAppClose({app:b})),I.freezeBodyOverflow();var e=this.stack[this.stack.length-2];return setTimeout(function(){null==e||e.hide()},0),b},Object.defineProperty(a.prototype,"length",{get:function(){return this.stack.length},enumerable:!1,configurable:!0}),a.prototype.open=function(a){var b=fa.validate(a);!b.isValid()&&console.error(b.error());var c=a.app,d=a.query,e=a.hash,f=new Ga({app:c,stackMode:!0});return this.handleMiniAppCreate({app:f,query:d,hash:e}),f},a.prototype.close=function(){var a=this.stack;this.stack.splice(0),a.reverse().forEach(function(a){return a.close()}),I.restoreBodyOverflow()}}(),"ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"),Ia=function(){for(var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21,b="",c=a;c--;)b+=Ha[64*Math.random()|0];return b};!function(a){a.STATIC_MAP="VKSDKRequestToGeoservice:staticmap/png/",a.SEARCH="VKSDKRequestToGeoservice:search",a.OVERALL="VKSDKRequestToGeoservice:overall",a.DIRECTIONS="VKSDKRequestToGeoservice:directions",a.ISO="VKSDKRequestToGeoservice:iso"}(Ea||(Ea={}));var Ja,Ka,La,Ma,Na,Oa;!function(){function a(a){var b=this;this.apiKey=a.apiKey,this.requestMap={};var c=document.createElement("iframe");this.iframe=c,na.fetchDomain().then(function(){var a=na.get().appId;b.getGeoserviceProxyUrl({app_id:a}).then(function(a){c.src=a}),c.style.cssText="\n      display: none;\n    ",document.body.appendChild(b.iframe),b.bridge=new sa({iframe:b.iframe,origin:"https://"+na.get().connectDomain}),b.bridge.onMessage(function(a){var c=a.params,d=c.requestID,e=c.response;b.requestMap[d].resolve(e),delete b.requestMap[d]})})}a.prototype.setApiKey=function(a){this.apiKey=a},a.prototype.getGeoserviceProxyUrl=function(a){return na.fetchDomain().then(function(){var b=na.get(),c=b.connectDomain,d=b._debug,e=b._localhost;return"https://"+c+"/geoservice?"+x(T(T({},a||{}),{origin:location.protocol+"//"+location.host,debug:d?1:null,localhost:e?1:null}))})},a.prototype.prepareAnswer=function(a,b,c){var d=this,e=Ia();return this.bridge.sendMessage({handler:"VKSDKRequestToGeoservice:"+a,params:T(T({},b),{api_key:this.apiKey,wrapRequestInJSON:c,requestID:e})}),new Promise(function(a,b){d.requestMap[e]={resolve:a,reject:b}})},a.prototype.getStaticMap=function(a){return this.prepareAnswer("staticmap/png/",a)},a.prototype.encodeCoords=function(a){return this.prepareAnswer("search",a)},a.prototype.decodeCoords=function(a){return this.prepareAnswer("overall",a)},a.prototype.getDirections=function(a){return this.prepareAnswer("directions",a,!0)},a.prototype.getISO=function(a){return this.prepareAnswer("iso",a,!0)}}();!function(a){a.SHOW_DATA_POLICY="VKSDKOneTapAuthConnectDataPolicy",a.HIDE_DATA_POLICY="VKSDKOneTapAuthDataPolicyClose",a.DATA_POLICY_RESULT="VKSDKOneTapAuthDataPolicyResult",a.SHOW_CAPTCHA="VKSDKOneTapAuthDataPolicyShowCaptcha"}(Ja||(Ja={})),function(a){a.SHOW_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsShow",a.HIDE_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsHide",a.ACCEPT_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsAccept",a.DECLINE_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsDecline",a.POLICY_AGREEMENTS_ERROR="VKSDKOneTapAuthPolicyAgreementsError",a.SHOW_DATA_POLICY="VKSDKOneTapAuthPolicyAgreementsShowDataPolicy",a.GET_CAPTCHA="VKSDKGetCaptcha",a.CAPTCHA_SUCCESS="VKSDKGetCaptchaSuccess",a.CAPTCHA_FAIL="VKSDKGetCaptchaFail"}(Ka||(Ka={})),function(a){a.PHONE_VALIDATION_NEEDED="VKSDKOneTapAuthPhoneValidationNeeded",a.FULL_AUTH_NEEDED="VKSDKOneTapAuthFullAuthNeeded",a.AUTH_DATA_LOADED="VKSDKOneTapAuthDataLoaded",a.NOT_AUTHORIZED="VKSDKOneTapAuthNotAuthorized",a.LOGIN_SUCCESS="VKSDKOneTapAuthLoginSuccess",a.RESIZE_FRAME="VKSDKOneTapResizeFrame",a.SHOW_CAPTCHA="VKSDKOneTapShowCaptcha",a.VALIDATE_CAPTCHA="VKSDKOneTapValidateCaptcha",a.UPDATE_PARAMS="VKSDKUpdateParams"}(La||(La={})),function(a){a.CLOSE_AUTH="VKSDKOneTapAuthClose",a.ADAPTIVITY_CHANGE="VKSDKFloatingOneTapAdaptivityChange",a.ADAPTIVITY_CHANGED="VKSDKFloatingOneTapAdaptivityChanged",a.UPDATE_PARAMS="VKSDKUpdateParams"}(Ma||(Ma={})),function(a){a.SHOW_LOGIN="VKSDKButtonOneTapAuthShowLogin",a.SHOW_LOGIN_OPTIONS="VKSDKButtonOneTapAuthShowLoginOptions",a.SHOW_AGREEMENTS_DIALOG="VKSDKButtonOneTapAuthShowAgreementsDialog",a.START_AUTHORIZE="VKSDKButtonOneTapAuthStartAuthorize",a.UPDATE_PARAMS="VKSDKUpdateParams"}(Na||(Na={})),function(a){a.WRONG_TOKEN="VKSDKBindAccountErrorWrongToken",a.ALREADY_BIND="VKSDKBindAccountErrorAlreadyBind"}(Oa||(Oa={}));var Pa,Qa,Ra=new ca({url:[{rule:W,errorText:K("url")},{rule:X,errorText:L("url")}]}),Sa=new ca({uuid:[{rule:W,errorText:K("uuid")},{rule:X,errorText:L("uuid")}]}),Ta=(new ca({params:[{rule:X,errorText:L("params")}]}),new ca({callback:[{rule:X,errorText:L("callback")}]})),Ua=function(){function a(){}var b;return a.on=function(a,b){var c=ea.validate({event:a,handler:b});!c.isValid()&&console.error(c.error()),this.events.on(a,b)},a.off=function(a,b){var c=ea.validate({event:a,handler:b});!c.isValid()&&console.error(c.error()),this.events.off(a,b)},b=a,a.flags=null,a.events=U(),a.handleError=function(a){var c=$(Z(H[H.CUSTOM],H.CUSTOM,"",a));b.events.emit(F.ERROR,c)},a.silentAuth=function(){return na.fetchDomain().then(function(){var a=na.get(),b=a.loginDomain,c=a.appId,d=new ta,e=Ia(),f="https://"+b+"/?act=connect&app_id="+c+"&response_type=silent_token&uuid="+e+"&v=1.58.6",g=new XMLHttpRequest;return g.open("GET",f,!0),g.responseType="json",g.withCredentials=!0,d.start(),g.onload=function(){var a,b=g.response,c=g.status>=200&&g.status<300;if(b&&(null===(a=b.error)||void 0===a?void 0:a.error_code)===H.CAPTCHA_ERROR){var h=b.error,i=h.captcha_sid,j=h.captcha_img;new Fa(e,{captcha_sid:i,captcha_img:j}).show().then(function(a){var b=f+"&captcha_key="+a.captcha_key+"&captcha_sid="+a.captcha_sid;g.open("GET",b,!0),g.send()})}else b&&c?d.resolve({provider:"vk",payload:g.response}):d.reject()},g.onerror=function(){d.reject()},g.send(),d.get()})},a.oneTapAuth=function(b,c){if(console.warn("Connect.oneTapAuth method is deprecated. Use Connect.floatingOneTapAuth and Connect.buttonOneTapAuth methods."),!["floating","button"].includes(b))return null;switch(b){case"button":return a.buttonOneTapAuth(c);case"floating":return a.floatingOneTapAuth(c);default:return null}},a.floatingOneTapAuth=function(c){var d=Ta.validate({callback:c.callback});!d.isValid()&&console.error(d.error());var e=function(){var a,b=window.innerWidth,c=b<=768;return{destroy:function(){return window.removeEventListener("resize",a)},isAdaptive:function(){return c},observe:function(d){a=function(){var a=window.innerWidth;b>768&&a<=768?d(c=!0):b<=768&&a>768&&d(c=!1),b=a},window.addEventListener("resize",a)}}}(),f=function(a,b){var c,d,e,f={},g=a?"314px":"334px",h=a?"\n      display: none;\n      position: fixed;\n      bottom: 0;\n      right: 50%;\n      transform: translate(50%, 0);\n      max-width: 468px;\n      width: 100%;\n      height: "+g+";\n    ":"\n        display: none;\n        position: fixed;\n        top: 0;\n        right: 0;\n        max-width: 400px;\n        width: 100%;\n        height: "+g+";\n      ";return(null===(c=null==b?void 0:b.styles)||void 0===c?void 0:c.zIndex)&&isFinite(null===(d=null==b?void 0:b.styles)||void 0===d?void 0:d.zIndex)&&(h+="z-index: "+(null===(e=null==b?void 0:b.styles)||void 0===e?void 0:e.zIndex)+";"),b&&(f.skip_success=D(b.skipSuccess,0),void 0!==b.scheme&&["bright_light","space_gray"].includes(b.scheme)&&(f.scheme=b.scheme)),{pageUrl:"floating_one_tap_auth",pageUrlParams:T({adaptive:a?1:0},f),frameStyles:h,scheme:(null==b?void 0:b.scheme)||"bright_light"}}(e.isAdaptive(),c.options);if(!f)throw new Error("options were not set");var g,h,i,j=Ia(),k=T({origin:location.protocol+"//"+location.host,uuid:j},f.pageUrlParams),l=f.pageUrl,m=new ta,n=function(){h&&h.sendMessage({handler:La.RESIZE_FRAME,params:{uuid:j}})},o=function(){g&&(g.remove(),g=null),window.removeEventListener("resize",n),e&&e.destroy(),h&&h.destroy()};i=new Promise(function(a){m.start(),m.get().then(function(b){a(b)})});var p=function(d){if(d.params.uuid===j)switch(d.handler){case F.ERROR:b.handleError(d.params);break;case La.NOT_AUTHORIZED:c.callback({type:d.handler,payload:{uuid:j,error:"not_authorized"}}),o(),m.resolve(d.handler);break;case La.RESIZE_FRAME:g.style.height=d.params.height+"px";break;case Ma.CLOSE_AUTH:c.callback({type:d.handler,payload:{uuid:j}}),o();break;case Ma.ADAPTIVITY_CHANGED:g.style.display="block";break;case La.AUTH_DATA_LOADED:g.style.display="block",m.resolve(d.handler);default:a.handleOneTapEvents(d,h,c)}};return g=B("",{cssText:null==f?void 0:f.frameStyles}),document.body.appendChild(g),na.fetchDomain().then(function(){return xa(k,l).then(function(a){g.src=a,(h=new sa({iframe:g,origin:"https://"+na.get().connectDomain})).onMessage(p),e.observe(function(a){h.sendMessage({handler:Ma.ADAPTIVITY_CHANGE,params:{uuid:j,is_adaptive:a}}),a?(g.style.maxWidth="468px",g.style.top="auto",g.style.bottom="0",g.style.right="50%",g.style.transform="translate(50%, 0)"):(g.style.maxWidth="400px",g.style.top="0",g.style.bottom="auto",g.style.right="0",g.style.transform="none"),g.style.display="none"}),window.addEventListener("resize",n)})}),{getFrame:function(){return g},destroy:o,authReadyPromise:i,update:function(a){f=C(f||{},a),h&&f&&h.sendMessage({handler:Ma.UPDATE_PARAMS,params:f})}}},a.buttonOneTapAuth=function(b){var c=Ta.validate({callback:b.callback});!c.isValid()&&console.error(c.error());var d=function(a){var b,c,d,e,f,g,h={},i=44,j=56;return a&&(h.display=a.displayMode&&Ba.includes(a.displayMode)?a.displayMode:ya.Default,h.button_skin=a.buttonSkin&&Da.includes(a.buttonSkin)?a.buttonSkin:Aa.Primary,h.show_agreements=D(a.showAgreements,0),h.show_alternative_login=D(a.showAlternativeLogin,0),void 0!==a.scheme&&["bright_light","space_gray"].includes(a.scheme)&&(h.scheme=a.scheme),void 0!==(null===(b=a.buttonStyles)||void 0===b?void 0:b.height)&&(i=Number(null===(c=a.buttonStyles)||void 0===c?void 0:c.height),j=Number(null===(d=a.buttonStyles)||void 0===d?void 0:d.height)+12,h.style_height=null===(e=a.buttonStyles)||void 0===e?void 0:e.height),void 0!==(null===(f=a.buttonStyles)||void 0===f?void 0:f.borderRadius)&&(h.style_border_radius=null===(g=a.buttonStyles)||void 0===g?void 0:g.borderRadius),void 0!==a.langId&&(h.lang_id=za.includes(a.langId)?a.langId:0),i+=h.show_alternative_login?j:0,i+=h.show_agreements?80:0),{pageUrl:"button_one_tap_auth",pageUrlParams:h,frameStyles:"\n        height: "+i+"px;\n      ",scheme:(null==a?void 0:a.scheme)||"bright_light"}}(b.options);if(!d)throw new Error("options were not set");var e,f,g,h=Ia(),i=T({origin:location.protocol+"//"+location.host,uuid:h},d.pageUrlParams),j=d.pageUrl,k=new ta;g=new Promise(function(a){k.start(),k.get().then(function(b){a(b)})});var l=function(){f&&f.sendMessage({handler:La.RESIZE_FRAME,params:{uuid:h}})},m=function(c){if(c.params.uuid===h)switch(c.handler){case La.RESIZE_FRAME:e.style.height=c.params.height+"px";break;case La.NOT_AUTHORIZED:k.resolve(c.handler);break;case Na.SHOW_LOGIN:case Na.SHOW_LOGIN_OPTIONS:b.callback({type:c.handler,payload:{uuid:h}});break;case Na.SHOW_AGREEMENTS_DIALOG:a.userPolicyAgreements(h,null==d?void 0:d.scheme).show().then(function(a){a&&a.accepted&&f.sendMessage({handler:Na.START_AUTHORIZE,params:{uuid:h}})}).catch(function(){f.sendMessage({handler:Ka.DECLINE_POLICY_AGREEMENTS,params:{uuid:h}})});break;case La.AUTH_DATA_LOADED:k.resolve(c.handler);default:a.handleOneTapEvents(c,f,b)}};e=B("",{cssText:null==d?void 0:d.frameStyles});var n=b.container;return n&&n.appendChild(e),na.fetchDomain().then(function(){return xa(i,j).then(function(a){e.src=a,(f=new sa({iframe:e,origin:"https://"+na.get().connectDomain})).onMessage(m),window.addEventListener("resize",l)})}),{getFrame:function(){return e},destroy:function(){e&&(e.remove(),e=null),window.removeEventListener("resize",l),f&&f.destroy()},authReadyPromise:g,update:function(a){d=C(d||{},a),f&&d&&f.sendMessage({handler:Na.UPDATE_PARAMS,params:d})}}},a.handleOneTapEvents=function(c,d,e){var f,g,h=c.params.uuid;switch(c.handler){case F.ERROR:b.handleError(c.params);break;case La.AUTH_DATA_LOADED:d.sendMessage({handler:La.RESIZE_FRAME,params:{uuid:h}});break;case La.LOGIN_SUCCESS:e.callback({type:c.handler,provider:"vk",payload:c.params});break;case La.SHOW_CAPTCHA:var i=new Fa(h,{captcha_sid:c.params.captcha_sid,captcha_img:c.params.captcha_img},null===(f=e.options)||void 0===f?void 0:f.scheme);i.show().then(function(a){d.sendMessage({handler:Ca.CAPTCHA_SUCCESS,params:T({uuid:h},a)})}).catch(function(){d.sendMessage({handler:Ca.CAPTCHA_FAIL,params:{uuid:h}}),i.destroy()});break;case Ja.SHOW_DATA_POLICY:a.userDataPolicy(h,null===(g=e.options)||void 0===g?void 0:g.scheme).show().then(function(){e.callback({type:Ja.DATA_POLICY_RESULT,payload:{uuid:h,policyAccepted:!0}})}).catch(function(){e.callback({type:Ja.DATA_POLICY_RESULT,payload:{uuid:h,policyAccepted:!1}})});break;case La.FULL_AUTH_NEEDED:case La.PHONE_VALIDATION_NEEDED:e.callback({type:c.handler,payload:{uuid:h}})}},a.userDataPolicy=function(a,c){var d,e=Sa.validate({uuid:a});!e.isValid()&&console.error(e.error());var f,g=window.innerHeight,h=function(){d&&(d.style.display="none")},i=new ta,j=function(){d&&d.remove(),f&&f.destroy()};d=B("",{properties:{height:g+"px"},cssText:"\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100vh;\n      min-height: 100vh;\n      border: none;\n      z-index: 99999;\n    "}),document.body.appendChild(d);var k=function(e){switch(e.handler){case F.ERROR:b.handleError(e.params);break;case Ja.HIDE_DATA_POLICY:h(),i.resolve(void 0),j();break;case Ja.SHOW_CAPTCHA:var g=new Fa(a,{captcha_sid:e.params.captcha_sid,captcha_img:e.params.captcha_img},c);g.show().then(function(b){f.sendMessage({handler:Ca.CAPTCHA_SUCCESS,params:T({uuid:a},b)}),d.style.display="block"}).catch(function(){f.sendMessage({handler:Ca.CAPTCHA_FAIL,params:{uuid:a}}),g.destroy()}),h();break;default:h(),i.reject(),j()}};return na.fetchDomain().then(function(){xa({origin:location.protocol+"//"+location.host,uuid:a,scheme:c||"bright_light"},"user_data_policy").then(function(a){d.src=a}),(f=new sa({iframe:d,origin:"https://"+na.get().connectDomain})).onMessage(k)}),{show:function(){return d.style.display="block",new Promise(function(a){i.start(),i.get().then(function(b){a(b)})})},hide:h,destroy:j}},a.userPolicyAgreements=function(c,d){var e,f,g,h=new ta;g=window.innerHeight,e=B("",{properties:{height:g+"px"},cssText:"\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: "+g+"px;\n      min-height: "+g+"px;\n      border: none;\n      z-index: 99999;\n    "}),document.body.appendChild(e);var i=function(){e&&(e.remove(),e=null),f&&f.destroy()},j=function(){e&&(e.style.display="none")},k=function(g){switch(g.handler){case F.ERROR:b.handleError(g.params);break;case Ka.ACCEPT_POLICY_AGREEMENTS:j(),h.resolve({accepted:!0}),i();break;case Ka.DECLINE_POLICY_AGREEMENTS:j(),h.resolve({accepted:!1}),i();break;case Ka.GET_CAPTCHA:var k=new Fa(c,{captcha_sid:g.params.captcha_sid,captcha_img:g.params.captcha_img},d);k.show().then(function(a){f.sendMessage({handler:Ka.CAPTCHA_SUCCESS,params:T({uuid:c},a)}),e.style.display="block"}).catch(function(){f.sendMessage({handler:Ka.CAPTCHA_FAIL,params:{uuid:c}}),k.destroy()}),j();break;case Ka.SHOW_DATA_POLICY:j();var l=function(){e.style.display="block"};a.userDataPolicy(c,d).show().then(l).catch(l);break;case Ka.POLICY_AGREEMENTS_ERROR:case Ka.HIDE_POLICY_AGREEMENTS:default:h.reject(),i()}};return na.fetchDomain().then(function(){xa({origin:location.protocol+"//"+location.host,uuid:c,scheme:d||"bright_light"},"user_policy_agreements").then(function(a){e.src=a,(f=new sa({iframe:e,origin:"https://"+na.get().connectDomain})).onMessage(k)})}),{show:function(){return e.style.display="block",new Promise(function(a){h.start(),h.get().then(function(b){a(b)})})},hide:j,destroy:i}},a.userVisibleAuth=function(b){return na.fetchDomain().then(function(){var c=Ia(),e=na.get(),f=T(T({origin:location.protocol+"//"+location.host,uuid:c,debug:e._debug?1:null,localhost:e._localhost?1:null},E(b,["screen","source"])),{scheme:null==b?void 0:b.scheme}),g=va(null==b?void 0:b.action);g&&(f.action=g);var h=wa(null==b?void 0:b.entry);return h&&(f.initial_stats_info=h),xa(f).then(function(b){a.flags&&(b=b+"#"+x(a.flags));var e=screen.height/2-280,f=screen.width/2-410,g=window.open(b,"_blank","top="+e+",left="+f+",width=820,height=560,location");if(!g){var h=$(Z(H[H.CONNECT_WINDOW_NOT_OPENED],H.CONNECT_WINDOW_NOT_OPENED,"Connect window was not opened."));return Promise.reject(h)}return new Promise(function(a,b){var e=setInterval(function(){if(!g||g.closed){window.removeEventListener("message",f),clearInterval(e);var a=$(Z(H[H.CONNECT_WINDOW_CLOSED],H.CONNECT_WINDOW_CLOSED,"Connect window was closed."));b(a)}},1e3);function f(h){if(h.source===g&&g)if(window.removeEventListener("message",f),clearInterval(e),function(a){for(var b=0;b<d.length;b++){var c=d[b];if(a.slice(a.length-c.length)===c)return!0}return!1}(h.origin))if(h.data.action==="vk_connect_response"+c){var i=h.data.payload;if(g.close(),i.error)k=$(Z(H[H.CONNECT_CLIENT_SDK_ERROR],H.CONNECT_CLIENT_SDK_ERROR,function(a){return a.error+";"+a.errorCode}(i.error))),b(k);else a({provider:"vk",payload:i})}else if(h.data.action==="oauth_callback"+c)a({provider:h.data.payload.name}),g.close();else if(h.data.action==="skip_callback"+c){var j=h.data.payload.redirectURL;j&&(window.location.href=j),g.close()}else if(h.data.action==="bind_ok_account"+c)a(h.data.payload),g.close();else g.close(),k=$(Z(H[H.CONNECT_UNKNOWN_SDK_MESSAGE],H.CONNECT_UNKNOWN_SDK_MESSAGE,function(a){return"This SDK message is unknown: "+a}(JSON.stringify(h.data)))),b(k);else{g.close();var k=$(Z(H[H.CONNECT_DOMAIN_NOT_ALLOWED],H.CONNECT_DOMAIN_NOT_ALLOWED,function(a){return'URL domain "'+a+'" is not allowed.'}(h.origin)));b(k)}}window.addEventListener("message",f)})})})},a.redirectAuth=function(a){var b=Ra.validate(a);!b.isValid()&&console.error(b.error());var c=Ia(),d=T(T({redirect_uri:a.url,uuid:c},E(a,["screen","source"])),{scheme:null==a?void 0:a.scheme}),e=va(null==a?void 0:a.action);e&&(d.action=e);var f=wa(null==a?void 0:a.entry);f&&(d.initial_stats_info=f),(null==a?void 0:a.state)&&(d.redirect_state=a.state),xa(d).then(function(a){location.assign(a)})},a.logout=function(){return na.fetchDomain().then(function(){var a=na.get(),b=a.connectDomain,c=a.appId,d=a.superAppTokenV2;if(!d)return Promise.reject(J("superappToken","SuperappToken is undefined"));var e=x({origin:location.protocol+"//"+location.host,host_app_id:c,superapp_token:d}),f=fetch("https://"+b+"/logout?"+e,{credentials:"include"});return na.events.emit(F.LOGOUT),na.setSuperAppToken(""),na.setSuperAppToken("",{version:2}),f})},a}(),Va=["open_account"];!function(){function a(){}a.open=function(a){var b=da.validate({token:a.action.token});return!b.isValid()&&console.error(b.error()),na.fetchDomain().then(function(){var b,c=Ia(),d=na.get(),e=T({origin:location.protocol+"//"+location.host,uuid:c,debug:D(d._debug,0),localhost:D(d._localhost,0)},E(a,["screen","source"])),f=(b=null==a?void 0:a.action)&&Va.includes(b.name)?btoa(JSON.stringify(b)):"";return f&&(e.action=f),function(a){return na.fetchDomain().then(function(){var b=na.get(),c=b.appId,d=b.connectDomain,e=b.appSettings,f=b._debug,g=b._localhost,h=T({app_id:c,response_type:"silent_token",v:"1.58.6",debug:f?1:null,localhost:g?1:null},a);e&&z(e)&&(h.app_settings=A(e));var i=x(h);return Promise.resolve("https://"+d+"/open_account?"+i)})}(e).then(function(a){if(!window.open(a,"_blank")){var b=$(Z(H[H.CONNECT_WINDOW_NOT_OPENED],H.CONNECT_WINDOW_NOT_OPENED,"Connect window was not opened."));return Promise.reject(b)}return Promise.resolve()})})}}();!function(a){a.INTERNAL_RESIZE="VKSDKMessengerInternalResize",a.INTERNAL_LOGOUT="VKSDKMessengerInternalLogout"}(Pa||(Pa={})),function(a){a.CLOSE_CHAT="VKSDKMessengerCloseChat"}(Qa||(Qa={}));var Wa,Xa=function(){function a(){}return a.log=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b]},a}(),Ya=new ca({params:[{rule:X,errorText:L("params")}]}),Za=function(){function a(){var a=this;this.config={},this.params={},this.loadingTask=new ta,this.initTask=new ta,this.cssText="",this.handleError=function(b){var c=$(Z(H[H.CUSTOM],H.CUSTOM,"",b));a.events.emit(F.ERROR,c)},this.events=U(),this.handleBridgeMessage=this.handleBridgeMessage.bind(this),this.handleChangeSuperAppToken=this.handleChangeSuperAppToken.bind(this),this.close=this.close.bind(this),this.handleLogout=this.handleLogout.bind(this)}return a.prototype.preload=function(a){var b=this;return na.fetchDomain().then(function(){return b.validateParams(a).then(function(){return b.updateParams(a),b.createIframe().then(function(){return b.initTask.start(),b.loadingTask.start(),b.timeoutTimer=setTimeout(function(){if(!b.initTask.finished){var a=$(Z(H[H.LOADING_ERROR],H.LOADING_ERROR,"Loading timeout"));b.initTask.reject(a)}},5e3),b.iframe.onload=function(){b.iframe.onload=null,b.loadingTask.resolve()},b.bridge=new sa({iframe:b.iframe,origin:"https://"+na.get().connectDomain}),b.bridge.onMessage(b.handleBridgeMessage),na.events.on(S.SUPERAPP_TOKEN_CHANGE_V2,b.handleChangeSuperAppToken),na.events.on(F.LOGOUT,b.close),b.getIframeContainer().appendChild(b.iframe),b.loadingTask.get()})})})},a.prototype.open=function(a){var b=this;return this.validateParams(a).then(function(){return b.initTask.finished?(b.updateParams(a),Promise.resolve()):b.initTask.active||b.initTask.finished?(b.updateParams(a),b.initTask.get()):b.preload(a).then(function(){return b.initTask.get()})})},a.prototype.update=function(a,b){a&&this.updateParams(a),b&&this.updateConfig(b)},a.prototype.close=function(){this.iframe&&(this.iframe.onload=null,this.iframe.remove()),this.bridge&&this.bridge.destroy(),na.events.off(S.SUPERAPP_TOKEN_CHANGE_V2,this.handleChangeSuperAppToken),na.events.off(F.LOGOUT,this.close),delete this.iframe,delete this.bridge,this.loadingTask=new ta,this.initTask=new ta,this.events.emit(F.CLOSE)},a.prototype.sendMessage=function(a){var b=ga.validate({message:a});!b.isValid()&&console.error(b.error()),this.bridge.sendMessage(a)},a.prototype.on=function(a,b){var c=ea.validate({event:a,handler:b});!c.isValid()&&console.error(c.error()),this.events.on(a,b)},a.prototype.off=function(a,b){var c=ea.validate({event:a,handler:b});!c.isValid()&&console.error(c.error()),this.events.off(a,b)},a.prototype.handleInit=function(){this.initTask.finished||(clearTimeout(this.timeoutTimer),this.initTask.resolve()),this.sendUpdateParamsMessage(),this.iframe.style.display="block"},a.prototype.handleRequestAuth=function(){na._auth({version:2})},a.prototype.handleRequestSuperAppToken=function(a){na._requestSuperAppToken(a,{version:2})},a.prototype.handleChangeSuperAppToken=function(a){this.bridge.sendMessage({handler:F.REQUEST_SUPERAPP_TOKEN+"Success",params:{result:a}})},a.prototype.handleBridgeMessage=function(a){switch(Xa.log(a),a.handler){case G.INIT:this.handleInit();break;case F.REQUEST_SUPERAPP_TOKEN:this.handleRequestSuperAppToken(a.params);break;case F.AUTH_NEEDED:this.handleRequestAuth();break;case F.CLOSE:this.close();break;case F.ERROR:this.handleError(a.params);break;default:return}},a.prototype.handleLogout=function(){na._logout()},a.prototype.handleAfterUpdateParams=function(){this.sendUpdateParamsMessage()},a.prototype.handleAfterUpdateConfig=function(){},a.prototype.handleAfterCreateIframe=function(){},a.prototype.validateParams=function(a){var b=Ya.validate({params:a});return!b.isValid()&&console.error(b.error()),Promise.resolve(a)},a.prototype.createIframe=function(){var a=this;return this.getIframeUrl().then(function(b){return a.iframe=B(b,{cssText:a.cssText}),a.handleAfterCreateIframe(),Promise.resolve()})},a.prototype.getIframeUrl=function(){return new Promise(function(a){return a("")})},a.prototype.getIframeContainer=function(){return window.document.body},a.prototype.getIframeUrlParams=function(){var a=this;return na.fetchDomain().then(function(){var b=na.get(),c=b.superAppTokenV2,d=b.appId,e=b._debug,f=b._localhost;return Promise.resolve(x(T(T({},a.params),{host_app_id:d,superapp_token:c,origin:location.protocol+"//"+location.host,debug:e?1:null,localhost:f?1:null})))})},a.prototype.updateConfig=function(a){this.config=C(this.config,a),this.handleAfterUpdateConfig()},a.prototype.updateParams=function(a){this.params=C(this.params,a||{}),this.handleAfterUpdateParams()},a.prototype.sendUpdateParamsMessage=function(){this.bridge&&this.initTask.finished&&this.bridge.sendMessage({params:this.params,handler:F.UPDATE_PARAMS})},a}(),$a=new ca({config:[{rule:X,errorText:L("config")}]}),_a={styles:{bottom:"0",right:"0",zIndex:99999}},ab=function(a){function b(b){var c=a.call(this)||this;c.config=_a,c.cssText="\n    border: none;\n    display: none;\n    position: fixed;\n    color-scheme: auto;\n  ",c.updateStyles=function(){if(c.iframe){var a=c.config.styles,b=isFinite(a.zIndex)?a.zIndex:999999;c.iframe.style.zIndex=""+b,c.iframe.style.bottom=a.bottom,c.iframe.style.right=a.right}};var d=$a.validate({config:b});return!d.isValid()&&console.error(d.error()),c.updateConfig(b),c}return O(b,a),b.prototype.handleBridgeMessage=function(b){var c=this;switch(a.prototype.handleBridgeMessage.call(this,b),b.handler){case F.GET_CAPTCHA:var d=b.params.uuid,e=new Fa(d,{captcha_sid:b.params.captcha_sid,captcha_img:b.params.captcha_img});e.show().then(function(a){c.bridge.sendMessage({handler:F.GET_CAPTCHA+"Success",params:T({uuid:d},a)})}).catch(function(){c.bridge.sendMessage({handler:F.GET_CAPTCHA+"Fail",params:{uuid:d}}),e.destroy()});break;case Pa.INTERNAL_RESIZE:this.handleInternalIframeResize(b);break;case Pa.INTERNAL_LOGOUT:this.handleLogout();break;case Qa.CLOSE_CHAT:this.events.emit(Qa.CLOSE_CHAT,b.params);break;default:return}},b.prototype.handleInternalIframeResize=function(a){var b=a.params;this.iframe.width=b.width+"px",this.iframe.height=b.height+"px"},b.prototype.handleAfterUpdateConfig=function(){this.updateStyles()},b.prototype.handleAfterCreateIframe=function(){this.updateStyles()},b.prototype.validateParams=function(a){return a.peer_id>=0?Promise.reject(J("peer_id","Peer id can`t be positive")):Promise.resolve(a)},b.prototype.getIframeUrl=function(){var a=this;return na.fetchDomain().then(function(){return a.getIframeUrlParams().then(function(a){var b=na.get().connectDomain;return Promise.resolve("https://"+b+"/messenger?"+a)})})},b}(Za);!function(a){a.SCANNED="VKSDKQRScaned",a.CLICKED="VKSDKQRClicked"}(Wa||(Wa={}));var bb,cb=new ca({container:[{rule:X,errorText:L("container")}]});!function(a){function b(b){var c=a.call(this)||this;c.getIframeContainer=function(){return c.config.container?c.config.container:window.document.body};var d=cb.validate(b);return!d.isValid()&&console.error(d.error()),(null==b?void 0:b.langId)&&!za.includes(null==b?void 0:b.langId)&&console.error(J("lang_id","This lang id is not allowed")),c.updateConfig(b),c}O(b,a),b.prototype.getIframeUrl=function(){return this.getIframeUrlParams().then(function(a){var b=na.get().connectDomain;return Promise.resolve("https://"+b+"/qr_auth?"+a)})},b.prototype.getIframeUrlParams=function(){var a=this;return na.fetchDomain().then(function(){var b,c=na.get(),d=c.appId,e=c._debug,f=c._localhost;return Promise.resolve(x({scheme:(null===(b=a.params)||void 0===b?void 0:b.scheme)||"bright_light",app_id:d,origin:location.protocol+"//"+location.host,lang_id:a.config.langId||null,initial_stats_info:wa(a.config.entry)||null,debug:e?1:null,localhost:f?1:null}))})},b.prototype.handleBridgeMessage=function(b){var c=this;switch(a.prototype.handleBridgeMessage.call(this,b),b.handler){case Wa.CLICKED:this.events.emit(Wa.CLICKED);break;case Wa.SCANNED:this.events.emit(Wa.SCANNED,b.params.token);break;case F.GET_CAPTCHA:var d=b.params.uuid,e=new Fa(d,{captcha_sid:b.params.captcha_sid,captcha_img:b.params.captcha_img});e.show().then(function(a){c.bridge.sendMessage({handler:F.GET_CAPTCHA+"Success",params:T({uuid:d},a)})}).catch(function(){c.bridge.sendMessage({handler:F.GET_CAPTCHA+"Fail",params:{uuid:d}}),e.destroy()});break;default:return}}}(Za);!function(a){a.CONTENT_IN_HEIGHT="VKSDKUserContentInHeight",a.VALIDATION_PHONE_CLOSE="VKSDKUserValidationPhoneClose"}(bb||(bb={}));var db,eb=new ca({container:[{rule:X,errorText:L("container")}]}),fb=new ca({canSkip:[{rule:X,errorText:L("canSkip")}],origin:[{rule:X,errorText:L("origin")}]});!function(a){function b(b){var c=a.call(this)||this;c.getIframeContainer=function(){return c.config.container?c.config.container:window.document.body};var d=eb.validate(b);return!d.isValid()&&console.error(d.error()),c.updateConfig(b),c}O(b,a),b.prototype.getIframeUrl=function(){var a=T(T({redirect_uri:this.params.url,uuid:Ia()},E(this.params,["screen","source"])),{scheme:this.params.scheme}),b=va(this.params.action);b&&(a.action=b);var c=wa(this.params.entry);return c&&(a.initial_stats_info=c),this.params.state&&(a.redirect_state=this.params.state),xa(a)},b.prototype.handleBridgeMessage=function(b){switch(a.prototype.handleBridgeMessage.call(this,b),b.handler){case bb.CONTENT_IN_HEIGHT:this.events.emit(bb.CONTENT_IN_HEIGHT,b.params);break;case bb.VALIDATION_PHONE_CLOSE:this.events.emit(bb.VALIDATION_PHONE_CLOSE,b.params);break;default:return}},b.prototype.validatePhone=function(a){var b=fb.validate(a);!b.isValid()&&console.error(b.error());var c={name:"auth_validation_phone",params:{status:a.canSkip?"1":"0"}};a.sid&&(c.params.sid=a.sid),this.open({url:a.origin,scheme:a.scheme,action:c})}}(Za);!function(a){a.SUCCESS="VKSDKVerificationProfileSuccess",a.CLOSE="VKSDKVerificationProfileClose"}(db||(db={}));var gb,hb,ib,jb,kb=new ca({config:[{rule:X,errorText:L("config")}],provider:[{rule:W,errorText:K("provider")},{rule:X,errorText:L("provider")}]}),lb=(function(a){function b(b){var c=a.call(this)||this;c.cssText="\n    position: fixed;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 9999;\n    border: none;\n    display: none;\n  ";var d=kb.validate({config:b,provider:b.provider});return!d.isValid()&&console.error(d.error()),c.updateConfig(b),c}O(b,a),b.prototype.handleBridgeMessage=function(b){switch(a.prototype.handleBridgeMessage.call(this,b),b.handler){case db.SUCCESS:this.events.emit(db.SUCCESS);break;case db.CLOSE:this.close();break;default:return}},b.prototype.handleAfterUpdateConfig=function(){this.updateZIndex()},b.prototype.handleAfterCreateIframe=function(){this.updateZIndex()},b.prototype.getIframeUrlParams=function(){var a=this;return na.fetchDomain().then(function(){var b=na.get(),c=b.superAppTokenV2,d=b.appId,e=b._debug,f=b._localhost;return Promise.resolve(x(T(T({},a.params),{app:d,superapp_token:c,origin:location.protocol+"//"+location.host,debug:e?1:null,localhost:f?1:null,provider:a.config.provider})))})},b.prototype.getIframeUrl=function(){var a=this;return na.fetchDomain().then(function(){return a.getIframeUrlParams().then(function(a){var b=na.get().connectDomain;return Promise.resolve("https://"+b+"/verification_profile?"+a)})})},b.prototype.updateZIndex=function(){if(this.iframe){var a=this.config.zIndex;this.iframe.style.zIndex=""+a}}}(Za),k(1791)),mb=k(8624),nb=k.n(mb),ob=k(5881),pb=k(5261),qb=k.n(pb),rb=k(3440),sb=k.n(rb),tb=k(3169),ub=k.n(tb),vb=k(7920),wb=k.n(vb)().getScope("vk-messenger"),xb=function(a,b){return new Promise(function(c,d){wb.add("callSwaJsApi: "+a),function(a,b){return sb().post(a,b,{retries:1,xhrFields:{withCredentials:!0}}).then(function(a){var b=a.body;if("ok"===b.status)return b.body;if("fail"===b.status&&"sdc"===b.code){wb.add("callSwaJsApi: no sdc",a);var c=ub().process(a);return a.retry(c,!0).then(function(a){var b=a.body;if("ok"===b.status)return wb.add("callSwaJsApi: retry ok",a),b.body;throw wb.add("callSwaJsApi: retry error",a),b})}throw b})}(a,b).then(function(a){wb.add("callSwaJsApi: ok"),c(a)}).catch(function(a){var b,c,e,f,g,h=null!==(g=null!==(e=null===(c=null===(b=null==a?void 0:a.body)||void 0===b?void 0:b.error)||void 0===c?void 0:c.code)&&void 0!==e?e:null===(f=null==a?void 0:a.error)||void 0===f?void 0:f.code)&&void 0!==g?g:null==a?void 0:a.code;wb.add("callSwaJsApi: error: "+h,a),d(h)})})},yb=k(7050),zb=k.n(yb),Ab=function(){return zb().get("vk-messenger",{email:!1})},Bb=function(){zb().set("vk-messenger",null,{email:!1}),wb.add("store.clearStore")},Cb=function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):(b=a.value,b instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})},Db=function(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){return function(f){if(c)throw new TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&f[0]?d.return:f[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,f[1])).done)return e;if(d=0,e)f=[2&f[0],e.value];switch(f[0]){case 0:case 1:e=f;break;case 4:return g.label++,{value:f[1],done:!1};case 5:g.label++,d=f[1],f=[0];continue;case 7:f=g.ops.pop(),g.trys.pop();continue;default:if(!(e=g.trys,(e=e.length>0&&e[e.length-1])||6!==f[0]&&2!==f[0])){g=0;continue}if(3===f[0]&&(!e||f[1]>e[0]&&f[1]<e[3])){g.label=f[1];break}if(6===f[0]&&g.label<e[1]){g.label=e[1],e=f;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(f);break}if(e[2])g.ops.pop();g.trys.pop();continue}f=b.call(a,g)}catch(a){f=[6,a],d=0}finally{c=e=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([f,h])}}},Eb=function(a){return Cb(void 0,void 0,Promise,function(){var c,d,e;return Db(this,function(f){switch(f.label){case 0:return f.trys.push([0,2,,3]),wb.add("getSuperappToken: Connect.userVisibleAuth ".concat(a?"forced":"")),b().send("vk-messenger_vkc-visible"),[4,Ua.userVisibleAuth(a?{action:{name:"login_silent_user"}}:null)];case 1:return c=f.sent(),wb.add("getSuperappToken: Connect.userVisibleAuth result: ".concat((null===(e=null==c?void 0:c.payload)||void 0===e?void 0:e.auth)?"auth ok":"no auth")),[2,null==c?void 0:c.payload];case 2:return d=f.sent(),b().send("vk-messenger_vkc-closed"),wb.add("getSuperappToken: Connect.userVisibleAuth error",d),[3,3];case 3:return[2]}})})},Fb=function(a,c){return Cb(void 0,void 0,Promise,function(){var d,e,f,g,h,i,j,k;return Db(this,function(l){switch(l.label){case 0:if(wb.add("getSuperappToken start: ".concat(a?"forced":""," ").concat(c?"onlySilent":"")),a)!function(){var a=Ab().email;if(a)zb().set("vk-messenger",{email:a,token:null},{email:!1});else zb().set("vk-messenger",null,{email:!1});wb.add("store.clearToken")}();if(a)return[3,2];else return[4,Cb(void 0,void 0,Promise,function(){return Db(this,function(a){if(wb.add("getCachedToken: start"),!Ab())return wb.add("getCachedToken: no stored token"),[2,""];if(qb().get("initialUser.email")!==Ab().email)return wb.add("getCachedToken error: invalid stored token"),Bb(),[2,""];else return wb.add("getCachedToken: return stored token"),[2,Ab().token]})})];case 1:if(d=l.sent())return wb.add("getSuperappToken return stored token"),[2,d];l.label=2;case 2:if(lb.VK_MESSENGER_DISABLE_SILENT_AUTH)return[3,4];else return wb.add("getSuperappToken try silent auth"),[4,Cb(void 0,void 0,Promise,function(){var a,c,d;return Db(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),wb.add("getSuperappToken: Connect.silentAuth"),b().send("vk-messenger_vkc-silent"),[4,Ua.silentAuth()];case 1:return a=e.sent(),wb.add("getSuperappToken: Connect.silentAuth result: ".concat((null===(d=null==a?void 0:a.payload)||void 0===d?void 0:d.auth)?"auth ok":"no auth")),[2,null==a?void 0:a.payload];case 2:return c=e.sent(),b().send("vk-messenger_vkc-silent-error"),wb.add("getSuperappToken: Connect.silentAuth error",c),[3,3];case 3:return[2]}})})];case 3:e=l.sent(),l.label=4;case 4:if((null==e?void 0:e.auth)||c)return[3,6];else return wb.add("getSuperappToken try visible auth"),[4,Eb(a)];case 5:e=l.sent(),l.label=6;case 6:if(!e||!e.auth){if(wb.add("getSuperappToken: invalid payload error, return empty token",e),e&&!c)nb().error({unique:!0});return[2,""]}f=e.token,g=e.uuid,h="",l.label=7;case 7:return l.trys.push([7,9,,10]),wb.add("getSuperappToken: call jsapi "+lb.SWA_SUPERAPP_SILENT_URL),[4,xb(lb.SWA_SUPERAPP_SILENT_URL,{silent_token:f,uuid:g,client_id:lb.VK_MESSENGER_APP_ID,act_token:qb().get("authCSRFToken"),scope:"messenger",subject:"superappkit-web",no_bind:1})];case 8:if(i=l.sent(),h=i.superapp_token_v2||"",wb.add("getSuperappToken: call jsapi result ".concat(h.length?"ok":"empty")),!h.length)(0,ob.coreLoggerDispatchSelfError)("vk-widget",new Error("superapp/silent: empty superapp_token_v2"));return[3,10];case 9:return j=l.sent(),nb().error({unique:!0}),wb.add("getSuperappToken: call jsapi error "+j),(0,ob.coreLoggerDispatchSelfError)("vk-widget",new Error("superapp/silent: api error")),[3,10];case 10:if(h){if(!(null===(k=Ab())||void 0===k?void 0:k.email)&&lb.VK_MESSENGER_SHOW_AUTH_NOTIFY)!function(a){if(null==a?void 0:a.user){var b=a.user,c=b.first_name,d=b.last_name;nb().add({text:i18n("Вы вошли как {vkUserName}",{vkUserName:"".concat(c," ").concat(d)}),qa:"vk-widget-auth-notify"})}}(e);!function(a,b){zb().set("vk-messenger",{email:b,token:a},{email:!1}),wb.add("store.setStore",a.length?"ok":"empty")}(h,qb().get("initialUser.email"))}return wb.add("getSuperappToken: result ".concat(h.length?"ok":"empty")),[2,h]}})})},Gb=(gb=lb.VK_MESSENGER_AUTH_THROTTLE,hb=!1,ib=null,jb=null,function(a,b){if(ib!==a)hb=!1,clearTimeout(jb);if(ib=a,hb)return hb;else return jb=setTimeout(function(){hb=!1},gb),hb=Fb(a,b)}),Hb=function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):(b=a.value,b instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})},Ib=function(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){return function(f){if(c)throw new TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&f[0]?d.return:f[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,f[1])).done)return e;if(d=0,e)f=[2&f[0],e.value];switch(f[0]){case 0:case 1:e=f;break;case 4:return g.label++,{value:f[1],done:!1};case 5:g.label++,d=f[1],f=[0];continue;case 7:f=g.ops.pop(),g.trys.pop();continue;default:if(!(e=g.trys,(e=e.length>0&&e[e.length-1])||6!==f[0]&&2!==f[0])){g=0;continue}if(3===f[0]&&(!e||f[1]>e[0]&&f[1]<e[3])){g.label=f[1];break}if(6===f[0]&&g.label<e[1]){g.label=e[1],e=f;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(f);break}if(e[2])g.ops.pop();g.trys.pop();continue}f=b.call(a,g)}catch(a){f=[6,a],d=0}finally{c=e=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([f,h])}}},Jb=null,Kb=null,Lb=function(a){return(a||0)+15},Mb={open:function(a){var c=a.chatId,d=a.onShow,e=a.darkMode,f=a.offset,g=a.onClose;return Hb(void 0,void 0,void 0,function(){var a,h,i;return Ib(this,function(j){if(!Jb)Jb=new ab({styles:{right:"".concat(Lb(f),"px"),bottom:"0px",zIndex:500}}),a=function(a){Jb.close(),nb().error({unique:!0}),b().send("vk-messenger_internal-error"),wb.add("messenger internal error",a)},h=function(){b().send("in_mail_close_vk_messenger-chat")},i=function(){if(b().send("in_mail_close_vk_messenger"),wb.add("store.clearActiveChat"),zb().set(lb.VK_MESSENGER_ACTIVE_CHAT_STORAGE_KEY,null),Jb.off(F.ERROR,a),Jb.off(Qa.CLOSE_CHAT,h),Jb.off(F.CLOSE,g),Jb=null,g)g()},Jb.on(F.ERROR,a),Jb.on(Qa.CLOSE_CHAT,h),Jb.on(F.CLOSE,i);return Kb=d,Jb.open({peer_id:-c,scheme:e?"space_gray":"bright_light"}).catch(function(a){b().send("vk-messenger_open-error"),wb.add("messenger open error",a)}),function(a){wb.add("store.setActiveChat",a),zb().set(lb.VK_MESSENGER_ACTIVE_CHAT_STORAGE_KEY,a)}(c),[2]})})},setThemeMode:function(a){if(Jb)Jb.update({scheme:a?"space_gray":"bright_light"})},setOffset:function(a){if(Jb)Jb.update(null,{styles:{right:"".concat(Lb(a),"px")}})},setSuperappToken:function(a){if(na.setSuperAppToken(a,{version:2}),a&&Kb)Kb(),Kb=null},isOpen:function(){return!!Jb},_onRequestSuperAppToken:function(a){return Hb(void 0,void 0,void 0,function(){var b,c;return Ib(this,function(d){switch(d.label){case 0:return b=a.refresh,wb.add("Config.onRequestSuperAppToken ".concat(b?"forced (drop saved token)":"")),[4,Nb(b,!b)];case 1:return c=d.sent(),wb.add("Config.onRequestSuperAppToken ".concat(b?"forced ":"","result: ").concat(c.length?"ok":"empty")),[2,c]}})})}};na.init({appId:lb.VK_MESSENGER_APP_ID,loginDomain:lb.VK_LOGIN_DOMAIN,oauthDomain:lb.VK_OAUTH_DOMAIN,connectDomain:lb.VK_CONNECT_DOMAIN}),wb.add("Config.init",na.get());var Nb=function(a,b){return Hb(void 0,void 0,Promise,function(){var c;return Ib(this,function(d){switch(d.label){case 0:return[4,Gb(a,b)];case 1:if(void 0===(c=d.sent()))return[2,""];else return wb.add("tryGetSuperappToken: set ".concat((null==c?void 0:c.length)?"ok":"empty"," token to widget")),Mb.setSuperappToken(c),[2,c]}})})};na.onAuth(function(){return Hb(void 0,void 0,void 0,function(){var a;return Ib(this,function(b){switch(b.label){case 0:return wb.add("Config.onAuth"),[4,Nb()];case 1:return a=b.sent(),wb.add("Config.onAuth result: token ".concat(a.length?"ok":"empty")),[2,a]}})})}),na.onRequestSuperAppToken(Mb._onRequestSuperAppToken),na.onLogout(function(){if(lb.VK_MESSENGER_LOGOUT)wb.add("Config.onLogout"),Ua.logout().then(function(){wb.add("Config.onLogout success"),Bb()})});var Ob=Mb}(),l}()});